{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "assistant-attachment",
  "type": "registry:component",
  "description": "File attachment display component.",
  "files": [
    {
      "type": "registry:component",
      "path": "components/assistant-ui/attachment.tsx",
      "content": "\"use client\";\n\nimport { PropsWithChildren, useEffect, useState, type FC } from \"react\";\nimport Image from \"next/image\";\nimport { XIcon, PlusIcon, FileText } from \"lucide-react\";\nimport {\n  AttachmentPrimitive,\n  ComposerPrimitive,\n  MessagePrimitive,\n  useAssistantState,\n  useAssistantApi,\n} from \"@assistant-ui/react\";\nimport { useShallow } from \"zustand/shallow\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { TooltipIconButton } from \"@/components/assistant-ui/tooltip-icon-button\";\nimport { cn } from \"@aomi-labs/react\";\n\nconst useFileSrc = (file: File | undefined) => {\n  const [src, setSrc] = useState<string | undefined>(undefined);\n\n  useEffect(() => {\n    if (!file) {\n      setSrc(undefined);\n      return;\n    }\n\n    const objectUrl = URL.createObjectURL(file);\n    setSrc(objectUrl);\n\n    return () => {\n      URL.revokeObjectURL(objectUrl);\n    };\n  }, [file]);\n\n  return src;\n};\n\nconst useAttachmentSrc = () => {\n  const { file, src } = useAssistantState(\n    useShallow(({ attachment }): { file?: File; src?: string } => {\n      if (attachment.type !== \"image\") return {};\n      if (attachment.file) return { file: attachment.file };\n      const src = attachment.content?.filter((c) => c.type === \"image\")[0]\n        ?.image;\n      if (!src) return {};\n      return { src };\n    }),\n  );\n\n  return useFileSrc(file) ?? src;\n};\n\ntype AttachmentPreviewProps = {\n  src: string;\n};\n\nconst AttachmentPreview: FC<AttachmentPreviewProps> = ({ src }) => {\n  const [isLoaded, setIsLoaded] = useState(false);\n  return (\n    <Image\n      src={src}\n      alt=\"Image Preview\"\n      width={1}\n      height={1}\n      className={\n        isLoaded\n          ? \"aui-attachment-preview-image-loaded block h-auto max-h-[80vh] w-auto max-w-full object-contain\"\n          : \"aui-attachment-preview-image-loading hidden\"\n      }\n      onLoadingComplete={() => setIsLoaded(true)}\n      priority={false}\n    />\n  );\n};\n\nconst AttachmentPreviewDialog: FC<PropsWithChildren> = ({ children }) => {\n  const src = useAttachmentSrc();\n\n  if (!src) return children;\n\n  return (\n    <Dialog>\n      <DialogTrigger\n        className=\"aui-attachment-preview-trigger cursor-pointer transition-colors hover:bg-accent/50\"\n        asChild\n      >\n        {children}\n      </DialogTrigger>\n      <DialogContent className=\"aui-attachment-preview-dialog-content p-2 sm:max-w-3xl [&_svg]:text-background [&>button]:rounded-full [&>button]:bg-foreground/60 [&>button]:p-1 [&>button]:opacity-100 [&>button]:!ring-0 [&>button]:hover:[&_svg]:text-destructive\">\n        <DialogTitle className=\"aui-sr-only sr-only\">\n          Image Attachment Preview\n        </DialogTitle>\n        <div className=\"aui-attachment-preview relative mx-auto flex max-h-[80dvh] w-full items-center justify-center overflow-hidden bg-background\">\n          <AttachmentPreview src={src} />\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nconst AttachmentThumb: FC = () => {\n  const isImage = useAssistantState(\n    ({ attachment }) => attachment.type === \"image\",\n  );\n  const src = useAttachmentSrc();\n\n  return (\n    <Avatar className=\"aui-attachment-tile-avatar h-full w-full rounded-none\">\n      <AvatarImage\n        src={src}\n        alt=\"Attachment preview\"\n        className=\"aui-attachment-tile-image object-cover\"\n      />\n      <AvatarFallback delayMs={isImage ? 200 : 0}>\n        <FileText className=\"aui-attachment-tile-fallback-icon size-8 text-muted-foreground\" />\n      </AvatarFallback>\n    </Avatar>\n  );\n};\n\nconst AttachmentUI: FC = () => {\n  const api = useAssistantApi();\n  const isComposer = api.attachment.source === \"composer\";\n\n  const isImage = useAssistantState(\n    ({ attachment }) => attachment.type === \"image\",\n  );\n  const typeLabel = useAssistantState(({ attachment }) => {\n    const type = attachment.type;\n    switch (type) {\n      case \"image\":\n        return \"Image\";\n      case \"document\":\n        return \"Document\";\n      case \"file\":\n        return \"File\";\n      default:\n        const _exhaustiveCheck: never = type;\n        throw new Error(`Unknown attachment type: ${_exhaustiveCheck}`);\n    }\n  });\n\n  return (\n    <Tooltip>\n      <AttachmentPrimitive.Root\n        className={cn(\n          \"aui-attachment-root relative\",\n          isImage &&\n            \"aui-attachment-root-composer only:[&>#attachment-tile]:size-24\",\n        )}\n      >\n        <AttachmentPreviewDialog>\n          <TooltipTrigger asChild>\n            <div\n              className={cn(\n                \"aui-attachment-tile size-14 cursor-pointer overflow-hidden rounded-[14px] border bg-muted transition-opacity hover:opacity-75\",\n                isComposer &&\n                  \"aui-attachment-tile-composer border-foreground/20\",\n              )}\n              role=\"button\"\n              id=\"attachment-tile\"\n              aria-label={`${typeLabel} attachment`}\n            >\n              <AttachmentThumb />\n            </div>\n          </TooltipTrigger>\n        </AttachmentPreviewDialog>\n        {isComposer && <AttachmentRemove />}\n      </AttachmentPrimitive.Root>\n      <TooltipContent side=\"top\">\n        <AttachmentPrimitive.Name />\n      </TooltipContent>\n    </Tooltip>\n  );\n};\n\nconst AttachmentRemove: FC = () => {\n  return (\n    <AttachmentPrimitive.Remove asChild>\n      <TooltipIconButton\n        tooltip=\"Remove file\"\n        className=\"aui-attachment-tile-remove absolute top-1.5 right-1.5 size-3.5 rounded-full bg-white text-muted-foreground opacity-100 shadow-sm hover:!bg-white [&_svg]:text-black hover:[&_svg]:text-destructive\"\n        side=\"top\"\n      >\n        <XIcon className=\"aui-attachment-remove-icon size-3 dark:stroke-[2.5px]\" />\n      </TooltipIconButton>\n    </AttachmentPrimitive.Remove>\n  );\n};\n\nexport const UserMessageAttachments: FC = () => {\n  return (\n    <div className=\"aui-user-message-attachments-end col-span-full col-start-1 row-start-1 flex w-full flex-row justify-end gap-2\">\n      <MessagePrimitive.Attachments components={{ Attachment: AttachmentUI }} />\n    </div>\n  );\n};\n\nexport const ComposerAttachments: FC = () => {\n  return (\n    <div className=\"aui-composer-attachments mb-2 flex w-full flex-row items-center gap-2 overflow-x-auto px-1.5 pt-0.5 pb-1 empty:hidden\">\n      <ComposerPrimitive.Attachments\n        components={{ Attachment: AttachmentUI }}\n      />\n    </div>\n  );\n};\n\nexport const ComposerAddAttachment: FC = () => {\n  return (\n    <ComposerPrimitive.AddAttachment asChild>\n      <TooltipIconButton\n        tooltip=\"Add Attachment\"\n        side=\"bottom\"\n        variant=\"ghost\"\n        size=\"icon\"\n        className=\"aui-composer-add-attachment size-[34px] rounded-full p-1 text-xs font-semibold hover:bg-muted-foreground/15 dark:border-muted-foreground/15 dark:hover:bg-muted-foreground/30\"\n        aria-label=\"Add Attachment\"\n      >\n        <PlusIcon className=\"aui-attachment-add-icon size-5 stroke-[1.5px]\" />\n      </TooltipIconButton>\n    </ComposerPrimitive.AddAttachment>\n  );\n};\n"
    }
  ],
  "dependencies": [
    "@assistant-ui/react",
    "lucide-react",
    "zustand"
  ],
  "registryDependencies": [
    "https://r.aomi.dev/assistant-tooltip-icon-button.json",
    "tooltip",
    "dialog",
    "avatar"
  ]
}