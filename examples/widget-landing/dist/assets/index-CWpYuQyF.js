(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function ge(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ae={exports:{}};(function(s){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(u,r,d){this.fn=u,this.context=r,this.once=d||!1}function a(u,r,d,p,y){if(typeof d!="function")throw new TypeError("The listener must be a function");var S=new i(d,p||u,y),C=t?t+r:r;return u._events[C]?u._events[C].fn?u._events[C]=[u._events[C],S]:u._events[C].push(S):(u._events[C]=S,u._eventsCount++),u}function c(u,r){--u._eventsCount===0?u._events=new n:delete u._events[r]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var r=[],d,p;if(this._eventsCount===0)return r;for(p in d=this._events)e.call(d,p)&&r.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(d)):r},l.prototype.listeners=function(r){var d=t?t+r:r,p=this._events[d];if(!p)return[];if(p.fn)return[p.fn];for(var y=0,S=p.length,C=new Array(S);y<S;y++)C[y]=p[y].fn;return C},l.prototype.listenerCount=function(r){var d=t?t+r:r,p=this._events[d];return p?p.fn?1:p.length:0},l.prototype.emit=function(r,d,p,y,S,C){var w=t?t+r:r;if(!this._events[w])return!1;var m=this._events[w],x=arguments.length,_,T;if(m.fn){switch(m.once&&this.removeListener(r,m.fn,void 0,!0),x){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,d),!0;case 3:return m.fn.call(m.context,d,p),!0;case 4:return m.fn.call(m.context,d,p,y),!0;case 5:return m.fn.call(m.context,d,p,y,S),!0;case 6:return m.fn.call(m.context,d,p,y,S,C),!0}for(T=1,_=new Array(x-1);T<x;T++)_[T-1]=arguments[T];m.fn.apply(m.context,_)}else{var pe=m.length,P;for(T=0;T<pe;T++)switch(m[T].once&&this.removeListener(r,m[T].fn,void 0,!0),x){case 1:m[T].fn.call(m[T].context);break;case 2:m[T].fn.call(m[T].context,d);break;case 3:m[T].fn.call(m[T].context,d,p);break;case 4:m[T].fn.call(m[T].context,d,p,y);break;default:if(!_)for(P=1,_=new Array(x-1);P<x;P++)_[P-1]=arguments[P];m[T].fn.apply(m[T].context,_)}}return!0},l.prototype.on=function(r,d,p){return a(this,r,d,p,!1)},l.prototype.once=function(r,d,p){return a(this,r,d,p,!0)},l.prototype.removeListener=function(r,d,p,y){var S=t?t+r:r;if(!this._events[S])return this;if(!d)return c(this,S),this;var C=this._events[S];if(C.fn)C.fn===d&&(!y||C.once)&&(!p||C.context===p)&&c(this,S);else{for(var w=0,m=[],x=C.length;w<x;w++)(C[w].fn!==d||y&&!C[w].once||p&&C[w].context!==p)&&m.push(C[w]);m.length?this._events[S]=m.length===1?m[0]:m:c(this,S)}return this},l.prototype.removeAllListeners=function(r){var d;return r?(d=t?t+r:r,this._events[d]&&c(this,d)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,s.exports=l})(ae);var Ee=ae.exports,K=ge(Ee);const Z="400px",j="600px",k={1:"Ethereum",5:"Goerli",11155111:"Sepolia",100:"Gnosis",137:"Polygon",42161:"Arbitrum One",8453:"Base",10:"Optimism"},M={light:{primary:"#007bff",background:"#ffffff",surface:"#f8f9fa",text:"#212529",textSecondary:"#6c757d",border:"#dee2e6",success:"#28a745",error:"#dc3545",warning:"#ffc107",accent:"#6f42c1"},dark:{primary:"#0d6efd",background:"#121212",surface:"#1e1e1e",text:"#ffffff",textSecondary:"#b3b3b3",border:"#404040",success:"#00d26a",error:"#ff4757",warning:"#ffa500",accent:"#8b5cf6"},terminal:{primary:"#00ff00",background:"#0a0a0a",surface:"#161b22",text:"#00ff00",textSecondary:"#22c55e",border:"#30363d",success:"#00ff88",error:"#ff5555",warning:"#ffff55",accent:"#ff00ff"},neon:{primary:"#ff007f",background:"#0d0015",surface:"#1a0033",text:"#ffffff",textSecondary:"#cc99ff",border:"#4a0066",success:"#00ffaa",error:"#ff3366",warning:"#ffaa00",accent:"#00aaff"},minimal:{primary:"#000000",background:"#ffffff",surface:"#fafafa",text:"#333333",textSecondary:"#888888",border:"#e0e0e0",success:"#4caf50",error:"#f44336",warning:"#ff9800",accent:"#9c27b0"}},D={light:{name:"Light",palette:M.light,fonts:{primary:'"Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif',monospace:'"SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace'},spacing:{xs:"4px",sm:"8px",md:"16px",lg:"24px",xl:"32px"},borderRadius:{sm:"4px",md:"8px",lg:"12px"},shadows:{sm:"0 1px 3px rgba(0, 0, 0, 0.1)",md:"0 4px 12px rgba(0, 0, 0, 0.15)",lg:"0 8px 24px rgba(0, 0, 0, 0.2)"}},dark:{name:"Dark",palette:M.dark,fonts:{primary:'"Segoe UI", "Roboto", "Helvetica Neue", Arial, sans-serif',monospace:'"SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace'},spacing:{xs:"4px",sm:"8px",md:"16px",lg:"24px",xl:"32px"},borderRadius:{sm:"4px",md:"8px",lg:"12px"},shadows:{sm:"0 1px 3px rgba(0, 0, 0, 0.3)",md:"0 4px 12px rgba(0, 0, 0, 0.4)",lg:"0 8px 24px rgba(0, 0, 0, 0.5)"}},terminal:{name:"Terminal",palette:M.terminal,fonts:{primary:'"SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace',monospace:'"SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace'},spacing:{xs:"2px",sm:"4px",md:"8px",lg:"16px",xl:"24px"},borderRadius:{sm:"0px",md:"2px",lg:"4px"},shadows:{sm:"0 0 8px rgba(0, 255, 0, 0.3)",md:"0 0 16px rgba(0, 255, 0, 0.5)",lg:"0 0 24px rgba(0, 255, 0, 0.7)"}},neon:{name:"Neon",palette:M.neon,fonts:{primary:'"Orbitron", "Rajdhani", "Exo 2", sans-serif',monospace:'"Share Tech Mono", "Courier New", monospace'},spacing:{xs:"4px",sm:"8px",md:"16px",lg:"24px",xl:"32px"},borderRadius:{sm:"2px",md:"6px",lg:"10px"},shadows:{sm:"0 0 8px rgba(255, 0, 127, 0.4)",md:"0 0 16px rgba(255, 0, 127, 0.6)",lg:"0 0 24px rgba(255, 0, 127, 0.8)"}},minimal:{name:"Minimal",palette:M.minimal,fonts:{primary:'"Inter", "Helvetica Neue", Arial, sans-serif',monospace:'"JetBrains Mono", "SF Mono", monospace'},spacing:{xs:"4px",sm:"8px",md:"16px",lg:"24px",xl:"32px"},borderRadius:{sm:"2px",md:"4px",lg:"6px"},shadows:{sm:"0 1px 2px rgba(0, 0, 0, 0.05)",md:"0 2px 8px rgba(0, 0, 0, 0.1)",lg:"0 4px 16px rgba(0, 0, 0, 0.15)"}}},E={INVALID_CONFIG:"INVALID_CONFIG",MISSING_APP_CODE:"MISSING_APP_CODE",INVALID_THEME:"INVALID_THEME",INVALID_DIMENSIONS:"INVALID_DIMENSIONS",CONNECTION_FAILED:"CONNECTION_FAILED",CONNECTION_TIMEOUT:"CONNECTION_TIMEOUT",BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",AUTHENTICATION_FAILED:"AUTHENTICATION_FAILED",WALLET_NOT_CONNECTED:"WALLET_NOT_CONNECTED",WALLET_CONNECTION_FAILED:"WALLET_CONNECTION_FAILED",UNSUPPORTED_NETWORK:"UNSUPPORTED_NETWORK",TRANSACTION_FAILED:"TRANSACTION_FAILED",TRANSACTION_REJECTED:"TRANSACTION_REJECTED",MESSAGE_TOO_LONG:"MESSAGE_TOO_LONG",RATE_LIMITED:"RATE_LIMITED",INVALID_MESSAGE:"INVALID_MESSAGE",SESSION_EXPIRED:"SESSION_EXPIRED",UNKNOWN_ERROR:"UNKNOWN_ERROR",INITIALIZATION_FAILED:"INITIALIZATION_FAILED",PROVIDER_ERROR:"PROVIDER_ERROR"},h={READY:"ready",DESTROY:"destroy",RESIZE:"resize",MESSAGE:"message",TYPING_CHANGE:"typingChange",PROCESSING_CHANGE:"processingChange",CONNECTION_CHANGE:"connectionChange",SESSION_START:"sessionStart",SESSION_END:"sessionEnd",WALLET_CONNECT:"walletConnect",WALLET_DISCONNECT:"walletDisconnect",NETWORK_CHANGE:"networkChange",TRANSACTION_REQUEST:"transactionRequest",ERROR:"error"},o={WIDGET_ROOT:"aomi-chat-widget",WIDGET_CONTAINER:"aomi-chat-container",THEME_LIGHT:"aomi-theme-light",THEME_DARK:"aomi-theme-dark",THEME_TERMINAL:"aomi-theme-terminal",THEME_NEON:"aomi-theme-neon",THEME_MINIMAL:"aomi-theme-minimal",MODE_FULL:"aomi-mode-full",MODE_MINIMAL:"aomi-mode-minimal",MODE_COMPACT:"aomi-mode-compact",MODE_TERMINAL:"aomi-mode-terminal",CHAT_INTERFACE:"aomi-chat-interface",CHAT_HEADER:"aomi-chat-header",CHAT_TITLE:"aomi-chat-title",CHAT_BODY:"aomi-chat-body",STATUS_BADGE:"aomi-status-badge",MESSAGE_LIST:"aomi-message-list",MESSAGE_BUBBLE:"aomi-message",MESSAGE_USER:"aomi-message-user",MESSAGE_ASSISTANT:"aomi-message-assistant",MESSAGE_SYSTEM:"aomi-message-system",ACTION_BAR:"aomi-action-bar",MESSAGE_INPUT:"aomi-message-input",INPUT_FORM:"aomi-chat-input-form",INPUT_FIELD:"aomi-chat-input-field",SEND_BUTTON:"aomi-chat-send-button",WALLET_STATUS:"aomi-wallet-status",TYPING_INDICATOR:"aomi-typing-indicator",LOADING:"aomi-loading",ERROR:"aomi-error",DISABLED:"aomi-disabled",CONNECTED:"aomi-connected",DISCONNECTED:"aomi-disconnected"},H={CHAT:"/api/chat",CHAT_STREAM:"/api/chat/stream",STATE:"/api/state",INTERRUPT:"/api/interrupt",SYSTEM:"/api/system",MCP_COMMAND:"/api/mcp-command",HEALTH:"/health"},Y={TYPING_INDICATOR_DELAY:100,MESSAGE_ANIMATION_DURATION:300,CONNECTION_TIMEOUT:1e4,RETRY_DELAY:1e3,HEARTBEAT_INTERVAL:3e4,SESSION_TIMEOUT:36e5};class b extends Error{constructor(e,t,n){super(t),this.name="AomiChatError",this.code=e,this.timestamp=new Date,this.details=n,Error.captureStackTrace&&Error.captureStackTrace(this,b)}toJSON(){return{name:this.name,code:this.code,message:this.message,timestamp:this.timestamp.toISOString(),details:this.details,stack:this.stack}}toString(){return`${this.name} [${this.code}]: ${this.message}`}}class fe extends b{constructor(e,t){super(E.INVALID_CONFIG,e,t),this.name="ConfigurationError"}}class Ce extends b{constructor(e,t){super(E.CONNECTION_FAILED,e,t),this.name="ConnectionError"}}class re extends b{constructor(e,t,n){super(e,t,n),this.name="WalletError"}}class Te extends re{constructor(e,t){super(E.TRANSACTION_FAILED,e,t),this.name="TransactionError"}}class Ne extends b{constructor(e,t,n){super(e,t,n),this.name="ChatError"}}function O(s,e){return new fe(s,e)}function L(s,e){return new Ce(s,e)}function I(s,e,t){return new re(s,e,t)}function R(s,e){return new Te(s,e)}function v(s,e,t){return new Ne(s,e,t)}var J;(function(s){s.LOW="low",s.MEDIUM="medium",s.HIGH="high",s.CRITICAL="critical"})(J||(J={}));var Q;(function(s){s.RETRY="retry",s.RECONNECT="reconnect",s.REFRESH="refresh",s.FALLBACK="fallback",s.MANUAL="manual",s.NONE="none"})(Q||(Q={}));var f;(function(s){s.CONNECTING="connecting",s.CONNECTED="connected",s.DISCONNECTED="disconnected",s.ERROR="error",s.RECONNECTING="reconnecting"})(f||(f={}));var g;(function(s){s.INITIALIZING="initializing",s.CONNECTING_MCP="connecting_mcp",s.VALIDATING_ANTHROPIC="validating_anthropic",s.READY="ready",s.MISSING_API_KEY="missing_api_key",s.ERROR="error"})(g||(g={}));function oe(s){const e=[];if((!s.appCode||typeof s.appCode!="string")&&e.push("appCode is required and must be a string"),s.width&&!X(s.width)&&e.push('width must be a valid CSS dimension (e.g., "400px", "100%")'),s.height&&!X(s.height)&&e.push('height must be a valid CSS dimension (e.g., "600px", "100vh")'),s.maxHeight&&(typeof s.maxHeight!="number"||s.maxHeight<=0)&&e.push("maxHeight must be a positive number"),s.chainId&&!Object.keys(k).includes(s.chainId.toString())&&e.push(`chainId must be one of: ${Object.keys(k).join(", ")}`),s.supportedChains){const t=s.supportedChains.filter(n=>!Object.keys(k).includes(n.toString()));t.length>0&&e.push(`supportedChains contains invalid chain IDs: ${t.join(", ")}`)}return s.theme&&!Se(s.theme)&&e.push("theme must be a valid theme name or theme palette object"),s.mode&&!["full","minimal","compact","terminal"].includes(s.mode)&&e.push("mode must be one of: full, minimal, compact, terminal"),e}function X(s){return/^(\d+(\.\d+)?(px|%|em|rem|vh|vw)|auto|inherit)$/.test(s)}function Se(s){return typeof s=="string"?Object.keys(D).includes(s):typeof s=="object"&&s!==null?"baseTheme"in s&&typeof s.baseTheme=="string":!1}function ce(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)})}function N(s,e={}){const t=document.createElement(s);return e.className&&(Array.isArray(e.className)?t.classList.add(...e.className):t.className=e.className),e.attributes&&Object.entries(e.attributes).forEach(([n,i])=>{t.setAttribute(n,i)}),e.styles&&Object.assign(t.style,e.styles),e.children&&e.children.forEach(n=>{typeof n=="string"?t.appendChild(document.createTextNode(n)):t.appendChild(n)}),t}function B(s){return typeof s!="string"?!1:/^0x[a-fA-F0-9]{40}$/.test(s)}function ye(s){return typeof s!="string"?!1:/^0x[a-fA-F0-9]{64}$/.test(s)}function ee(s,e){return Promise.race([s,new Promise((t,n)=>setTimeout(()=>n(new Error("Operation timed out")),e))])}function F(){return typeof window<"u"&&typeof document<"u"}function Ie(s){const t=new Date().getTime()-s.getTime();if(t<6e4)return"just now";if(t<36e5){const n=Math.floor(t/6e4);return`${n} minute${n>1?"s":""} ago`}else if(t<864e5){const n=Math.floor(t/36e5);return`${n} hour${n>1?"s":""} ago`}else return s.toLocaleDateString()}function te(s,e=6,t=4){return!B(s)||s.length<=e+t?s:`${s.slice(0,e)}...${s.slice(-t)}`}class be extends K{constructor(e={}){super(),this.eventSource=null,this.reconnectAttempt=0,this.reconnectTimer=null,this.heartbeatTimer=null,this.lastPendingTransactionRaw=null,this.config={backendUrl:e.backendUrl||"http://localhost:8080",sessionId:e.sessionId||ce(),maxMessageLength:e.maxMessageLength||2e3,reconnectAttempts:e.reconnectAttempts||5,reconnectDelay:e.reconnectDelay||3e3,...e},this.state={messages:[],isTyping:!1,isProcessing:!1,connectionStatus:f.DISCONNECTED,readiness:{phase:g.INITIALIZING},walletState:{isConnected:!1},sessionId:this.config.sessionId}}getState(){return{...this.state}}getSessionId(){return this.config.sessionId}setSessionId(e){this.config.sessionId=e,this.state.sessionId=e,this.state.connectionStatus===f.CONNECTED&&this.connectSSE()}async connectSSE(){this.setConnectionStatus(f.CONNECTING),this.setReadiness({phase:g.CONNECTING_MCP}),this.disconnectSSE();try{const e=`${this.config.backendUrl}${H.CHAT_STREAM}?session_id=${this.config.sessionId}`;this.eventSource=new EventSource(e),this.eventSource.onopen=()=>{console.log("ðŸŒ SSE connection opened:",e),this.setConnectionStatus(f.CONNECTED),this.reconnectAttempt=0,this.startHeartbeat(),this.refreshState().catch(t=>{console.warn("Failed to refresh chat state after opening SSE connection:",t)})},this.eventSource.onmessage=t=>{try{const n=JSON.parse(t.data);this.updateChatState(n)}catch(n){console.error("Failed to parse SSE message:",n),this.emit("error",v(E.INVALID_MESSAGE,"Invalid message format"))}},this.eventSource.onerror=t=>{console.error("SSE connection error:",t),this.handleConnectionError()}}catch(e){console.error("Failed to create SSE connection:",e),this.emit("error",L("Failed to establish connection")),this.handleConnectionError()}}disconnectSSE(){this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.stopHeartbeat(),this.clearReconnectTimer(),this.setConnectionStatus(f.DISCONNECTED)}async refreshState(){try{const e=await ee(fetch(`${this.config.backendUrl}${H.STATE}?session_id=${this.config.sessionId}`,{method:"GET"}),Y.CONNECTION_TIMEOUT);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const t=await e.json();this.updateChatState(t)}catch(e){console.warn("Failed to fetch chat state:",e)}}async sendMessage(e){const t=e.trim();if(!t)throw v(E.INVALID_MESSAGE,"Message cannot be empty");if(t.length>this.config.maxMessageLength)throw v(E.MESSAGE_TOO_LONG,`Message exceeds ${this.config.maxMessageLength} characters`);if(this.state.connectionStatus!==f.CONNECTED)throw L("Not connected to backend");if(this.state.readiness.phase!==g.READY)throw v(E.INVALID_CONFIG,"Backend is not ready to accept messages");if(this.state.isProcessing)throw v(E.RATE_LIMITED,"Previous message is still being processed");try{const n=await this.postToBackend(H.CHAT,{message:t,session_id:this.config.sessionId});this.updateChatState(n)}catch(n){throw console.error("Failed to send message:",n),v(E.UNKNOWN_ERROR,"Failed to send message")}}async sendSystemMessage(e){try{const t=await this.postToBackend(H.SYSTEM,{message:e,session_id:this.config.sessionId});this.updateChatState(t)}catch(t){throw console.error("Failed to send system message:",t),v(E.UNKNOWN_ERROR,"Failed to send system message")}}async interrupt(){try{const e=await this.postToBackend(H.INTERRUPT,{session_id:this.config.sessionId});this.updateChatState(e)}catch(e){throw console.error("Failed to interrupt:",e),v(E.UNKNOWN_ERROR,"Failed to interrupt processing")}}async sendTransactionResult(e,t,n){try{await this.sendSystemMessage(`Transaction ${e?"completed":"failed"}${t?`: ${t}`:""}${n?` (${n})`:""}`)}catch(i){console.error("Failed to send transaction result:",i)}}clearMessages(){this.state.messages=[],this.emitStateChange()}updateWalletState(e){this.state.walletState={...this.state.walletState,...e},this.emitStateChange()}destroy(){this.disconnectSSE(),this.removeAllListeners()}updateChatState(e){if(!e)return;const t=this.state.messages.slice();let n=!1;if(Array.isArray(e.messages)){const l=e.messages.filter(r=>!!r).map((r,d)=>this.convertBackendMessage(r,d));this.state.messages=l,n=!0,!this.state.isTyping&&l.some(r=>{var d;return(d=r.metadata)==null?void 0:d.streaming})&&(this.state.isTyping=!0,n=!0);const u=new Set(t.map(r=>r.id));l.forEach(r=>{u.has(r.id)||this.emit("message",r)})}const i=this.resolveBoolean(e.isTyping??e.is_typing);i!==null&&i!==this.state.isTyping&&(this.state.isTyping=i,n=!0);const a=this.resolveBoolean(e.isProcessing??e.is_processing);a!==null&&a!==this.state.isProcessing&&(this.state.isProcessing=a,n=!0);const c=this.normalizeReadiness(e);if(c&&(c.phase!==this.state.readiness.phase||c.detail!==this.state.readiness.detail)&&(this.state.readiness=c,n=!0),"pending_wallet_tx"in e){const l=e.pending_wallet_tx??null;if(l===null)this.state.pendingTransaction&&(this.state.pendingTransaction=void 0,this.lastPendingTransactionRaw=null,n=!0);else if(l!==this.lastPendingTransactionRaw){this.lastPendingTransactionRaw=l;try{const u=JSON.parse(l);this.state.pendingTransaction=u,n=!0,this.emit("transactionRequest",u)}catch(u){console.error("Failed to parse wallet transaction request:",u)}}}n&&this.emitStateChange()}convertBackendMessage(e,t){const n=e.sender==="user"?"user":e.sender==="system"?"system":"assistant",i=e.timestamp?new Date(e.timestamp):new Date,a=Number.isNaN(i.valueOf())?new Date:i;return{id:`${e.timestamp||`${n}-${t}`}-${t}`,type:n,content:e.content??"",timestamp:a,metadata:{streaming:!!e.is_streaming}}}resolveBoolean(e){return typeof e=="boolean"?e:typeof e=="string"?e.toLowerCase()==="true":null}normalizeReadiness(e){const t=e.readiness;if(t&&typeof t.phase=="string"){const n=this.mapReadinessPhase(t.phase),i=typeof t.detail=="string"&&t.detail.trim().length>0?t.detail:typeof t.message=="string"&&t.message.trim().length>0?t.message:void 0;return{phase:n,detail:i}}return this.resolveBoolean(e.missingApiKey??e.missing_api_key)?{phase:g.MISSING_API_KEY}:this.resolveBoolean(e.isLoading??e.is_loading)?{phase:g.VALIDATING_ANTHROPIC}:this.resolveBoolean(e.isConnectingMcp??e.is_connecting_mcp)?{phase:g.CONNECTING_MCP}:null}mapReadinessPhase(e){switch(e){case"connecting_mcp":return g.CONNECTING_MCP;case"validating_anthropic":return g.VALIDATING_ANTHROPIC;case"ready":return g.READY;case"missing_api_key":return g.MISSING_API_KEY;case"error":return g.ERROR;default:return g.ERROR}}setConnectionStatus(e){this.state.connectionStatus!==e&&(this.state.connectionStatus=e,this.emit("connectionChange",e),this.emitStateChange())}setReadiness(e){this.state.readiness=e,this.emitStateChange()}emitStateChange(){this.emit("stateChange",this.getState())}async postToBackend(e,t){const n=`${this.config.backendUrl}${e}`;try{const i=await ee(fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),Y.CONNECTION_TIMEOUT);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return await i.json()}catch(i){throw i instanceof Error&&i.message.includes("timed out")?L("Request timed out"):L(`Request failed: ${i}`)}}handleConnectionError(){this.setConnectionStatus(f.ERROR),this.stopHeartbeat(),this.reconnectAttempt<this.config.reconnectAttempts?this.scheduleReconnect():(this.setReadiness({phase:g.ERROR,detail:"Connection lost"}),this.setConnectionStatus(f.DISCONNECTED),this.emit("error",L("Max reconnection attempts reached")))}scheduleReconnect(){this.clearReconnectTimer(),this.setConnectionStatus(f.RECONNECTING),this.setReadiness({phase:g.CONNECTING_MCP});const e=this.config.reconnectDelay*Math.pow(2,this.reconnectAttempt);this.reconnectAttempt++,console.log(`Scheduling reconnect attempt ${this.reconnectAttempt} in ${e}ms`),this.reconnectTimer=setTimeout(()=>{this.connectSSE().catch(t=>{console.error("Reconnection attempt failed:",t)})},e)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}startHeartbeat(){this.stopHeartbeat(),this.heartbeatTimer=setInterval(()=>{this.state.connectionStatus===f.CONNECTED&&this.eventSource&&this.eventSource.readyState!==EventSource.OPEN&&(console.warn("SSE connection lost, attempting to reconnect"),this.handleConnectionError())},Y.HEARTBEAT_INTERVAL)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}}class we{constructor(e){this.customPalette=null,this.currentTheme=this.resolveTheme(e)}updateTheme(e){this.currentTheme=this.resolveTheme(e),this.customPalette=this.isCustomPalette(e)?e:null}getComputedTheme(){return this.customPalette?{...this.currentTheme,palette:this.customPalette}:this.currentTheme}getColor(e){return this.getComputedTheme().palette[e]||M.light[e]}getThemeClass(){var t;switch(((t=this.customPalette)==null?void 0:t.baseTheme)||this.getBaseThemeName()){case"light":return o.THEME_LIGHT;case"dark":return o.THEME_DARK;case"terminal":return o.THEME_TERMINAL;case"neon":return o.THEME_NEON;case"minimal":return o.THEME_MINIMAL;default:return o.THEME_LIGHT}}getFontFamily(){var e;return((e=this.currentTheme.fonts)==null?void 0:e.primary)||"system-ui, sans-serif"}getMonospaceFontFamily(){var e;return((e=this.currentTheme.fonts)==null?void 0:e.monospace)||"monospace"}getSpacing(e){var t;return((t=this.currentTheme.spacing)==null?void 0:t[e])||"8px"}getBorderRadius(e){var t;return((t=this.currentTheme.borderRadius)==null?void 0:t[e])||"4px"}getShadow(e){var t;return((t=this.currentTheme.shadows)==null?void 0:t[e])||"none"}getCSSCustomProperties(){var n,i;const e=this.getComputedTheme(),t={};return Object.entries(e.palette).forEach(([a,c])=>{t[`--aomi-color-${a}`]=c}),(n=e.fonts)!=null&&n.primary&&(t["--aomi-font-primary"]=e.fonts.primary),(i=e.fonts)!=null&&i.monospace&&(t["--aomi-font-monospace"]=e.fonts.monospace),e.spacing&&Object.entries(e.spacing).forEach(([a,c])=>{t[`--aomi-spacing-${a}`]=c}),e.borderRadius&&Object.entries(e.borderRadius).forEach(([a,c])=>{t[`--aomi-radius-${a}`]=c}),e.shadows&&Object.entries(e.shadows).forEach(([a,c])=>{t[`--aomi-shadow-${a}`]=c}),t}applyThemeToElement(e){const t=this.getCSSCustomProperties();Object.entries(t).forEach(([n,i])=>{e.style.setProperty(n,i)}),e.classList.add(this.getThemeClass())}generateCSS(e=".aomi-chat-widget"){const t=this.getCSSCustomProperties(),n=[],i=Object.entries(t).map(([a,c])=>`  ${a}: ${c};`).join(`
`);return n.push(`${e} {
${i}
}`),n.push(this.generateComponentCSS(e)),n.join(`

`)}destroy(){}resolveTheme(e){if(!e)return D.light;if(typeof e=="string"){const t=D[e];if(!t)throw O(`Unknown theme: ${e}`);return t}if(this.isCustomPalette(e)){const t=D[e.baseTheme];if(!t)throw O(`Unknown base theme: ${e.baseTheme}`);return{...t,palette:{primary:e.primary,background:e.background,surface:e.surface,text:e.text,textSecondary:e.textSecondary,border:e.border,success:e.success,error:e.error,warning:e.warning,accent:e.accent}}}throw O("Invalid theme configuration")}isCustomPalette(e){if(typeof e!="object"||e===null)return!1;const t=e;return typeof t.baseTheme=="string"&&typeof t.primary=="string"&&typeof t.background=="string"&&typeof t.surface=="string"&&typeof t.text=="string"&&typeof t.textSecondary=="string"&&typeof t.border=="string"&&typeof t.success=="string"&&typeof t.error=="string"&&typeof t.warning=="string"&&typeof t.accent=="string"}getBaseThemeName(){for(const[e,t]of Object.entries(D))if(this.isPaletteEqual(t.palette,this.currentTheme.palette))return e;return"light"}isPaletteEqual(e,t){return Object.keys(e).every(i=>e[i]===t[i])}generateComponentCSS(e){return`
/* Chat Interface */
${e} .${o.CHAT_INTERFACE} {
  background-color: var(--aomi-color-background);
  color: var(--aomi-color-text);
  border: 1px solid var(--aomi-color-border);
  border-radius: var(--aomi-radius-md);
  font-family: var(--aomi-font-primary);
}

/* Message List */
${e} .${o.MESSAGE_LIST} {
  padding: var(--aomi-spacing-md);
  overflow-y: auto;
}

/* Message Input */
${e} .${o.MESSAGE_INPUT} {
  background-color: var(--aomi-color-surface);
  border: 1px solid var(--aomi-color-border);
  border-radius: var(--aomi-radius-sm);
  color: var(--aomi-color-text);
  padding: var(--aomi-spacing-sm);
  font-family: var(--aomi-font-primary);
}

${e} .${o.MESSAGE_INPUT}:focus {
  outline: none;
  border-color: var(--aomi-color-primary);
  box-shadow: 0 0 0 2px var(--aomi-color-primary)25;
}

/* Wallet Status */
${e} .${o.WALLET_STATUS} {
  background-color: var(--aomi-color-surface);
  color: var(--aomi-color-textSecondary);
  padding: var(--aomi-spacing-sm);
  border-radius: var(--aomi-radius-sm);
  font-size: 12px;
}

${e} .${o.WALLET_STATUS}.${o.CONNECTED} {
  color: var(--aomi-color-success);
}

${e} .${o.WALLET_STATUS}.${o.DISCONNECTED} {
  color: var(--aomi-color-error);
}

/* Typing Indicator */
${e} .${o.TYPING_INDICATOR} {
  color: var(--aomi-color-textSecondary);
  font-style: italic;
  padding: var(--aomi-spacing-sm);
}

/* State Classes */
${e}.${o.LOADING} {
  opacity: 0.7;
  pointer-events: none;
}

${e}.${o.ERROR} {
  border-color: var(--aomi-color-error);
}

${e}.${o.DISABLED} {
  opacity: 0.5;
  pointer-events: none;
}

/* Terminal Theme Specific */
${e}.${o.THEME_TERMINAL} {
  font-family: var(--aomi-font-monospace);
  background-color: var(--aomi-color-background);
}

${e}.${o.THEME_TERMINAL} .${o.CHAT_INTERFACE} {
  border: 1px solid var(--aomi-color-primary);
  box-shadow: var(--aomi-shadow-md);
}

/* Neon Theme Specific */
${e}.${o.THEME_NEON} {
  background: linear-gradient(135deg, var(--aomi-color-background), var(--aomi-color-surface));
}

${e}.${o.THEME_NEON} .${o.CHAT_INTERFACE} {
  border: 1px solid var(--aomi-color-primary);
  box-shadow: 0 0 20px var(--aomi-color-primary)50;
}`}}class ne extends K{constructor(e){super(),this.currentAccount=null,this.currentChainId=null,this.isConnected=!1,this.provider=e,this.setupEventListeners(),this.initializeState()}getCurrentAccount(){return this.currentAccount}getCurrentChainId(){return this.currentChainId}getCurrentNetworkName(){return this.currentChainId?k[this.currentChainId]||"Unknown Network":null}getIsConnected(){return this.isConnected}async connect(){try{const e=await this.provider.request({id:Date.now(),method:"eth_requestAccounts",params:[]});if(!e||e.length===0)throw I(E.WALLET_CONNECTION_FAILED,"No accounts returned from wallet");const t=e[0];if(!B(t))throw I(E.WALLET_CONNECTION_FAILED,"Invalid account address");return this.currentAccount=t,this.isConnected=!0,await this.updateChainId(),this.emit("connect",t),t}catch(e){const t=e instanceof Error?I(E.WALLET_CONNECTION_FAILED,e.message):I(E.WALLET_CONNECTION_FAILED,"Unknown error");throw this.emit("error",t),t}}disconnect(){this.currentAccount=null,this.currentChainId=null,this.isConnected=!1,this.emit("disconnect")}async switchNetwork(e){try{await this.provider.request({id:Date.now(),method:"wallet_switchEthereumChain",params:[{chainId:`0x${e.toString(16)}`}]})}catch(t){if(t.code===4902)await this.addNetwork(e);else throw I(E.UNSUPPORTED_NETWORK,`Failed to switch to network ${e}: ${t.message}`)}}async sendTransaction(e){if(!this.isConnected||!this.currentAccount)throw I(E.WALLET_NOT_CONNECTED,"Wallet is not connected");try{this.validateTransaction(e);const t={from:this.currentAccount,to:e.to,value:e.value,data:e.data};e.gas&&(t.gas=e.gas);const n=await this.provider.request({id:Date.now(),method:"eth_sendTransaction",params:[t]});if(!ye(n))throw R("Invalid transaction hash returned");return n}catch(t){if(t.code===4001)throw I(E.TRANSACTION_REJECTED,"Transaction was rejected by user");const n=t.message||"Transaction failed";throw R(n)}}async signMessage(e){if(!this.isConnected||!this.currentAccount)throw I(E.WALLET_NOT_CONNECTED,"Wallet is not connected");try{return await this.provider.request({id:Date.now(),method:"personal_sign",params:[e,this.currentAccount]})}catch(t){throw t.code===4001?I(E.TRANSACTION_REJECTED,"Message signing was rejected by user"):I(E.UNKNOWN_ERROR,`Failed to sign message: ${t.message}`)}}async getBalance(e){const t=e||this.currentAccount;if(!t)throw I(E.WALLET_NOT_CONNECTED,"No account available");try{return await this.provider.request({id:Date.now(),method:"eth_getBalance",params:[t,"latest"]})}catch(n){throw I(E.UNKNOWN_ERROR,`Failed to get balance: ${n.message}`)}}updateProvider(e){this.removeProviderListeners(),this.provider=e,this.setupEventListeners(),this.initializeState()}destroy(){this.removeProviderListeners(),this.disconnect(),this.removeAllListeners()}async initializeState(){try{const e=await this.provider.request({id:Date.now(),method:"eth_accounts",params:[]});e&&e.length>0&&B(e[0])&&(this.currentAccount=e[0],this.isConnected=!0,await this.updateChainId(),this.emit("connect",e[0]))}catch(e){console.warn("Failed to initialize wallet state:",e)}}async updateChainId(){try{const e=await this.provider.request({id:Date.now(),method:"eth_chainId",params:[]}),t=parseInt(e,16);this.currentChainId!==t&&(this.currentChainId=t,this.emit("chainChange",t))}catch(e){console.warn("Failed to get chain ID:",e)}}setupEventListeners(){this.provider.on&&(this.provider.on("accountsChanged",this.handleAccountsChanged.bind(this)),this.provider.on("chainChanged",this.handleChainChanged.bind(this)),this.provider.on("disconnect",this.handleDisconnect.bind(this)))}removeProviderListeners(){var e,t,n,i;this.provider.removeListener&&((t=(e=this.provider).removeListener)==null||t.call(e,"accountsChanged",this.handleAccountsChanged.bind(this)),(i=(n=this.provider).removeListener)==null||i.call(n,"chainChanged",this.handleChainChanged.bind(this)),this.provider.removeListener("disconnect",this.handleDisconnect.bind(this)))}handleAccountsChanged(e){!e||e.length===0?this.disconnect():e[0]!==this.currentAccount&&(this.currentAccount=e[0],this.isConnected=!0,this.emit("accountsChange",e),this.emit("connect",e[0]))}handleChainChanged(e){const t=parseInt(e,16);this.currentChainId=t,this.emit("chainChange",t)}handleDisconnect(){this.disconnect()}validateTransaction(e){if(!B(e.to))throw R("Invalid recipient address");if(!/^0x[0-9a-fA-F]*$/.test(e.value))throw R("Invalid transaction value");if(e.data&&!/^0x[0-9a-fA-F]*$/.test(e.data))throw R("Invalid transaction data");if(e.gas&&!/^0x[0-9a-fA-F]*$/.test(e.gas))throw R("Invalid gas value")}async addNetwork(e){const t=this.getNetworkConfig(e);if(!t)throw I(E.UNSUPPORTED_NETWORK,`Network ${e} is not supported`);try{await this.provider.request({id:Date.now(),method:"wallet_addEthereumChain",params:[t]})}catch(n){throw I(E.UNSUPPORTED_NETWORK,`Failed to add network ${e}: ${n.message}`)}}getNetworkConfig(e){return{1:null,5:null,11155111:null,100:{chainId:"0x64",chainName:"Gnosis",nativeCurrency:{name:"xDai",symbol:"XDAI",decimals:18},rpcUrls:["https://rpc.gnosischain.com"],blockExplorerUrls:["https://gnosisscan.io"]},137:{chainId:"0x89",chainName:"Polygon",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},rpcUrls:["https://polygon-rpc.com"],blockExplorerUrls:["https://polygonscan.com"]},42161:{chainId:"0xa4b1",chainName:"Arbitrum One",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:["https://arb1.arbitrum.io/rpc"],blockExplorerUrls:["https://arbiscan.io"]},8453:{chainId:"0x2105",chainName:"Base",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:["https://mainnet.base.org"],blockExplorerUrls:["https://basescan.org"]},10:{chainId:"0xa",chainName:"Optimism",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:["https://mainnet.optimism.io"],blockExplorerUrls:["https://optimistic.etherscan.io"]}}[e]}}class Ae{constructor(e,t){this.walletManager=null,this.widgetElement=null,this.statusBadgeElement=null,this.messageListElement=null,this.typingIndicatorElement=null,this.inputFormElement=null,this.messageInputElement=null,this.sendButtonElement=null,this.walletStatusElement=null,this.isDestroyed=!1,this.lastState=null,this.isSending=!1,this.hasAnnouncedConnection=!1,this.isWalletActionPending=!1,this.activeSessionId=null,this.chatInterfaceElement=null,this.chatBodyElement=null,this.layoutResizeObserver=null,this.layoutResizeListener=null,this.layoutMeasurementFrame=null,this.eventEmitter=new K,this.container=e,this.config=t,this.chatManager=new be({backendUrl:t.params.baseUrl||"http://localhost:8080",sessionId:t.params.sessionId||ce(),maxMessageLength:2e3,reconnectAttempts:5,reconnectDelay:3e3}),this.themeManager=new we(t.params.theme),t.provider&&(this.walletManager=new ne(t.provider)),this.setupEventListeners(),this.registerConfigListeners(),this.render(),this.initialize(),this.updateStateView(this.chatManager.getState())}async sendMessage(e){if(this.isDestroyed)throw new b(E.INITIALIZATION_FAILED,"Widget has been destroyed");return this.chatManager.sendMessage(e)}updateParams(e){if(this.isDestroyed)throw new b(E.INITIALIZATION_FAILED,"Widget has been destroyed");const t={...this.config.params,...e},n=oe(t);if(n.length>0)throw O(`Invalid parameters: ${n.join(", ")}`);this.config.params=t,e.theme&&(this.themeManager.updateTheme(e.theme),this.applyTheme()),(e.width||e.height)&&this.updateDimensions(),this.render()}updateProvider(e){if(this.isDestroyed)throw new b(E.INITIALIZATION_FAILED,"Widget has been destroyed");this.config.provider=e,e?this.walletManager?this.walletManager.updateProvider(e):(this.walletManager=new ne(e),this.setupWalletEventListeners()):this.walletManager&&(this.walletManager.destroy(),this.walletManager=null)}getState(){return this.chatManager.getState()}getSessionId(){return this.chatManager.getSessionId()}isReady(){return this.getState().connectionStatus===f.CONNECTED}on(e,t){const n=this.getEventNameForListener(e);return this.eventEmitter.on(n,t),this}off(e,t){const n=this.getEventNameForListener(e);return this.eventEmitter.off(n,t),this}clearChat(){this.isDestroyed||this.chatManager.clearMessages()}exportChat(){return this.getState().messages}resize(e,t){this.isDestroyed||(e&&(this.config.params.width=e),t&&(this.config.params.height=t),this.updateDimensions(),this.eventEmitter.emit(h.RESIZE,{width:parseInt(e||this.config.params.width||"0"),height:parseInt(t||this.config.params.height||"0")}))}focus(){if(this.isDestroyed||!this.widgetElement)return;const e=this.widgetElement.querySelector("input, textarea");e&&e.focus()}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.teardownLayoutObservers(),this.chatManager.destroy(),this.themeManager.destroy(),this.walletManager&&this.walletManager.destroy(),this.widgetElement&&this.widgetElement.parentNode&&this.widgetElement.parentNode.removeChild(this.widgetElement),this.container.innerHTML="",this.activeSessionId&&(this.eventEmitter.emit(h.SESSION_END,this.activeSessionId),this.activeSessionId=null),this.eventEmitter.emit(h.DESTROY),this.eventEmitter.removeAllListeners())}async initialize(){try{await this.chatManager.connectSSE(),this.config.params.welcomeMessage&&await this.chatManager.sendSystemMessage(this.config.params.welcomeMessage),this.eventEmitter.emit(h.READY)}catch(e){const t=e instanceof b?e:L("Failed to initialize widget");this.eventEmitter.emit(h.ERROR,t)}}setupEventListeners(){this.chatManager.on("stateChange",e=>{this.forwardStateEvents(e)}),this.chatManager.on("message",e=>{this.eventEmitter.emit(h.MESSAGE,e)}),this.chatManager.on("error",e=>{this.eventEmitter.emit(h.ERROR,e),this.pushSystemNotification(e.message)}),this.chatManager.on("connectionChange",e=>{this.handleConnectionStatusChange(e),this.eventEmitter.emit(h.CONNECTION_CHANGE,e)}),this.chatManager.on("transactionRequest",e=>{this.eventEmitter.emit(h.TRANSACTION_REQUEST,e),this.handleTransactionRequest(e)}),this.walletManager&&this.setupWalletEventListeners()}setupWalletEventListeners(){this.walletManager&&(this.walletManager.on("connect",e=>{var t,n;this.chatManager.updateWalletState({isConnected:!0,address:e,chainId:((t=this.walletManager)==null?void 0:t.getCurrentChainId())??void 0,networkName:((n=this.walletManager)==null?void 0:n.getCurrentNetworkName())??void 0}),this.eventEmitter.emit(h.WALLET_CONNECT,e),this.pushSystemNotification(`Wallet connected: ${te(e)}`),this.updateWalletStatus(this.chatManager.getState())}),this.walletManager.on("disconnect",()=>{this.chatManager.updateWalletState({isConnected:!1,address:void 0,chainId:void 0,networkName:void 0}),this.eventEmitter.emit(h.WALLET_DISCONNECT),this.pushSystemNotification("Wallet disconnected."),this.updateWalletStatus(this.chatManager.getState())}),this.walletManager.on("chainChange",e=>{var t;this.chatManager.updateWalletState({chainId:e,networkName:((t=this.walletManager)==null?void 0:t.getCurrentNetworkName())??void 0}),this.eventEmitter.emit(h.NETWORK_CHANGE,e),this.pushSystemNotification(`Switched to ${k[e]||`chain ${e}`}.`),this.updateWalletStatus(this.chatManager.getState())}),this.walletManager.on("error",e=>{this.eventEmitter.emit(h.ERROR,e),this.updateWalletStatus(this.chatManager.getState())}))}forwardStateEvents(e){this.updateStateView(e),this.eventEmitter.emit(h.TYPING_CHANGE,e.isTyping),this.eventEmitter.emit(h.PROCESSING_CHANGE,e.isProcessing)}async handleTransactionRequest(e){if(!this.walletManager){await this.chatManager.sendTransactionResult(!1,void 0,"No wallet connected");return}try{const t=await this.walletManager.sendTransaction({to:e.to,value:e.value,data:e.data,gas:e.gas});await this.chatManager.sendTransactionResult(!0,t)}catch(t){const n=t instanceof Error?t.message:"Transaction failed";await this.chatManager.sendTransactionResult(!1,void 0,n)}}render(){this.teardownLayoutObservers(),this.container.innerHTML="",this.resetDomReferences(),this.widgetElement=N("div",{className:[o.WIDGET_ROOT,o.WIDGET_CONTAINER,this.themeManager.getThemeClass(),this.getModeClass()],styles:{width:this.config.params.width||Z,height:this.config.params.height||j,maxHeight:"100vh",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",fontFamily:this.themeManager.getFontFamily()}}),this.applyTheme(),this.renderChatInterface(),this.container.appendChild(this.widgetElement),this.initializeLayoutObservers()}renderChatInterface(){if(!this.widgetElement)return;const e=N("div",{className:o.CHAT_INTERFACE,styles:{width:"100%",height:"100%",display:"flex",flexDirection:"column",backgroundColor:this.themeManager.getColor("surface"),borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.08)",overflow:"hidden",minHeight:"0"}});this.chatInterfaceElement=e;const t=this.createHeader(),n=this.createBody(),i=this.createActionBar();this.chatBodyElement=n,e.appendChild(t),e.appendChild(n),e.appendChild(i),this.widgetElement.appendChild(e),this.bindActionBarEvents()}createHeader(){var a;const e=this.themeManager.getComputedTheme();this.statusBadgeElement=N("span",{className:o.STATUS_BADGE,styles:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"999px",backgroundColor:e.palette.surface,color:e.palette.textSecondary,fontSize:"12px",border:`1px solid ${e.palette.border}`},children:["Initializing"]});const t=N("div",{className:o.CHAT_TITLE,styles:{fontWeight:"600",fontSize:"15px",color:e.palette.text},children:[((a=this.config.params.content)==null?void 0:a.welcomeTitle)||"Aomi Assistant"]});this.walletStatusElement=N("button",{className:o.WALLET_STATUS,attributes:{type:"button"},styles:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"6px 12px",borderRadius:"999px",backgroundColor:e.palette.surface,border:`1px solid ${e.palette.border}`,color:e.palette.textSecondary,fontSize:"12px",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease"},children:["Connect Wallet"]}),this.walletStatusElement.addEventListener("click",()=>{this.handleWalletButtonClick()});const n=N("div",{styles:{display:"flex",alignItems:"center",gap:"12px"},children:[this.statusBadgeElement,this.walletStatusElement]}),i=N("div",{className:o.CHAT_HEADER,styles:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 20px",backgroundColor:this.themeManager.getColor("background"),borderBottom:`1px solid ${this.themeManager.getColor("border")}`}});return i.appendChild(t),i.appendChild(n),this.updateWalletStatus(this.chatManager.getState()),i}createBody(){const e=this.themeManager.getComputedTheme();this.messageListElement=N("div",{className:o.MESSAGE_LIST,styles:{flex:"1 1 auto",overflowY:"auto",padding:"20px",display:"flex",flexDirection:"column",gap:"12px",backgroundColor:e.palette.background,minHeight:"0"}}),this.messageListElement.appendChild(this.createMessageBubble("system","Chat interface is initializingâ€¦")),this.typingIndicatorElement=N("div",{className:o.TYPING_INDICATOR,styles:{display:"none",padding:"8px 12px",alignSelf:"flex-start",borderRadius:"12px",fontSize:"12px",color:e.palette.textSecondary,backgroundColor:e.palette.surface,border:`1px solid ${e.palette.border}`,flexShrink:"0"},children:["Assistant is typingâ€¦"]});const t=N("div",{className:o.CHAT_BODY,styles:{flex:"1 1 auto",display:"flex",flexDirection:"column",backgroundColor:e.palette.background,minHeight:"0",overflow:"hidden"}});return t.appendChild(this.messageListElement),t.appendChild(this.typingIndicatorElement),t}createActionBar(){const e=this.themeManager.getComputedTheme();this.messageInputElement=N("textarea",{className:[o.MESSAGE_INPUT,o.INPUT_FIELD],attributes:{placeholder:this.config.params.placeholder||"Ask anything about your Web3 experienceâ€¦",rows:"1"},styles:{flex:"1",resize:"none",border:"none",outline:"none",fontSize:"14px",lineHeight:"20px",backgroundColor:"transparent",color:e.palette.text,minHeight:"48px"}}),this.sendButtonElement=N("button",{className:o.SEND_BUTTON,attributes:{type:"submit"},styles:{border:"none",borderRadius:"999px",padding:"10px 16px",background:`linear-gradient(135deg, ${e.palette.primary}, ${e.palette.accent||e.palette.primary})`,color:e.palette.background,fontWeight:"600",cursor:"pointer",transition:"opacity 0.2s ease"},children:["Send"]});const t=N("div",{className:o.ACTION_BAR,styles:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",backgroundColor:e.palette.surface,borderRadius:"10px",border:`1px solid ${e.palette.border}`},children:[this.messageInputElement,this.sendButtonElement]});return this.inputFormElement=N("form",{className:o.INPUT_FORM,styles:{padding:"16px 20px 20px",backgroundColor:e.palette.background,borderTop:`1px solid ${e.palette.border}`,flexShrink:"0"},children:[t]}),this.inputFormElement}initializeLayoutObservers(){F()&&(this.teardownLayoutObservers(),this.chatInterfaceElement&&typeof ResizeObserver<"u"&&(this.layoutResizeObserver=new ResizeObserver(()=>{this.scheduleLayoutMeasurement()}),this.layoutResizeObserver.observe(this.chatInterfaceElement)),this.layoutResizeListener=()=>{this.scheduleLayoutMeasurement(!0)},window.addEventListener("resize",this.layoutResizeListener),this.scheduleLayoutMeasurement(!0))}teardownLayoutObservers(){this.layoutResizeObserver&&(this.layoutResizeObserver.disconnect(),this.layoutResizeObserver=null),this.layoutResizeListener&&(window.removeEventListener("resize",this.layoutResizeListener),this.layoutResizeListener=null),this.layoutMeasurementFrame!==null&&(window.cancelAnimationFrame(this.layoutMeasurementFrame),this.layoutMeasurementFrame=null)}scheduleLayoutMeasurement(e=!1){if(F()){if(this.layoutMeasurementFrame!==null){if(!e)return;window.cancelAnimationFrame(this.layoutMeasurementFrame),this.layoutMeasurementFrame=null}this.layoutMeasurementFrame=window.requestAnimationFrame(()=>{this.layoutMeasurementFrame=null,this.applyWidgetViewportClamp(),this.updateScrollableRegion()})}}applyWidgetViewportClamp(){var c;if(!this.widgetElement||!F())return;const e=window.innerHeight||((c=document.documentElement)==null?void 0:c.clientHeight)||0;if(!e)return;const t=32,n=e>t?e-t:e;if(n<=0)return;const i=this.parsePixelValue(this.config.params.height),a=this.parsePixelValue(j)??0;if(i!==null){const l=Math.min(i,n);this.widgetElement.style.height=`${l}px`,this.widgetElement.style.maxHeight=`${n}px`}else if(a){const l=Math.min(a,n);this.widgetElement.style.height=`${l}px`,this.widgetElement.style.maxHeight=`${n}px`}else this.widgetElement.style.maxHeight=`${n}px`}updateScrollableRegion(){if(!this.chatBodyElement||!this.messageListElement)return;const e=this.chatBodyElement.getBoundingClientRect();if(!e.height)return;let t=0;this.typingIndicatorElement&&this.typingIndicatorElement.style.display!=="none"&&(t=this.typingIndicatorElement.getBoundingClientRect().height||0);const n=Math.max(e.height-t,0);n>0?(this.messageListElement.style.maxHeight=`${n}px`,this.messageListElement.style.height=`${n}px`):(this.messageListElement.style.maxHeight="",this.messageListElement.style.height="")}parsePixelValue(e){if(!e)return null;const t=e.trim().toLowerCase();if(!t.endsWith("px"))return null;const n=Number.parseFloat(t.slice(0,-2));return Number.isFinite(n)?n:null}createMessageBubble(e,t,n){const i=this.themeManager.getComputedTheme(),a=e==="user",c=e==="system",l=N("div",{className:[o.MESSAGE_BUBBLE,a?o.MESSAGE_USER:c?o.MESSAGE_SYSTEM:o.MESSAGE_ASSISTANT],styles:{alignSelf:a?"flex-end":"flex-start",maxWidth:"80%",padding:"12px 14px",borderRadius:a?"16px 4px 16px 16px":"4px 16px 16px 16px",backgroundColor:c?i.palette.surface:a?i.palette.primary:i.palette.surface,color:a?i.palette.background:i.palette.text,border:`1px solid ${a?i.palette.primary:i.palette.border}`,fontSize:"14px",lineHeight:"20px",whiteSpace:"pre-wrap",display:"flex",flexDirection:"column",gap:"8px"}}),u=N("div",{styles:{wordBreak:"break-word"},children:[t]});return l.appendChild(u),n&&l.appendChild(N("div",{styles:{fontSize:"12px",opacity:"0.7",textAlign:a?"right":"left",fontFamily:this.themeManager.getMonospaceFontFamily()},children:[Ie(n)]})),l}resetDomReferences(){this.statusBadgeElement=null,this.messageListElement=null,this.typingIndicatorElement=null,this.inputFormElement=null,this.messageInputElement=null,this.sendButtonElement=null,this.walletStatusElement=null,this.chatInterfaceElement=null,this.chatBodyElement=null}registerConfigListeners(){const e=this.config.listeners;if(!e)return;[{key:"onReady",event:h.READY},{key:"onMessage",event:h.MESSAGE},{key:"onTransactionRequest",event:h.TRANSACTION_REQUEST},{key:"onError",event:h.ERROR},{key:"onSessionStart",event:h.SESSION_START},{key:"onSessionEnd",event:h.SESSION_END},{key:"onNetworkChange",event:h.NETWORK_CHANGE},{key:"onWalletConnect",event:h.WALLET_CONNECT},{key:"onWalletDisconnect",event:h.WALLET_DISCONNECT},{key:"onTypingChange",event:h.TYPING_CHANGE},{key:"onProcessingChange",event:h.PROCESSING_CHANGE},{key:"onConnectionChange",event:h.CONNECTION_CHANGE},{key:"onResize",event:h.RESIZE}].forEach(({key:n,event:i})=>{const a=e[n];a&&this.eventEmitter.on(i,a)})}getEventNameForListener(e){return{onReady:h.READY,onMessage:h.MESSAGE,onTransactionRequest:h.TRANSACTION_REQUEST,onError:h.ERROR,onSessionStart:h.SESSION_START,onSessionEnd:h.SESSION_END,onNetworkChange:h.NETWORK_CHANGE,onWalletConnect:h.WALLET_CONNECT,onWalletDisconnect:h.WALLET_DISCONNECT,onTypingChange:h.TYPING_CHANGE,onProcessingChange:h.PROCESSING_CHANGE,onConnectionChange:h.CONNECTION_CHANGE,onResize:h.RESIZE}[e]||e}bindActionBarEvents(){!this.inputFormElement||!this.messageInputElement||!this.sendButtonElement||(this.inputFormElement.addEventListener("submit",e=>{e.preventDefault(),this.handleSendMessage()}),this.messageInputElement.addEventListener("input",()=>{this.autoResizeMessageInput()}),this.messageInputElement.addEventListener("keydown",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),this.handleSendMessage())}),this.autoResizeMessageInput())}async handleSendMessage(){if(this.isDestroyed||this.isSending||!this.messageInputElement)return;const e=this.messageInputElement.value.trim();if(!e)return;const t=this.lastState||this.chatManager.getState();if(t.connectionStatus!==f.CONNECTED){this.pushSystemNotification("Waiting for connection before sending messages.");return}this.isSending=!0,this.updateInputControls(t,!0);try{await this.chatManager.sendMessage(e),this.messageInputElement.value="",this.autoResizeMessageInput()}catch(n){const i=n instanceof Error?n.message:"Failed to send message";this.pushSystemNotification(i)}finally{this.isSending=!1,this.updateInputControls(this.chatManager.getState())}}autoResizeMessageInput(){if(!this.messageInputElement)return;const e=48;this.messageInputElement.style.height="auto";const t=Math.min(Math.max(this.messageInputElement.scrollHeight,e),180);this.messageInputElement.style.height=`${t}px`,this.scheduleLayoutMeasurement()}updateStateView(e){const t=this.lastState;e.sessionId&&e.sessionId!==this.activeSessionId&&(this.activeSessionId&&this.eventEmitter.emit(h.SESSION_END,this.activeSessionId),this.activeSessionId=e.sessionId,this.eventEmitter.emit(h.SESSION_START,e.sessionId)),(t==null?void 0:t.readiness.phase)!==g.READY&&e.readiness.phase===g.READY&&(this.hasAnnouncedConnection||this.pushSystemNotification("Assistant is ready. Ask your first question!"),this.hasAnnouncedConnection=!0),e.readiness.phase!==g.READY&&(this.hasAnnouncedConnection=!1),this.updateStatusBadge(e),this.updateMessages(e.messages),this.updateTypingIndicator(e.isTyping||e.isProcessing),this.updateInputControls(e),this.updateWalletStatus(e),this.lastState=e}pushSystemNotification(e){if(!this.messageListElement)return;const t=this.createMessageBubble("system",e,new Date);this.messageListElement.appendChild(t),this.scrollMessagesToBottom(),this.scheduleLayoutMeasurement()}updateStatusBadge(e){if(!this.statusBadgeElement)return;const t=this.themeManager.getComputedTheme();let n="Initializingâ€¦",i=t.palette.surface,a=t.palette.textSecondary,c=t.palette.border;switch(e.connectionStatus){case f.CONNECTED:switch(e.readiness.phase){case g.READY:n="Connected",i=t.palette.success,a=t.palette.background,c=t.palette.success;break;case g.MISSING_API_KEY:n="Missing API Key",i=t.palette.error,a=t.palette.background,c=t.palette.error;break;case g.ERROR:n=e.readiness.detail||"Backend Error",i=t.palette.error,a=t.palette.background,c=t.palette.error;break;default:{const l=this.describeReadiness(e.readiness.phase);n=e.readiness.detail??`Preparing (${l})`,i=t.palette.warning,a=t.palette.background,c=t.palette.warning;break}}break;case f.CONNECTING:case f.RECONNECTING:n="Connectingâ€¦",i=t.palette.warning,a=t.palette.background,c=t.palette.warning;break;case f.DISCONNECTED:n="Disconnected",i=t.palette.error,a=t.palette.background,c=t.palette.error;break;case f.ERROR:default:n="Error",i=t.palette.error,a=t.palette.background,c=t.palette.error;break}this.statusBadgeElement.textContent=n,Object.assign(this.statusBadgeElement.style,{backgroundColor:i,color:a,border:`1px solid ${c}`})}describeReadiness(e){switch(e){case g.CONNECTING_MCP:return"backend services";case g.VALIDATING_ANTHROPIC:return"model providers";case g.READY:return"ready";case g.MISSING_API_KEY:return"missing api key";case g.ERROR:return"error";default:return"starting"}}updateMessages(e){if(!this.messageListElement)return;const t=this.isNearBottom(this.messageListElement);this.messageListElement.innerHTML="",e.length===0?this.messageListElement.appendChild(this.createMessageBubble("system","Say hello to begin the conversation.",new Date)):e.forEach(n=>{this.messageListElement.appendChild(this.createMessageBubble(n.type,n.content,n.timestamp))}),t&&this.scrollMessagesToBottom(),this.scheduleLayoutMeasurement()}isNearBottom(e){return e.scrollHeight-e.scrollTop-e.clientHeight<120}scrollMessagesToBottom(){this.messageListElement&&(this.messageListElement.scrollTop=this.messageListElement.scrollHeight)}updateTypingIndicator(e){this.typingIndicatorElement&&(this.typingIndicatorElement.style.display=e?"flex":"none",this.scheduleLayoutMeasurement())}updateInputControls(e,t=!1){if(!this.messageInputElement||!this.sendButtonElement)return;const n=e.readiness.phase===g.READY,i=e.readiness.phase===g.MISSING_API_KEY||e.readiness.phase===g.ERROR,a=!n&&!i,c=t||e.isProcessing||a||i,l=t||e.connectionStatus!==f.CONNECTED||e.isProcessing||a||i;this.messageInputElement.readOnly=c,this.messageInputElement.disabled=c,this.messageInputElement.setAttribute("aria-disabled",c?"true":"false"),this.sendButtonElement.disabled=l,this.sendButtonElement.style.opacity=l?"0.6":"1",this.sendButtonElement.style.cursor=l?"not-allowed":"pointer";let r=this.config.params.placeholder||"Ask anything about your Web3 experienceâ€¦";i?r="Backend configuration error. Please verify server setup.":e.connectionStatus!==f.CONNECTED?r="Connecting to backendâ€¦":a?r="Preparing backend servicesâ€¦":e.isProcessing&&(r="Processing your previous requestâ€¦"),this.messageInputElement.placeholder=r}updateWalletStatus(e){if(!this.walletStatusElement)return;const t=this.themeManager.getComputedTheme();if(!this.walletManager){this.walletStatusElement.textContent="Wallet Unavailable",this.walletStatusElement.disabled=!0,this.walletStatusElement.title="Provide an Ethereum provider to enable wallet features.",Object.assign(this.walletStatusElement.style,{backgroundColor:t.palette.surface,border:`1px dashed ${t.palette.border}`,color:t.palette.textSecondary,cursor:"not-allowed"});return}if(this.walletStatusElement.disabled=this.isWalletActionPending,this.walletStatusElement.style.cursor=this.isWalletActionPending?"wait":"pointer",this.isWalletActionPending){this.walletStatusElement.textContent="Workingâ€¦",Object.assign(this.walletStatusElement.style,{backgroundColor:t.palette.surface,border:`1px solid ${t.palette.border}`,color:t.palette.textSecondary});return}const{walletState:n}=e;if(n.isConnected&&n.address){const i=n.networkName||(n.chainId?k[n.chainId]:void 0);this.walletStatusElement.textContent=te(n.address),this.walletStatusElement.title=i?`Connected to ${i}`:"Wallet connected",Object.assign(this.walletStatusElement.style,{backgroundColor:t.palette.success,border:`1px solid ${t.palette.success}`,color:t.palette.background})}else this.walletStatusElement.textContent="Connect Wallet",this.walletStatusElement.title="Connect an Ethereum wallet",Object.assign(this.walletStatusElement.style,{backgroundColor:t.palette.surface,border:`1px solid ${t.palette.border}`,color:t.palette.textSecondary})}async handleWalletButtonClick(){if(this.isWalletActionPending)return;if(!this.walletManager){this.pushSystemNotification("No wallet provider configured. Embed with an injected provider to enable transactions.");return}const e=this.lastState||this.chatManager.getState(),t=e.walletState.isConnected;this.isWalletActionPending=!0,this.updateWalletStatus(e);try{t?this.walletManager.disconnect():await this.walletManager.connect()}catch(n){const i=n instanceof Error?n.message:"Wallet action failed";this.pushSystemNotification(i)}finally{this.isWalletActionPending=!1,this.updateWalletStatus(this.chatManager.getState())}}handleConnectionStatusChange(e){var n;const t=(n=this.lastState)==null?void 0:n.connectionStatus;if(t!==e)switch(e){case f.CONNECTED:t&&t!==f.CONNECTED&&this.pushSystemNotification("Connection restored. Preparing servicesâ€¦");break;case f.RECONNECTING:this.pushSystemNotification("Connection dropped. Attempting to reconnectâ€¦"),this.hasAnnouncedConnection=!1;break;case f.DISCONNECTED:this.pushSystemNotification("Connection lost. We will retry shortly."),this.hasAnnouncedConnection=!1;break;case f.ERROR:this.pushSystemNotification("A connection error occurred. Please retry."),this.hasAnnouncedConnection=!1;break}}applyTheme(){if(!this.widgetElement)return;const e=this.themeManager.getComputedTheme();Object.entries(e.palette).forEach(([t,n])=>{this.widgetElement.style.setProperty(`--aomi-${t}`,n)}),this.widgetElement.className=[o.WIDGET_ROOT,o.WIDGET_CONTAINER,this.themeManager.getThemeClass(),this.getModeClass()].join(" ")}getModeClass(){switch(this.config.params.mode){case"minimal":return o.MODE_MINIMAL;case"compact":return o.MODE_COMPACT;case"terminal":return o.MODE_TERMINAL;default:return o.MODE_FULL}}updateDimensions(){this.widgetElement&&(this.widgetElement.style.width=this.config.params.width||Z,this.widgetElement.style.height=this.config.params.height||j,this.scheduleLayoutMeasurement(!0))}}function xe(s,e){if(!F())throw O("Widget can only be created in a browser environment");if(!s||!(s instanceof HTMLElement))throw O("Container must be a valid HTML element");const t=oe(e.params);if(t.length>0)throw O(`Configuration errors: ${t.join(", ")}`);return new Ae(s,e)}function ve(s,e){const t=typeof s=="string"?document.getElementById(s):s;if(!t)throw O(typeof s=="string"?`Element with id "${s}" not found`:"Invalid container element");const n={params:{appCode:e.appCode,theme:e.theme,width:e.width,height:e.height,baseUrl:e.baseUrl},provider:e.provider,listeners:{onReady:e.onReady,onMessage:e.onMessage,onError:e.onError}};return xe(t,n)}const Oe="http://localhost:8080";var ie;const U=typeof window<"u"?(ie=new URLSearchParams(window.location.search).get("backend"))==null?void 0:ie.trim():void 0,V=U&&U.length>0?U:Oe,se={baseTheme:"dark",primary:"#8b5cf6",background:"#0f172a",surface:"#111c34",text:"#e2e8f0",textSecondary:"#94a3b8",border:"#1e293b",success:"#34d399",error:"#f87171",warning:"#fbbf24",accent:"#38bdf8"},le=[{id:"light",title:"Guide (Light)",description:"Polished neutral palette for documentation portals and marketing pages.",accent:D.light.palette.primary??"#6366f1",icon:"âœ¨",theme:"light"},{id:"dark",title:"Support (Dark)",description:"High contrast layout for dashboards and late-night operators.",accent:"#141820",icon:"ðŸŒ™",theme:"dark"},{id:"terminal",title:"Ops Terminal",description:"Retro terminal skin with monospace typography and command prompts.",accent:"#00f260",icon:"ðŸ–¥ï¸",theme:"terminal"},{id:"aurora",title:"Aurora Custom",description:"Gradient-inspired palette showcasing bespoke brand controls.",accent:se.primary??"#8b5cf6",icon:"ðŸŒŒ",theme:se}],q=document.getElementById("theme-grid"),G=document.getElementById("widget-host"),he=document.getElementById("active-theme"),de=document.getElementById("widget-status"),ue=document.getElementById("reset-widget");if(!q||!G||!he||!de||!ue)throw new Error("Demo markup missing required elements.");let A=null,W=null;console.info("[Aomi demo] Using backend:",V);console.info(U?"[Aomi demo] Backend provided via ?backend parameter.":"[Aomi demo] Falling back to local default for previews.");ue.addEventListener("click",()=>{A&&(A.destroy(),A=null),W=null,me("â€”"),$("Select a theme to load the widget."),G.innerHTML="<p>Choose a theme to embed the widget.</p>",z()});z();function z(){q.innerHTML="",le.forEach(s=>{const e=document.createElement("article");e.className="theme-card",e.dataset.active=s.id===W?"true":"false",e.dataset.themeId=s.id,e.style.setProperty("--accent",s.accent);const t=document.createElement("div");t.className="theme-card-head";const n=document.createElement("div");n.className="theme-chip",n.style.setProperty("--accent",s.accent),s.id==="dark"?(n.style.setProperty("--chip-start","#0b0d13"),n.style.setProperty("--chip-end","#1f2733"),n.style.setProperty("--chip-foreground","#e2e8f0")):(n.style.setProperty("--chip-start",s.accent),n.style.setProperty("--chip-end","rgba(255, 255, 255, 0.2)"),n.style.setProperty("--chip-foreground","#f8fafc")),n.setAttribute("aria-hidden","true");const i=document.createElement("span");i.textContent=s.icon,n.appendChild(i);const a=document.createElement("h3");a.textContent=s.title,t.append(n,a);const c=document.createElement("p");c.textContent=s.description;const l=document.createElement("button");l.type="button";const u=W===s.id;l.textContent=u?"Reload theme":"Preview theme",l.setAttribute("aria-pressed",u?"true":"false"),l.title=u?`Reload ${s.title}`:`Preview ${s.title}`,l.addEventListener("click",()=>{_e(s.id,s.theme)}),e.append(t,c,l),q.appendChild(e)})}function _e(s,e){var n;A&&(A.destroy(),A=null),G.innerHTML="",$("Booting widgetâ€¦"),me(((n=le.find(i=>i.id===s))==null?void 0:n.title)??s),W=s,z();const t=Re();try{A=ve(G,{appCode:`landing-demo-${s}`,theme:e,width:"100%",height:"520px",baseUrl:V,provider:t,onReady:()=>{$(`Ready â€¢ connected to ${V}`)},onMessage:i=>{console.info("[Aomi widget message]",i)},onError:i=>{$(`Error: ${i.message}`),console.error("[Aomi widget error]",i)}})}catch(i){W=null,z(),$("Failed to mount the widget. Check the console for details."),G.innerHTML="<p>Something went wrong while loading the widget.</p>",console.error("[Aomi widget init error]",i)}}function Re(){return typeof window<"u"&&window.ethereum?window.ethereum:Me()}function Me(){let s=["0x742d35Cc6645C0532C8ae7a8a4eaaE43e3Df9E10"];return{request:async({method:e,params:t})=>{switch(e){case"eth_accounts":return s;case"eth_chainId":return"0x1";case"eth_requestAccounts":return s;case"eth_getBalance":return"0x1bc16d674ec80000";case"personal_sign":return`0x${"a".repeat(130)}`;case"wallet_switchEthereumChain":return s=[...s],null;default:return console.warn(`Mock provider received unsupported method: ${e}`,t),null}},on:(e,t)=>{e==="accountsChanged"&&setTimeout(()=>t(s),1e3)}}}function $(s){de.textContent=s}function me(s){he.textContent=s}window.addEventListener("beforeunload",()=>{A&&A.destroy()});
