{"version":3,"sources":["../packages/react/src/api/client.ts","../packages/react/src/runtime/aomi-runtime.tsx","../packages/react/src/runtime/hooks.ts","../packages/react/src/runtime/orchestrator.ts","../packages/react/src/state/thread-context.tsx","../packages/react/src/state/thread-store.ts","../packages/react/src/utils/conversion.ts","../packages/react/src/runtime/utils.ts","../packages/react/src/runtime/backend-state.ts","../packages/react/src/runtime/message-controller.ts","../packages/react/src/runtime/polling-controller.ts","../packages/react/src/lib/notification-context.tsx","../node_modules/.pnpm/sonner@1.7.4_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/sonner/src/index.tsx","../node_modules/.pnpm/sonner@1.7.4_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/sonner/src/assets.tsx","../node_modules/.pnpm/sonner@1.7.4_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/sonner/src/hooks.tsx","../node_modules/.pnpm/sonner@1.7.4_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/sonner/src/state.ts","../node_modules/.pnpm/sonner@1.7.4_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/sonner/dist/index.mjs.map","../node_modules/.pnpm/sonner@1.7.4_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/sonner/src/styles.css","../node_modules/.pnpm/sonner@1.7.4_react-dom@19.2.3_react@19.2.3__react@19.2.3/node_modules/sonner/src/types.ts","../packages/react/src/lib/utils.ts","../packages/react/src/components/ui/sonner.tsx","../packages/react/src/utils/wallet.ts","../packages/react/src/runtime/wallet-handler.ts","../packages/react/src/runtime/event-controller.ts"],"sourcesContent":["import type {\n  BackendSessionResponse,\n  BackendThreadMetadata,\n  CreateThreadResponse,\n  SessionMessage,\n  SessionResponsePayload,\n  SystemEvent,\n  SystemResponsePayload,\n  SystemUpdateNotification,\n} from \"./types\";\n\nfunction toQueryString(payload: Record<string, unknown>): string {\n  const params = new URLSearchParams();\n  for (const [key, value] of Object.entries(payload)) {\n    if (value === undefined || value === null) continue;\n    params.set(key, String(value));\n  }\n  const qs = params.toString();\n  return qs ? `?${qs}` : \"\";\n}\n\nasync function postState<T>(\n  backendUrl: string,\n  path: string,\n  payload: Record<string, unknown>\n): Promise<T> {\n  const query = toQueryString(payload);\n  const url = `${backendUrl}${path}${query}`;\n  console.log(\"游댯 [postState] URL:\", url);\n  console.log(\"游댯 [postState] Payload:\", payload);\n\n  const response = await fetch(url, {\n    method: \"POST\",\n  });\n  console.log(\"游댯 [postState] Response status:\", response.status);\n\n  if (!response.ok) {\n    console.error(\"游댮 [postState] Error:\", response.status, response.statusText);\n    throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n  }\n\n  const data = (await response.json()) as T;\n  console.log(\"游릭 [postState] Success:\", data);\n  return data;\n}\n\nexport class BackendApi {\n  private connectionStatus = false;\n  private eventSource: EventSource | null = null;\n  private updatesEventSources = new Map<\n    string,\n    {\n      eventSource: EventSource | null;\n      retries: number;\n      retryTimer: ReturnType<typeof setTimeout> | null;\n      stopped: boolean;\n      cleanup: () => void;\n    }\n  >();\n\n  constructor(private readonly backendUrl: string) {}\n\n  async fetchState(\n    sessionId: string,\n    options?: { signal?: AbortSignal }\n  ): Promise<SessionResponsePayload> {\n    console.log(\"游댯 [fetchState] Called with sessionId:\", sessionId);\n    const url = `${this.backendUrl}/api/state?session_id=${encodeURIComponent(sessionId)}`;\n    console.log(\"游댯 [fetchState] URL:\", url);\n\n    const response = await fetch(url, { signal: options?.signal });\n    console.log(\"游댯 [fetchState] Response status:\", response.status, response.statusText);\n\n    if (!response.ok) {\n      console.error(\"游댮 [fetchState] Error:\", response.status, response.statusText);\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const data = (await response.json()) as SessionResponsePayload;\n    console.log(\"游릭 [fetchState] Success:\", data);\n    return data;\n  }\n\n  async postChatMessage(\n    sessionId: string,\n    message: string,\n    publicKey?: string\n  ): Promise<SessionResponsePayload> {\n    console.log(\"游댯 [postChatMessage] Called with sessionId:\", sessionId, \"message:\", message);\n    const result = await postState<SessionResponsePayload>(this.backendUrl, \"/api/chat\", {\n      message,\n      session_id: sessionId,\n      public_key: publicKey,\n    });\n    console.log(\"游릭 [postChatMessage] Success:\", result);\n    return result;\n  }\n\n  async postSystemMessage(sessionId: string, message: string): Promise<SystemResponsePayload> {\n    console.log(\"游댯 [postSystemMessage] Called with sessionId:\", sessionId, \"message:\", message);\n    const result = await postState<SystemResponsePayload>(this.backendUrl, \"/api/system\", {\n      message,\n      session_id: sessionId,\n    });\n    console.log(\"游릭 [postSystemMessage] Success:\", result);\n    return result;\n  }\n\n  async postInterrupt(sessionId: string): Promise<SessionResponsePayload> {\n    console.log(\"游댯 [postInterrupt] Called with sessionId:\", sessionId);\n    const result = await postState<SessionResponsePayload>(this.backendUrl, \"/api/interrupt\", {\n      session_id: sessionId,\n    });\n    console.log(\"游릭 [postInterrupt] Success:\", result);\n    return result;\n  }\n\n  disconnectSSE(): void {\n    if (this.eventSource) {\n      this.eventSource.close();\n      this.eventSource = null;\n    }\n    this.setConnectionStatus(false);\n  }\n\n  setConnectionStatus(on: boolean): void {\n    this.connectionStatus = on;\n  }\n\n  async connectSSE(sessionId: string, publicKey?: string) {\n    this.disconnectSSE();\n\n    try {\n      const url = new URL(`${this.backendUrl}/api/chat/stream`);\n      url.searchParams.set(\"session_id\", sessionId);\n      if (publicKey) {\n        url.searchParams.set(\"public_key\", publicKey);\n      }\n\n      this.eventSource = new EventSource(url.toString());\n\n      this.eventSource.onopen = () => {\n        console.log(\"游깷 SSE connection opened to:\", url.toString());\n        this.setConnectionStatus(true);\n      };\n\n      this.eventSource.onmessage = (event) => {\n        try {\n          JSON.parse(event.data);\n        } catch (error) {\n          console.error(\"Failed to parse SSE data:\", error);\n        }\n      };\n\n      this.eventSource.onerror = (error) => {\n        console.error(\"SSE connection error:\", error);\n      };\n    } catch (error) {\n      console.error(\"Failed to establish SSE connection:\", error);\n      this.handleConnectionError(sessionId, publicKey);\n    }\n  }\n\n  private handleConnectionError(sessionId: string, publicKey?: string): void {\n    this.setConnectionStatus(false);\n    let attempt = 0;\n    const total = 3;\n    if (attempt < total) {\n      attempt++;\n      console.log(`Attempting to reconnect (${attempt}/${total})...`);\n\n      setTimeout(() => {\n        this.connectSSE(sessionId, publicKey);\n      }, 100);\n    } else {\n      console.error(\"Max reconnection attempts reached\");\n      this.setConnectionStatus(false);\n    }\n  }\n\n  private subscribeToUpdatesInternal<T>(\n    sessionId: string,\n    onUpdate: (update: T) => void,\n    onError: ((error: unknown) => void) | undefined,\n    logLabel: string\n  ): () => void {\n    const updatesUrl = new URL(\"/api/updates\", this.backendUrl);\n    updatesUrl.searchParams.set(\"session_id\", sessionId);\n    const updatesUrlString = updatesUrl.toString();\n\n    const existing = this.updatesEventSources.get(sessionId);\n    if (existing) {\n      existing.cleanup();\n      this.updatesEventSources.delete(sessionId);\n    }\n\n    const subscription = {\n      eventSource: null as EventSource | null,\n      retries: 0,\n      retryTimer: null as ReturnType<typeof setTimeout> | null,\n      stopped: false,\n      cleanup: () => {\n        subscription.stopped = true;\n        if (subscription.retryTimer) {\n          clearTimeout(subscription.retryTimer);\n          subscription.retryTimer = null;\n        }\n        if (subscription.eventSource) {\n          subscription.eventSource.close();\n          subscription.eventSource = null;\n        }\n      },\n    };\n\n    const scheduleRetry = () => {\n      subscription.retries += 1;\n      const delayMs = Math.min(500 * 2 ** (subscription.retries - 1), 10000);\n      console.warn(\n        `游대 [${logLabel}] retrying in ${delayMs}ms (attempt ${subscription.retries})`,\n        { sessionId }\n      );\n      subscription.retryTimer = setTimeout(() => {\n        open();\n      }, delayMs);\n    };\n\n    const open = () => {\n      if (subscription.stopped) return;\n      if (subscription.retryTimer) {\n        clearTimeout(subscription.retryTimer);\n        subscription.retryTimer = null;\n      }\n      if (subscription.eventSource) {\n        subscription.eventSource.close();\n      }\n\n      const updatesEventSource = new EventSource(updatesUrlString);\n      subscription.eventSource = updatesEventSource;\n\n      console.log(`游댒 [updates] subscribed`, updatesUrlString);\n\n      updatesEventSource.onopen = () => {\n        subscription.retries = 0;\n        console.log(\"游댒 [updates] open\", updatesUrlString);\n      };\n\n      updatesEventSource.onmessage = (event) => {\n        try {\n          console.log(\"游댒 [updates] message\", { url: updatesUrlString, data: event.data });\n          const parsed = JSON.parse(event.data) as T;\n          onUpdate(parsed);\n        } catch (error) {\n          console.error(\"Failed to parse system update SSE:\", error);\n          onError?.(error);\n        }\n      };\n\n      updatesEventSource.onerror = (error) => {\n        console.error(\"System updates SSE error:\", {\n          url: updatesUrlString,\n          readyState: updatesEventSource.readyState,\n          error,\n        });\n        onError?.(error);\n        if (subscription.stopped) return;\n        updatesEventSource.close();\n        scheduleRetry();\n      };\n    };\n\n    this.updatesEventSources.set(sessionId, subscription);\n    open();\n\n    return () => {\n      const current = this.updatesEventSources.get(sessionId);\n      if (current === subscription) {\n        current.cleanup();\n        this.updatesEventSources.delete(sessionId);\n      } else {\n        subscription.cleanup();\n      }\n    };\n  }\n\n  subscribeToUpdates(\n    sessionId: string,\n    onUpdate: (update: SystemUpdateNotification) => void,\n    onError?: (error: unknown) => void\n  ): () => void {\n    return this.subscribeToUpdatesInternal(\n      sessionId,\n      onUpdate,\n      onError,\n      \"subscribeToUpdates\"\n    );\n  }\n\n  async fetchThreads(publicKey: string): Promise<BackendThreadMetadata[]> {\n    console.log(\"游댯 [fetchThreads] Called with publicKey:\", publicKey);\n    const url = `${this.backendUrl}/api/sessions?public_key=${encodeURIComponent(publicKey)}`;\n    console.log(\"游댯 [fetchThreads] URL:\", url);\n\n    const response = await fetch(url);\n    console.log(\"游댯 [fetchThreads] Response status:\", response.status);\n\n    if (!response.ok) {\n      console.error(\"游댮 [fetchThreads] Error:\", response.status);\n      throw new Error(`Failed to fetch threads: HTTP ${response.status}`);\n    }\n\n    const data = (await response.json()) as BackendThreadMetadata[];\n    console.log(\"游릭 [fetchThreads] Success:\", data);\n    return data;\n  }\n\n  async createThread(publicKey?: string, title?: string): Promise<CreateThreadResponse> {\n    console.log(\"游댯 [createThread] Called with publicKey:\", publicKey, \"title:\", title);\n    const body: Record<string, string> = {};\n    if (publicKey) {\n      body.public_key = publicKey;\n    }\n    if (title) {\n      body.title = title;\n    }\n    console.log(\"游댯 [createThread] Request body:\", body);\n\n    const url = `${this.backendUrl}/api/sessions`;\n    console.log(\"游댯 [createThread] URL:\", url);\n\n    const response = await fetch(url, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(body),\n    });\n    console.log(\"游댯 [createThread] Response status:\", response.status);\n\n    if (!response.ok) {\n      console.error(\"游댮 [createThread] Error:\", response.status);\n      throw new Error(`Failed to create thread: HTTP ${response.status}`);\n    }\n\n    const data = (await response.json()) as CreateThreadResponse;\n    console.log(\"游릭 [createThread] Success:\", data);\n    return data;\n  }\n\n  async archiveThread(sessionId: string): Promise<void> {\n    console.log(\"游댯 [archiveThread] Called with sessionId:\", sessionId);\n    const url = `${this.backendUrl}/api/sessions/${encodeURIComponent(sessionId)}/archive`;\n    console.log(\"游댯 [archiveThread] URL:\", url);\n\n    const response = await fetch(url, { method: \"POST\" });\n    console.log(\"游댯 [archiveThread] Response status:\", response.status);\n\n    if (!response.ok) {\n      console.error(\"游댮 [archiveThread] Error:\", response.status);\n      throw new Error(`Failed to archive thread: HTTP ${response.status}`);\n    }\n    console.log(\"游릭 [archiveThread] Success\");\n  }\n\n  async unarchiveThread(sessionId: string): Promise<void> {\n    console.log(\"游댯 [unarchiveThread] Called with sessionId:\", sessionId);\n    const url = `${this.backendUrl}/api/sessions/${encodeURIComponent(sessionId)}/unarchive`;\n    console.log(\"游댯 [unarchiveThread] URL:\", url);\n\n    const response = await fetch(url, { method: \"POST\" });\n    console.log(\"游댯 [unarchiveThread] Response status:\", response.status);\n\n    if (!response.ok) {\n      console.error(\"游댮 [unarchiveThread] Error:\", response.status);\n      throw new Error(`Failed to unarchive thread: HTTP ${response.status}`);\n    }\n    console.log(\"游릭 [unarchiveThread] Success\");\n  }\n\n  async deleteThread(sessionId: string): Promise<void> {\n    console.log(\"游댯 [deleteThread] Called with sessionId:\", sessionId);\n    const url = `${this.backendUrl}/api/sessions/${encodeURIComponent(sessionId)}`;\n    console.log(\"游댯 [deleteThread] URL:\", url);\n\n    const response = await fetch(url, { method: \"DELETE\" });\n    console.log(\"游댯 [deleteThread] Response status:\", response.status);\n\n    if (!response.ok) {\n      console.error(\"游댮 [deleteThread] Error:\", response.status);\n      throw new Error(`Failed to delete thread: HTTP ${response.status}`);\n    }\n    console.log(\"游릭 [deleteThread] Success\");\n  }\n\n  async renameThread(sessionId: string, newTitle: string): Promise<void> {\n    console.log(\"游댯 [renameThread] Called with sessionId:\", sessionId, \"newTitle:\", newTitle);\n    const url = `${this.backendUrl}/api/sessions/${encodeURIComponent(sessionId)}`;\n    console.log(\"游댯 [renameThread] URL:\", url);\n\n    const response = await fetch(url, {\n      method: \"PATCH\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ title: newTitle }),\n    });\n    console.log(\"游댯 [renameThread] Response status:\", response.status);\n\n    if (!response.ok) {\n      console.error(\"游댮 [renameThread] Error:\", response.status);\n      throw new Error(`Failed to rename thread: HTTP ${response.status}`);\n    }\n    console.log(\"游릭 [renameThread] Success\");\n  }\n\n  async fetchEventsAfter(\n    sessionId: string,\n    afterId = 0,\n    limit = 100\n  ): Promise<SystemEvent[]> {\n    const url = new URL(\"/api/events\", this.backendUrl);\n    url.searchParams.set(\"session_id\", sessionId);\n    if (afterId > 0) url.searchParams.set(\"after_id\", String(afterId));\n    if (limit) url.searchParams.set(\"limit\", String(limit));\n\n    console.log(\"游댯 [fetchEventsAfter] URL:\", url.toString());\n\n    const response = await fetch(url.toString());\n    if (!response.ok) {\n      throw new Error(`Failed to fetch events: HTTP ${response.status}`);\n    }\n    return (await response.json()) as SystemEvent[];\n  }\n\n  subscribeToUpdatesWithNotification(\n    sessionId: string,\n    onUpdate: (update: SystemUpdateNotification) => void,\n    onError?: (error: unknown) => void\n  ): () => void {\n    return this.subscribeToUpdatesInternal(\n      sessionId,\n      onUpdate,\n      onError,\n      \"subscribeToUpdatesWithNotification\"\n    );\n  }\n}\n","\"use client\";\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport {\n  AssistantRuntimeProvider,\n  type ExternalStoreThreadData,\n  useExternalStoreRuntime,\n  type AppendMessage,\n} from \"@assistant-ui/react\";\n\nimport { RuntimeActionsProvider } from \"./hooks\";\nimport { useRuntimeOrchestrator } from \"./orchestrator\";\nimport {\n  findTempIdForBackendId,\n  isThreadReady,\n  isThreadRunning,\n  markSkipInitialFetch,\n  resolveThreadId,\n  setBackendMapping,\n} from \"./backend-state\";\nimport { isPlaceholderTitle, isTempThreadId, parseTimestamp } from \"./utils\";\nimport { useThreadContext } from \"../state/thread-context\";\nimport type { ThreadMetadata } from \"../state/types\";\nimport type { WalletTxRequestHandler } from \"../utils/wallet\";\nimport { useNotification, NotificationProvider } from \"../lib/notification-context\";\nimport { WalletHandler } from \"./wallet-handler\";\nimport { EventController } from \"./event-controller\";\n\nconst sortByLastActiveDesc = (\n  [, metaA]: [string, ThreadMetadata],\n  [, metaB]: [string, ThreadMetadata]\n) => {\n  const tsA = parseTimestamp(metaA.lastActiveAt);\n  const tsB = parseTimestamp(metaB.lastActiveAt);\n  return tsB - tsA;\n};\n\nfunction buildThreadLists(threadMetadata: Map<string, ThreadMetadata>) {\n  const entries = Array.from(threadMetadata.entries()).filter(\n    ([, meta]) => !isPlaceholderTitle(meta.title)\n  );\n\n  const regularThreads = entries\n    .filter(([, meta]) => meta.status === \"regular\")\n    .sort(sortByLastActiveDesc)\n    .map(([id, meta]): ExternalStoreThreadData<\"regular\"> => ({\n      id,\n      title: meta.title || \"New Chat\",\n      status: \"regular\",\n    }));\n\n  const archivedThreads = entries\n    .filter(([, meta]) => meta.status === \"archived\")\n    .sort(sortByLastActiveDesc)\n    .map(([id, meta]): ExternalStoreThreadData<\"archived\"> => ({\n      id,\n      title: meta.title || \"New Chat\",\n      status: \"archived\",\n    }));\n\n  return { regularThreads, archivedThreads };\n}\n\nexport type AomiRuntimeProviderProps = {\n  children: ReactNode;\n  backendUrl?: string;\n  publicKey?: string;\n  onWalletTxRequest?: WalletTxRequestHandler;\n};\n\nexport function AomiRuntimeProvider({\n  children,\n  backendUrl = \"http://localhost:8080\",\n  publicKey,\n  onWalletTxRequest,\n}: Readonly<AomiRuntimeProviderProps>) {\n  const threadContext = useThreadContext();\n  const threadContextRef = useRef(threadContext);\n  threadContextRef.current = threadContext;\n\n  const currentThreadIdRef = useRef(threadContext.currentThreadId);\n  useEffect(() => {\n    currentThreadIdRef.current = threadContext.currentThreadId;\n  }, [threadContext.currentThreadId]);\n\n  const publicKeyRef = useRef(publicKey);\n  useEffect(() => {\n    publicKeyRef.current = publicKey;\n  }, [publicKey]);\n\n  const getPublicKey = useCallback(() => publicKeyRef.current, []);\n\n  const lastSubscribedThreadRef = useRef<string | null>(null);\n\n  const { showNotification } = useNotification();\n\n  // Declare refs early so they can be used in orchestrator\n  const eventControllerRef = useRef<EventController | null>(null);\n  const walletHandlerRef = useRef<WalletHandler | null>(null);\n\n  const {\n    backendStateRef,\n    polling,\n    messageController,\n    isRunning,\n    setIsRunning,\n    ensureInitialState,\n    setSystemEventsHandler,\n    backendApiRef,\n  } = useRuntimeOrchestrator(backendUrl, { getPublicKey });\n\n  // Create wallet handler\n  if (!walletHandlerRef.current) {\n    walletHandlerRef.current = new WalletHandler({\n      backendApiRef,\n      onWalletTxRequest,\n      publicKey,\n      showNotification,\n      applySessionMessagesToThread: (threadId, msgs) => {\n        messageController.inbound(threadId, msgs);\n      },\n      getCurrentThreadId: () => currentThreadIdRef.current,\n    });\n  }\n\n  // Create event controller\n  if (!eventControllerRef.current) {\n    eventControllerRef.current = new EventController({\n      backendApiRef,\n      backendStateRef,\n      showNotification,\n      handleWalletTxRequest: (sessionId, threadId, request) => {\n        walletHandlerRef.current?.handleRequest(sessionId, threadId, request);\n      },\n      setThreadMetadata: threadContext.setThreadMetadata,\n    });\n  }\n\n  const handleSystemEvents = useCallback(\n    (sessionId: string, threadId: string, events?: unknown[] | null) => {\n      eventControllerRef.current?.handleBackendSystemEvents(sessionId, threadId, events);\n    },\n    []\n  );\n\n  useEffect(() => {\n    setSystemEventsHandler(handleSystemEvents);\n    return () => {\n      setSystemEventsHandler(null);\n    };\n  }, [handleSystemEvents, setSystemEventsHandler]);\n\n  const [updateSubscriptionsTick, setUpdateSubscriptionsTick] = useState(0);\n  const bumpUpdateSubscriptions = useCallback(() => {\n    setUpdateSubscriptionsTick((prev) => prev + 1);\n  }, []);\n\n  useEffect(() => {\n    void ensureInitialState(threadContext.currentThreadId);\n  }, [ensureInitialState, threadContext.currentThreadId]);\n\n  // Sync isRunning when thread changes - check if it's currently running\n  // This ensures isRunning is correct when switching threads\n  useEffect(() => {\n    const threadId = threadContext.currentThreadId;\n    const isCurrentlyRunning = isThreadRunning(backendStateRef.current, threadId);\n    setIsRunning(isCurrentlyRunning);\n  }, [threadContext.currentThreadId, setIsRunning]);\n\n  const currentMessages = threadContext.getThreadMessages(threadContext.currentThreadId);\n\n  useEffect(() => {\n    if (!publicKey) return;\n\n    const fetchThreadList = async () => {\n      try {\n        const threadList = await backendApiRef.current.fetchThreads(publicKey);\n        const currentContext = threadContextRef.current;\n        const newMetadata = new Map(currentContext.threadMetadata);\n        let maxChatNum = currentContext.threadCnt;\n\n        for (const thread of threadList) {\n          const rawTitle = thread.title ?? \"\";\n          const title = isPlaceholderTitle(rawTitle) ? \"\" : rawTitle;\n          const lastActive =\n            thread.last_active_at ||\n            thread.updated_at ||\n            thread.created_at ||\n            newMetadata.get(thread.session_id)?.lastActiveAt ||\n            new Date().toISOString();\n          newMetadata.set(thread.session_id, {\n            title,\n            status: thread.is_archived ? \"archived\" : \"regular\",\n            lastActiveAt: lastActive,\n          });\n\n          const match = title.match(/^Chat (\\d+)$/);\n          if (match) {\n            const num = parseInt(match[1], 10);\n            if (num > maxChatNum) {\n              maxChatNum = num;\n            }\n          }\n        }\n\n        currentContext.setThreadMetadata(newMetadata);\n        if (maxChatNum > currentContext.threadCnt) {\n          currentContext.setThreadCnt(maxChatNum);\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch thread list:\", error);\n      }\n    };\n\n    void fetchThreadList();\n  }, [publicKey]);\n\n  const threadListAdapter = useMemo(() => {\n    const backendState = backendStateRef.current;\n    const { regularThreads, archivedThreads } = buildThreadLists(threadContext.threadMetadata);\n\n    const preparePendingThread = (threadId: string) => {\n      const previousPendingId = backendState.creatingThreadId;\n      if (previousPendingId && previousPendingId !== threadId) {\n        threadContext.setThreadMetadata((prev) => {\n          const next = new Map(prev);\n          next.delete(previousPendingId);\n          return next;\n        });\n        threadContext.setThreads((prev) => {\n          const next = new Map(prev);\n          next.delete(previousPendingId);\n          return next;\n        });\n        backendState.pendingChat.delete(previousPendingId);\n        backendState.pendingSystem.delete(previousPendingId);\n        backendState.tempToBackendId.delete(previousPendingId);\n        backendState.skipInitialFetch.delete(previousPendingId);\n      }\n      backendState.creatingThreadId = threadId;\n      backendState.pendingChat.delete(threadId);\n      backendState.pendingSystem.delete(threadId);\n      threadContext.setThreadMetadata((prev) =>\n        new Map(prev).set(threadId, {\n          title: \"New Chat\",\n          status: \"pending\",\n          lastActiveAt: new Date().toISOString(),\n        })\n      );\n      threadContext.setThreadMessages(threadId, []);\n      threadContext.setCurrentThreadId(threadId);\n      setIsRunning(false);\n      threadContext.bumpThreadViewKey();\n    };\n\n    const findPendingThreadId = () => {\n      if (backendState.creatingThreadId) return backendState.creatingThreadId;\n      for (const [id, meta] of threadContext.threadMetadata.entries()) {\n        if (meta.status === \"pending\") return id;\n      }\n      return null;\n    };\n\n    return {\n      threadId: threadContext.currentThreadId,\n      threads: regularThreads,\n      archivedThreads,\n\n      onSwitchToNewThread: async () => {\n        const previousThreadId = currentThreadIdRef.current;\n\n        // Stop polling and interrupt if currently running\n        polling.stopAll();\n        if (isRunning && isThreadReady(backendState, previousThreadId)) {\n          const backendId = resolveThreadId(backendState, previousThreadId);\n          void backendApiRef.current.postInterrupt(backendId);\n        }\n\n        const pendingId = findPendingThreadId();\n        if (pendingId) {\n          preparePendingThread(pendingId);\n          return;\n        }\n\n        if (backendState.createThreadPromise) {\n          preparePendingThread(backendState.creatingThreadId ?? `temp-${crypto.randomUUID()}`);\n          return;\n        }\n\n        const tempId = `temp-${crypto.randomUUID()}`;\n        preparePendingThread(tempId);\n\n        const createPromise = backendApiRef.current\n          .createThread(publicKey, undefined)\n          .then(async (newThread) => {\n            const uiThreadId = backendState.creatingThreadId ?? tempId;\n            const backendId = newThread.session_id;\n\n            setBackendMapping(backendState, uiThreadId, backendId);\n            markSkipInitialFetch(backendState, uiThreadId);\n\n            bumpUpdateSubscriptions();\n\n            const backendTitle = newThread.title;\n            if (backendTitle && !isPlaceholderTitle(backendTitle)) {\n              threadContext.setThreadMetadata((prev) => {\n                const next = new Map(prev);\n                const existing = next.get(uiThreadId);\n                const nextStatus = existing?.status === \"archived\" ? \"archived\" : \"regular\";\n                next.set(uiThreadId, {\n                  title: backendTitle,\n                  status: nextStatus,\n                  lastActiveAt: existing?.lastActiveAt ?? new Date().toISOString(),\n                });\n                return next;\n              });\n            }\n\n            if (backendState.creatingThreadId === uiThreadId) {\n              backendState.creatingThreadId = null;\n            }\n\n            const pendingMessages = backendState.pendingChat.get(uiThreadId);\n            if (pendingMessages?.length) {\n              backendState.pendingChat.delete(uiThreadId);\n              for (const text of pendingMessages) {\n                try {\n                  const activePublicKey = publicKeyRef.current;\n                  if (activePublicKey) {\n                    await backendApiRef.current.postChatMessage(\n                      backendId,\n                      text,\n                      activePublicKey\n                    );\n                  } else {\n                    await backendApiRef.current.postChatMessage(backendId, text);\n                  }\n                } catch (error) {\n                  console.error(\"Failed to send queued message:\", error);\n                }\n              }\n              if (currentThreadIdRef.current === uiThreadId) {\n                polling?.start(uiThreadId);\n              }\n            }\n          })\n          .catch((error) => {\n            console.error(\"Failed to create new thread:\", error);\n            const failedId = backendState.creatingThreadId ?? tempId;\n            threadContext.setThreadMetadata((prev) => {\n              const next = new Map(prev);\n              next.delete(failedId);\n              return next;\n            });\n            threadContext.setThreads((prev) => {\n              const next = new Map(prev);\n              next.delete(failedId);\n              return next;\n            });\n            if (backendState.creatingThreadId === failedId) {\n              backendState.creatingThreadId = null;\n            }\n          })\n          .finally(() => {\n            backendState.createThreadPromise = null;\n          });\n\n        backendState.createThreadPromise = createPromise;\n      },\n\n      onSwitchToThread: (threadId: string) => {\n        const previousThreadId = currentThreadIdRef.current;\n\n        // Stop polling and interrupt if currently running\n        polling.stopAll();\n        if (isRunning && isThreadReady(backendState, previousThreadId)) {\n          const backendId = resolveThreadId(backendState, previousThreadId);\n          void backendApiRef.current.postInterrupt(backendId);\n        }\n\n        threadContext.setCurrentThreadId(threadId);\n      },\n\n      onRename: async (threadId: string, newTitle: string) => {\n        const previousTitle = threadContext.getThreadMetadata(threadId)?.title ?? \"\";\n        const normalizedTitle = isPlaceholderTitle(newTitle) ? \"\" : newTitle;\n        threadContext.updateThreadMetadata(threadId, {\n          title: normalizedTitle,\n        });\n\n        try {\n          await backendApiRef.current.renameThread(threadId, newTitle);\n        } catch (error) {\n          console.error(\"Failed to rename thread:\", error);\n          threadContext.updateThreadMetadata(threadId, { title: previousTitle });\n        }\n      },\n\n      onArchive: async (threadId: string) => {\n        threadContext.updateThreadMetadata(threadId, { status: \"archived\" });\n\n        try {\n          await backendApiRef.current.archiveThread(threadId);\n        } catch (error) {\n          console.error(\"Failed to archive thread:\", error);\n          threadContext.updateThreadMetadata(threadId, { status: \"regular\" });\n        }\n      },\n\n      onUnarchive: async (threadId: string) => {\n        threadContext.updateThreadMetadata(threadId, { status: \"regular\" });\n\n        try {\n          await backendApiRef.current.unarchiveThread(threadId);\n        } catch (error) {\n          console.error(\"Failed to unarchive thread:\", error);\n          threadContext.updateThreadMetadata(threadId, { status: \"archived\" });\n        }\n      },\n\n      onDelete: async (threadId: string) => {\n        try {\n          await backendApiRef.current.deleteThread(threadId);\n\n          threadContext.setThreadMetadata((prev) => {\n            const next = new Map(prev);\n            next.delete(threadId);\n            return next;\n          });\n          threadContext.setThreads((prev) => {\n            const next = new Map(prev);\n            next.delete(threadId);\n            return next;\n          });\n          backendState.pendingChat.delete(threadId);\n          backendState.pendingSystem.delete(threadId);\n          backendState.tempToBackendId.delete(threadId);\n          backendState.skipInitialFetch.delete(threadId);\n          backendState.runningThreads.delete(threadId);\n          if (backendState.creatingThreadId === threadId) {\n            backendState.creatingThreadId = null;\n          }\n\n          if (threadContext.currentThreadId === threadId) {\n            const firstRegularThread = Array.from(threadContext.threadMetadata.entries()).find(\n              ([id, meta]) => meta.status === \"regular\" && id !== threadId\n            );\n\n            if (firstRegularThread) {\n              threadContext.setCurrentThreadId(firstRegularThread[0]);\n            } else {\n              const defaultId = \"default-session\";\n              threadContext.setThreadMetadata((prev) =>\n                new Map(prev).set(defaultId, {\n                  title: \"New Chat\",\n                  status: \"regular\",\n                  lastActiveAt: new Date().toISOString(),\n                })\n              );\n              threadContext.setThreadMessages(defaultId, []);\n              threadContext.setCurrentThreadId(defaultId);\n            }\n          }\n        } catch (error) {\n          console.error(\"Failed to delete thread:\", error);\n          throw error;\n        }\n      },\n    };\n  }, [\n    backendApiRef,\n    polling,\n    publicKey,\n    backendStateRef,\n    setIsRunning,\n    threadContext,\n    threadContext.currentThreadId,\n    threadContext.threadMetadata,\n    bumpUpdateSubscriptions,\n  ]);\n\n\n  useEffect(() => {\n    const threadId = threadContext.currentThreadId;\n    if (!isTempThreadId(threadId)) return;\n    if (!isThreadReady(backendStateRef.current, threadId)) return;\n    void messageController.flushPendingChat(threadId);\n  }, [messageController, backendStateRef, threadContext.currentThreadId]);\n\n  const runtime = useExternalStoreRuntime({\n    messages: currentMessages,\n    setMessages: (msgs) =>\n      threadContext.setThreadMessages(threadContext.currentThreadId, [...msgs]),\n    isRunning,\n    onNew: (message: AppendMessage) =>\n      messageController.outbound(message, threadContext.currentThreadId),\n    onCancel: () => messageController.cancel(threadContext.currentThreadId),\n    convertMessage: (msg) => msg,\n    adapters: { threadList: threadListAdapter },\n  });\n\n  useEffect(() => {\n    const threadId = threadContext.currentThreadId;\n    if (isTempThreadId(threadId)) return;\n    const hasUserMessages = currentMessages.some((msg) => msg.role === \"user\");\n    if (hasUserMessages) {\n      void messageController.flushPendingSystem(threadId);\n    }\n  }, [currentMessages, messageController, threadContext.currentThreadId]);\n\n  useEffect(() => {\n    return () => {\n      polling.stopAll();\n      eventControllerRef.current?.cleanup();\n    };\n  }, [polling]);\n\n  // Update event controller subscription when current thread changes\n  useEffect(() => {\n    const backendState = backendStateRef.current;\n    const threadId = threadContext.currentThreadId;\n    const isReady = isThreadReady(backendState, threadId);\n    if (!isReady) {\n      lastSubscribedThreadRef.current = null;\n      eventControllerRef.current?.setSubscribableSessionId(null);\n      return;\n    }\n\n    const isCurrentlyRunning = isThreadRunning(backendState, threadId);\n    if (isCurrentlyRunning) {\n      const sessionId = resolveThreadId(backendState, threadId);\n      eventControllerRef.current?.setSubscribableSessionId(sessionId);\n      lastSubscribedThreadRef.current = threadId;\n      return;\n    }\n\n    if (lastSubscribedThreadRef.current !== threadId) {\n      eventControllerRef.current?.setSubscribableSessionId(null);\n    }\n  }, [backendStateRef, threadContext.currentThreadId, updateSubscriptionsTick, isRunning]);\n\n  return (\n    <RuntimeActionsProvider\n      value={{\n        sendSystemMessage: (message: string) =>\n          messageController.outboundSystem(threadContext.currentThreadId, message),\n      }}\n    >\n      <AssistantRuntimeProvider runtime={runtime}>{children}</AssistantRuntimeProvider>\n    </RuntimeActionsProvider>\n  );\n}\n\n// Wrapper component that provides NotificationProvider\nexport function AomiRuntimeProviderWithNotifications(\n  props: Readonly<AomiRuntimeProviderProps>\n) {\n  return (\n    <NotificationProvider>\n      <AomiRuntimeProvider {...props} />\n    </NotificationProvider>\n  );\n}\n","\"use client\";\n\nimport { createContext, useContext } from \"react\";\n\nexport type RuntimeActions = {\n  sendSystemMessage: (message: string) => Promise<void>;\n};\n\nconst RuntimeActionsContext = createContext<RuntimeActions | undefined>(undefined);\n\nexport const RuntimeActionsProvider = RuntimeActionsContext.Provider;\n\nexport function useRuntimeActions(): RuntimeActions {\n  const context = useContext(RuntimeActionsContext);\n  if (!context) {\n    throw new Error(\"useRuntimeActions must be used within AomiRuntimeProvider\");\n  }\n  return context;\n}\n","import type { MutableRefObject } from \"react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\nimport { BackendApi } from \"../api/client\";\nimport type { SessionMessage } from \"../api/types\";\nimport { useThreadContext, type ThreadContext } from \"../state/thread-context\";\nimport { MessageController } from \"./message-controller\";\nimport { PollingController } from \"./polling-controller\";\nimport {\n  clearSkipInitialFetch,\n  createBakendState,\n  isThreadReady,\n  resolveThreadId,\n  shouldSkipInitialFetch,\n  type BakendState,\n} from \"./backend-state\";\n\ntype SystemEventsHandler = (\n  sessionId: string,\n  threadId: string,\n  events?: unknown[] | null\n) => void;\n\nexport function useRuntimeOrchestrator(\n  backendUrl: string,\n  options?: { getPublicKey?: () => string | undefined }\n) {\n  const threadContext = useThreadContext();\n  const threadContextRef = useRef<ThreadContext>(threadContext);\n  threadContextRef.current = threadContext;\n  const backendApiRef = useRef(new BackendApi(backendUrl));\n  const backendStateRef = useRef<BakendState>(createBakendState());\n\n  const [isRunning, setIsRunning] = useState(false);\n\n  const messageControllerRef: MutableRefObject<MessageController | null> = useRef(null);\n  const pollingRef: MutableRefObject<PollingController | null> = useRef(null);\n  const systemEventsHandlerRef = useRef<SystemEventsHandler | null>(null);\n  const inFlightRef = useRef<Map<string, AbortController>>(new Map());\n\n  if (!pollingRef.current) {\n    pollingRef.current = new PollingController({\n      backendApiRef,\n      backendStateRef,\n      applyMessages: (threadId: string, msgs?: SessionMessage[] | null) => {\n        messageControllerRef.current?.inbound(threadId, msgs);\n      },\n      onStart: (threadId: string) => {\n        if (threadContextRef.current.currentThreadId === threadId) {\n          setIsRunning(true);\n        }\n      },\n      onStop: (threadId: string) => {\n        if (threadContextRef.current.currentThreadId === threadId) {\n          setIsRunning(false);\n        }\n      },\n    });\n  }\n\n  if (!messageControllerRef.current) {\n    messageControllerRef.current = new MessageController({\n      backendApiRef,\n      backendStateRef,\n      threadContextRef,\n      polling: pollingRef.current,\n      setGlobalIsRunning: setIsRunning,\n      getPublicKey: options?.getPublicKey,\n    });\n  }\n\n  const setSystemEventsHandler = useCallback((handler: SystemEventsHandler | null) => {\n    systemEventsHandlerRef.current = handler;\n    pollingRef.current?.setSystemEventsHandler(handler ?? undefined);\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      for (const controller of inFlightRef.current.values()) {\n        controller.abort();\n      }\n      inFlightRef.current.clear();\n    };\n  }, []);\n\n  const ensureInitialState = useCallback(\n    async (threadId: string) => {\n      const backendState = backendStateRef.current;\n      if (shouldSkipInitialFetch(backendState, threadId)) {\n        clearSkipInitialFetch(backendState, threadId);\n        if (threadContextRef.current.currentThreadId === threadId) {\n          setIsRunning(false);\n        }\n        return;\n      }\n\n      if (!isThreadReady(backendState, threadId)) {\n        if (threadContextRef.current.currentThreadId === threadId) {\n          setIsRunning(false);\n        }\n        return;\n      }\n\n      if (inFlightRef.current.has(threadId)) {\n        return;\n      }\n\n      const backendThreadId = resolveThreadId(backendState, threadId);\n      const controller = new AbortController();\n      inFlightRef.current.set(threadId, controller);\n      try {\n        console.log(\"游댯 [Orchestrator] Fetching initial state for threadId:\", threadId);\n        const state = await backendApiRef.current.fetchState(backendThreadId, {\n          signal: controller.signal,\n        });\n        messageControllerRef.current?.inbound(threadId, state.messages);\n        // Handle system events if handler is provided\n        if (systemEventsHandlerRef.current && state.system_events) {\n          systemEventsHandlerRef.current(backendThreadId, threadId, state.system_events);\n        }\n        if (state.is_processing) {\n          if (threadContextRef.current.currentThreadId === threadId) {\n            setIsRunning(true);\n          }\n          pollingRef.current?.start(threadId);\n        } else {\n          if (threadContextRef.current.currentThreadId === threadId) {\n            setIsRunning(false);\n          }\n        }\n      } catch (error) {\n        if (controller.signal.aborted) {\n          return;\n        }\n        console.error(\"Failed to fetch initial state:\", error);\n        if (threadContextRef.current.currentThreadId === threadId) {\n          setIsRunning(false);\n        }\n      } finally {\n        if (inFlightRef.current.get(threadId) === controller) {\n          inFlightRef.current.delete(threadId);\n        }\n      }\n    },\n    [backendApiRef, backendStateRef, pollingRef, messageControllerRef, setIsRunning]\n  );\n\n  return {\n    backendStateRef,\n    polling: pollingRef.current!,\n    messageController: messageControllerRef.current!,\n    isRunning,\n    setIsRunning,\n    ensureInitialState,\n    setSystemEventsHandler,\n    backendApiRef,\n  };\n}\n","\"use client\";\n\nimport { createContext, useContext, useMemo, useRef, useSyncExternalStore } from \"react\";\nimport type { ReactNode } from \"react\";\nimport type { ThreadMessageLike } from \"@assistant-ui/react\";\n\nimport type { ThreadMetadata } from \"./types\";\nimport { ThreadStore, type ThreadContext as ThreadContextValue } from \"./thread-store\";\n\nexport type ThreadContext = ThreadContextValue;\n\nexport type ThreadContextProviderProps = {\n  children: ReactNode;\n  initialThreadId?: string;\n};\n\nconst ThreadContextState = createContext<ThreadContextValue | null>(null);\n\nexport function useThreadContext(): ThreadContext {\n  const context = useContext(ThreadContextState);\n  if (!context) {\n    throw new Error(\n      \"useThreadContext must be used within ThreadContextProvider. \" +\n        \"Wrap your app with <ThreadContextProvider>...</ThreadContextProvider>\"\n    );\n  }\n  return context;\n}\n\nexport function ThreadContextProvider({\n  children,\n  initialThreadId,\n}: ThreadContextProviderProps) {\n  const storeRef = useRef<ThreadStore | null>(null);\n  if (!storeRef.current) {\n    storeRef.current = new ThreadStore({ initialThreadId });\n  }\n  const store = storeRef.current;\n  const value = useSyncExternalStore(store.subscribe, store.getSnapshot);\n\n  return (\n    <ThreadContextState.Provider value={value}>{children}</ThreadContextState.Provider>\n  );\n}\n\nexport function useCurrentThreadMessages(): ThreadMessageLike[] {\n  const { currentThreadId, getThreadMessages } = useThreadContext();\n  return useMemo(() => getThreadMessages(currentThreadId), [currentThreadId, getThreadMessages]);\n}\n\nexport function useCurrentThreadMetadata(): ThreadMetadata | undefined {\n  const { currentThreadId, getThreadMetadata } = useThreadContext();\n  return useMemo(() => getThreadMetadata(currentThreadId), [currentThreadId, getThreadMetadata]);\n}\n","import type { SetStateAction } from \"react\";\nimport type { ThreadMessageLike } from \"@assistant-ui/react\";\n\nimport type { ThreadMetadata } from \"./types\";\n\nexport type ThreadContext = {\n  currentThreadId: string;\n  setCurrentThreadId: (id: string) => void;\n  threadViewKey: number;\n  bumpThreadViewKey: () => void;\n  threads: Map<string, ThreadMessageLike[]>;\n  setThreads: (updater: SetStateAction<Map<string, ThreadMessageLike[]>>) => void;\n  threadMetadata: Map<string, ThreadMetadata>;\n  setThreadMetadata: (updater: SetStateAction<Map<string, ThreadMetadata>>) => void;\n  threadCnt: number;\n  setThreadCnt: (updater: SetStateAction<number>) => void;\n  getThreadMessages: (threadId: string) => ThreadMessageLike[];\n  setThreadMessages: (threadId: string, messages: ThreadMessageLike[]) => void;\n  getThreadMetadata: (threadId: string) => ThreadMetadata | undefined;\n  updateThreadMetadata: (threadId: string, updates: Partial<ThreadMetadata>) => void;\n};\n\ntype ThreadStoreState = {\n  currentThreadId: string;\n  threadViewKey: number;\n  threadCnt: number;\n  threads: Map<string, ThreadMessageLike[]>;\n  threadMetadata: Map<string, ThreadMetadata>;\n};\n\ntype ThreadStoreOptions = {\n  initialThreadId?: string;\n};\n\nexport class ThreadStore {\n  private state: ThreadStoreState;\n  private listeners = new Set<() => void>();\n  private snapshot: ThreadContext;\n\n  constructor(options?: ThreadStoreOptions) {\n    const initialThreadId = options?.initialThreadId ?? crypto.randomUUID();\n    this.state = {\n      currentThreadId: initialThreadId,\n      threadViewKey: 0,\n      threadCnt: 1,\n      threads: new Map([[initialThreadId, []]]),\n      threadMetadata: new Map([\n        [\n          initialThreadId,\n          {\n            title: \"New Chat\",\n            status: \"pending\",\n            lastActiveAt: new Date().toISOString(),\n          },\n        ],\n      ]),\n    };\n\n    this.snapshot = this.buildSnapshot();\n  }\n\n  subscribe = (listener: () => void): (() => void) => {\n    this.listeners.add(listener);\n    return () => {\n      this.listeners.delete(listener);\n    };\n  };\n\n  getSnapshot = (): ThreadContext => this.snapshot;\n\n  private emit() {\n    for (const listener of this.listeners) {\n      listener();\n    }\n  }\n\n  private resolveStateAction<T>(updater: SetStateAction<T>, current: T): T {\n    return typeof updater === \"function\" ? (updater as (prev: T) => T)(current) : updater;\n  }\n\n  private ensureThreadExists(threadId: string) {\n    if (!this.state.threadMetadata.has(threadId)) {\n      const nextMetadata = new Map(this.state.threadMetadata);\n      nextMetadata.set(threadId, {\n        title: \"New Chat\",\n        status: \"regular\",\n        lastActiveAt: new Date().toISOString(),\n      });\n      this.state = { ...this.state, threadMetadata: nextMetadata };\n    }\n\n    if (!this.state.threads.has(threadId)) {\n      const nextThreads = new Map(this.state.threads);\n      nextThreads.set(threadId, []);\n      this.state = { ...this.state, threads: nextThreads };\n    }\n  }\n\n  private updateState(partial: Partial<ThreadStoreState>) {\n    this.state = { ...this.state, ...partial };\n    this.snapshot = this.buildSnapshot();\n    this.emit();\n  }\n\n  private buildSnapshot(): ThreadContext {\n    return {\n      currentThreadId: this.state.currentThreadId,\n      setCurrentThreadId: this.setCurrentThreadId,\n      threadViewKey: this.state.threadViewKey,\n      bumpThreadViewKey: this.bumpThreadViewKey,\n      threads: this.state.threads,\n      setThreads: this.setThreads,\n      threadMetadata: this.state.threadMetadata,\n      setThreadMetadata: this.setThreadMetadata,\n      threadCnt: this.state.threadCnt,\n      setThreadCnt: this.setThreadCnt,\n      getThreadMessages: this.getThreadMessages,\n      setThreadMessages: this.setThreadMessages,\n      getThreadMetadata: this.getThreadMetadata,\n      updateThreadMetadata: this.updateThreadMetadata,\n    };\n  }\n\n  setCurrentThreadId = (threadId: string) => {\n    this.ensureThreadExists(threadId);\n    this.updateState({ currentThreadId: threadId });\n  };\n\n  bumpThreadViewKey = () => {\n    this.updateState({ threadViewKey: this.state.threadViewKey + 1 });\n  };\n\n  setThreadCnt = (updater: SetStateAction<number>) => {\n    const nextCnt = this.resolveStateAction(updater, this.state.threadCnt);\n    this.updateState({ threadCnt: nextCnt });\n  };\n\n  setThreads = (updater: SetStateAction<Map<string, ThreadMessageLike[]>>) => {\n    const nextThreads = this.resolveStateAction(updater, this.state.threads);\n    this.updateState({ threads: new Map(nextThreads) });\n  };\n\n  setThreadMetadata = (updater: SetStateAction<Map<string, ThreadMetadata>>) => {\n    const nextMetadata = this.resolveStateAction(updater, this.state.threadMetadata);\n    this.updateState({ threadMetadata: new Map(nextMetadata) });\n  };\n\n  setThreadMessages = (threadId: string, messages: ThreadMessageLike[]) => {\n    this.ensureThreadExists(threadId);\n    const nextThreads = new Map(this.state.threads);\n    nextThreads.set(threadId, messages);\n    this.updateState({ threads: nextThreads });\n  };\n\n  getThreadMessages = (threadId: string): ThreadMessageLike[] => {\n    return this.state.threads.get(threadId) ?? [];\n  };\n\n  getThreadMetadata = (threadId: string): ThreadMetadata | undefined => {\n    return this.state.threadMetadata.get(threadId);\n  };\n\n  updateThreadMetadata = (threadId: string, updates: Partial<ThreadMetadata>) => {\n    const existing = this.state.threadMetadata.get(threadId);\n    if (!existing) {\n      return;\n    }\n    const nextMetadata = new Map(this.state.threadMetadata);\n    nextMetadata.set(threadId, { ...existing, ...updates });\n    this.updateState({ threadMetadata: nextMetadata });\n  };\n}\n","import type { ThreadMessageLike } from \"@assistant-ui/react\";\n\nimport type { SessionMessage } from \"../api/types\";\n\ntype MessageContentPart = Exclude<ThreadMessageLike[\"content\"], string> extends readonly (infer U)[] ? U : never;\n\nexport function toInboundMessage(msg: SessionMessage): ThreadMessageLike | null {\n  if (msg.sender === \"system\") return null;\n\n  const content: MessageContentPart[] = [];\n  const role: ThreadMessageLike[\"role\"] = msg.sender === \"user\" ? \"user\" : \"assistant\";\n\n  if (msg.content) {\n    content.push({ type: \"text\" as const, text: msg.content });\n  }\n\n  const [topic, toolContent] = parseToolStream(msg.tool_stream) ?? [];\n  if (topic && toolContent) {\n    content.push({\n      type: \"tool-call\" as const,\n      toolCallId: `tool_${Date.now()}`,\n      toolName: topic,\n      args: undefined,\n      result: (() => {\n        try {\n          return JSON.parse(toolContent);\n        } catch {\n          return { args: toolContent };\n        }\n      })(),\n    });\n  }\n\n  const threadMessage = {\n    role,\n    content: (content.length > 0 ? content : [{ type: \"text\" as const, text: \"\" }]) as ThreadMessageLike[\"content\"],\n    ...(msg.timestamp && { createdAt: new Date(msg.timestamp) }),\n  } satisfies ThreadMessageLike;\n\n  return threadMessage;\n}\n\nexport function toInboundSystem(msg: SessionMessage): ThreadMessageLike | null {\n  const [topic] = parseToolStream(msg.tool_stream) ?? [];\n  const messageText = topic || msg.content || \"\";\n  const timestamp = parseTimestamp(msg.timestamp);\n\n  if (!messageText.trim()) return null;\n\n  return {\n    role: \"system\",\n    content: [{ type: \"text\", text: messageText }],\n    ...(timestamp && { createdAt: timestamp }),\n  } satisfies ThreadMessageLike;\n}\n\nexport function constructUITool(): string {\n  return \"\";\n}\n\nfunction parseTimestamp(timestamp?: string) {\n  if (!timestamp) return undefined;\n  const parsed = new Date(timestamp);\n  return Number.isNaN(parsed.valueOf()) ? undefined : parsed;\n}\n\nfunction parseToolStream(toolStream: SessionMessage[\"tool_stream\"]): [string, string] | null {\n  if (!toolStream) return null;\n\n  if (Array.isArray(toolStream) && toolStream.length === 2) {\n    const [topic, content] = toolStream;\n    return [String(topic), content];\n  }\n\n  if (typeof toolStream === \"object\") {\n    const topic = (toolStream as { topic?: unknown }).topic;\n    const content = (toolStream as { content?: unknown }).content;\n    return topic ? [String(topic), String(content)] : null;\n  }\n\n  return null;\n}\n","export const isTempThreadId = (id: string) => id.startsWith(\"temp-\");\n\nexport const parseTimestamp = (value?: string | number) => {\n  if (value === undefined || value === null) return 0;\n  if (typeof value === \"number\") {\n    return Number.isFinite(value) ? (value < 1e12 ? value * 1000 : value) : 0;\n  }\n\n  const numeric = Number(value);\n  if (!Number.isNaN(numeric)) {\n    return numeric < 1e12 ? numeric * 1000 : numeric;\n  }\n\n  const ts = Date.parse(value);\n  return Number.isNaN(ts) ? 0 : ts;\n};\n\nexport const isPlaceholderTitle = (title?: string) => {\n  const normalized = title?.trim() ?? \"\";\n  return !normalized || normalized.startsWith(\"#[\");\n};\n","import { isTempThreadId } from \"./utils\";\n\nexport type BakendState = {\n  tempToBackendId: Map<string, string>;\n  skipInitialFetch: Set<string>;\n  pendingChat: Map<string, string[]>;\n  pendingSystem: Map<string, string[]>;\n  runningThreads: Set<string>;\n  creatingThreadId: string | null;\n  createThreadPromise: Promise<void> | null;\n};\n\nexport function createBakendState(): BakendState {\n  return {\n    tempToBackendId: new Map(),\n    skipInitialFetch: new Set(),\n    pendingChat: new Map(),\n    pendingSystem: new Map(),\n    runningThreads: new Set(),\n    creatingThreadId: null,\n    createThreadPromise: null,\n  };\n}\n\nexport function resolveThreadId(state: BakendState, threadId: string): string {\n  return state.tempToBackendId.get(threadId) ?? threadId;\n}\n\nexport function isThreadReady(state: BakendState, threadId: string): boolean {\n  if (!isTempThreadId(threadId)) return true;\n  return state.tempToBackendId.has(threadId);\n}\n\nexport function setBackendMapping(\n  state: BakendState,\n  tempId: string,\n  backendId: string\n) {\n  state.tempToBackendId.set(tempId, backendId);\n}\n\nexport function findTempIdForBackendId(\n  state: BakendState,\n  backendId: string\n): string | undefined {\n  for (const [tempId, id] of state.tempToBackendId.entries()) {\n    if (id === backendId) return tempId;\n  }\n  return undefined;\n}\n\nexport function markSkipInitialFetch(state: BakendState, threadId: string) {\n  state.skipInitialFetch.add(threadId);\n}\n\nexport function shouldSkipInitialFetch(\n  state: BakendState,\n  threadId: string\n): boolean {\n  return state.skipInitialFetch.has(threadId);\n}\n\nexport function clearSkipInitialFetch(state: BakendState, threadId: string) {\n  state.skipInitialFetch.delete(threadId);\n}\n\nexport function setThreadRunning(state: BakendState, threadId: string, running: boolean) {\n  if (running) {\n    state.runningThreads.add(threadId);\n  } else {\n    state.runningThreads.delete(threadId);\n  }\n}\n\nexport function isThreadRunning(state: BakendState, threadId: string): boolean {\n  return state.runningThreads.has(threadId);\n}\n\nexport function enqueuePendingChat(state: BakendState, threadId: string, text: string) {\n  const existing = state.pendingChat.get(threadId) ?? [];\n  state.pendingChat.set(threadId, [...existing, text]);\n}\n\nexport function dequeuePendingChat(state: BakendState, threadId: string): string[] {\n  const pending = state.pendingChat.get(threadId) ?? [];\n  state.pendingChat.delete(threadId);\n  return pending;\n}\n\nexport function hasPendingChat(state: BakendState, threadId: string): boolean {\n  return (state.pendingChat.get(threadId)?.length ?? 0) > 0;\n}\n\nexport function enqueuePendingSystem(state: BakendState, threadId: string, text: string) {\n  const existing = state.pendingSystem.get(threadId) ?? [];\n  state.pendingSystem.set(threadId, [...existing, text]);\n}\n\nexport function dequeuePendingSystem(state: BakendState, threadId: string): string[] {\n  const pending = state.pendingSystem.get(threadId) ?? [];\n  state.pendingSystem.delete(threadId);\n  return pending;\n}\n\nexport function hasPendingSystem(state: BakendState, threadId: string): boolean {\n  return (state.pendingSystem.get(threadId)?.length ?? 0) > 0;\n}\n","import type { MutableRefObject } from \"react\";\nimport type { AppendMessage, ThreadMessageLike } from \"@assistant-ui/react\";\n\nimport type { BackendApi } from \"../api/client\";\nimport type { SessionMessage } from \"../api/types\";\nimport { toInboundSystem, toInboundMessage } from \"../utils/conversion\";\nimport type { ThreadContext } from \"../state/thread-context\";\nimport type { PollingController } from \"./polling-controller\";\nimport {\n  dequeuePendingChat,\n  dequeuePendingSystem,\n  enqueuePendingChat,\n  enqueuePendingSystem,\n  hasPendingChat,\n  isThreadReady,\n  resolveThreadId,\n  setThreadRunning,\n  type BakendState,\n} from \"./backend-state\";\n\ntype MessageControllerConfig = {\n  backendApiRef: MutableRefObject<BackendApi>;\n  backendStateRef: MutableRefObject<BakendState>;\n  threadContextRef: MutableRefObject<ThreadContext>;\n  polling: PollingController;\n  setGlobalIsRunning?: (running: boolean) => void;\n  getPublicKey?: () => string | undefined;\n};\n\ntype ThreadContextApi = Pick<\n  ThreadContext,\n  \"getThreadMessages\" | \"setThreadMessages\" | \"updateThreadMetadata\"\n>;\n\nexport class MessageController {\n  constructor(private readonly config: MessageControllerConfig) {}\n\n  inbound(threadId: string, msgs?: SessionMessage[] | null) {\n    const backendState = this.config.backendStateRef.current;\n    if (!msgs) return;\n    if (hasPendingChat(backendState, threadId)) {\n      // Avoid overwriting optimistic UI when pending user messages exist.\n      return;\n    }\n\n    const threadMessages: ThreadMessageLike[] = [];\n    for (const msg of msgs) {\n      if (msg.sender === \"system\") {\n        const systemMessage = toInboundSystem(msg);\n        if (systemMessage) {\n          threadMessages.push(systemMessage);\n        }\n        continue;\n      }\n      const threadMessage = toInboundMessage(msg);\n      if (threadMessage) {\n        threadMessages.push(threadMessage);\n      }\n    }\n\n    this.getThreadContextApi().setThreadMessages(threadId, threadMessages);\n  }\n\n  async outbound(message: AppendMessage, threadId: string) {\n    const backendState = this.config.backendStateRef.current;\n    const text = message.content\n      .filter((part): part is Extract<typeof part, { type: \"text\" }> => part.type === \"text\")\n      .map((part: Extract<typeof message.content[number], { type: \"text\" }>) => part.text)\n      .join(\"\\n\");\n\n    if (!text) return;\n\n    const threadState = this.getThreadContextApi();\n    const existingMessages = threadState.getThreadMessages(threadId);\n    const userMessage: ThreadMessageLike = {\n      role: \"user\",\n      content: [{ type: \"text\", text }],\n      createdAt: new Date(),\n    };\n\n    threadState.setThreadMessages(threadId, [...existingMessages, userMessage]);\n    threadState.updateThreadMetadata(threadId, { lastActiveAt: new Date().toISOString() });\n\n    if (!isThreadReady(backendState, threadId)) {\n      this.markRunning(threadId, true);\n      enqueuePendingChat(backendState, threadId, text);\n      return;\n    }\n\n    const backendThreadId = resolveThreadId(backendState, threadId);\n    const publicKey = this.config.getPublicKey?.();\n\n    try {\n      this.markRunning(threadId, true);\n      if (publicKey) {\n        await this.config.backendApiRef.current.postChatMessage(\n          backendThreadId,\n          text,\n          publicKey\n        );\n      } else {\n        await this.config.backendApiRef.current.postChatMessage(backendThreadId, text);\n      }\n      await this.flushPendingSystem(threadId);\n      this.config.polling.start(threadId);\n    } catch (error) {\n      console.error(\"Failed to send message:\", error);\n      this.markRunning(threadId, false);\n    }\n  }\n\n  async outboundSystem(threadId: string, text: string) {\n    const backendState = this.config.backendStateRef.current;\n    if (!isThreadReady(backendState, threadId)) return;\n    const threadMessages = this.getThreadContextApi().getThreadMessages(threadId);\n    const hasUserMessages = threadMessages.some((msg) => msg.role === \"user\");\n\n    if (!hasUserMessages) {\n      enqueuePendingSystem(backendState, threadId, text);\n      return;\n    }\n\n    await this.outboundSystemInner(threadId, text);\n  }\n\n  async outboundSystemInner(threadId: string, text: string) {\n    const backendState = this.config.backendStateRef.current;\n    const threadState = this.getThreadContextApi();\n    const backendThreadId = resolveThreadId(backendState, threadId);\n    this.markRunning(threadId, true);\n    try {\n      const response = await this.config.backendApiRef.current.postSystemMessage(backendThreadId, text);\n      if (response.res) {\n        const systemMessage = toInboundSystem(response.res);\n        if (systemMessage) {\n          const updatedMessages = [...threadState.getThreadMessages(threadId), systemMessage];\n          threadState.setThreadMessages(threadId, updatedMessages);\n        }\n      }\n      await this.flushPendingSystem(threadId);\n      this.config.polling.start(threadId);\n    } catch (error) {\n      console.error(\"Failed to send system message:\", error);\n      this.markRunning(threadId, false);\n    }\n  }\n\n  async flushPendingSystem(threadId: string) {\n    const backendState = this.config.backendStateRef.current;\n    const pending = dequeuePendingSystem(backendState, threadId);\n    if (!pending.length) return;\n    for (const pendingMessage of pending) {\n      await this.outboundSystemInner(threadId, pendingMessage);\n    }\n  }\n\n  async flushPendingChat(threadId: string) {\n    const backendState = this.config.backendStateRef.current;\n    const pending = dequeuePendingChat(backendState, threadId);\n    if (!pending.length) return;\n    const backendThreadId = resolveThreadId(backendState, threadId);\n    const publicKey = this.config.getPublicKey?.();\n    for (const text of pending) {\n      try {\n        if (publicKey) {\n          await this.config.backendApiRef.current.postChatMessage(\n            backendThreadId,\n            text,\n            publicKey\n          );\n        } else {\n          await this.config.backendApiRef.current.postChatMessage(backendThreadId, text);\n        }\n      } catch (error) {\n        console.error(\"Failed to send queued message:\", error);\n      }\n    }\n    this.config.polling.start(threadId);\n  }\n\n  async cancel(threadId: string) {\n    const backendState = this.config.backendStateRef.current;\n    if (!isThreadReady(backendState, threadId)) return;\n    this.config.polling.stop(threadId);\n    const backendThreadId = resolveThreadId(backendState, threadId);\n    try {\n      await this.config.backendApiRef.current.postInterrupt(backendThreadId);\n      this.markRunning(threadId, false);\n    } catch (error) {\n      console.error(\"Failed to cancel:\", error);\n    }\n  }\n\n  private markRunning(threadId: string, running: boolean) {\n    setThreadRunning(this.config.backendStateRef.current, threadId, running);\n    if (this.config.threadContextRef.current.currentThreadId === threadId) {\n      this.config.setGlobalIsRunning?.(running);\n    }\n  }\n\n  private getThreadContextApi(): ThreadContextApi {\n    const { getThreadMessages, setThreadMessages, updateThreadMetadata } =\n      this.config.threadContextRef.current;\n    return { getThreadMessages, setThreadMessages, updateThreadMetadata };\n  }\n}\n","import type { MutableRefObject } from \"react\";\n\nimport type { BackendApi } from \"../api/client\";\nimport type { SessionMessage, SessionResponsePayload } from \"../api/types\";\nimport {\n  isThreadReady,\n  resolveThreadId,\n  setThreadRunning,\n  type BakendState,\n} from \"./backend-state\";\n\ntype PollingConfig = {\n  backendApiRef: MutableRefObject<BackendApi>;\n  backendStateRef: MutableRefObject<BakendState>;\n  applyMessages: (threadId: string, messages?: SessionMessage[] | null) => void;\n  handleSystemEvents?: (\n    sessionId: string,\n    threadId: string,\n    events?: unknown[] | null\n  ) => void;\n  onStart?: (threadId: string) => void;\n  onStop?: (threadId: string) => void;\n  intervalMs?: number;\n};\n\nexport class PollingController {\n  private intervals = new Map<string, ReturnType<typeof setInterval>>();\n  private intervalMs: number;\n  private handleSystemEvents?: (\n    sessionId: string,\n    threadId: string,\n    events?: unknown[] | null\n  ) => void;\n\n  constructor(private readonly config: PollingConfig) {\n    this.intervalMs = config.intervalMs ?? 500;\n    this.handleSystemEvents = config.handleSystemEvents;\n  }\n\n  setSystemEventsHandler(\n    handler?: (sessionId: string, threadId: string, events?: unknown[] | null) => void\n  ) {\n    this.handleSystemEvents = handler;\n  }\n\n  start(threadId: string) {\n    const backendState = this.config.backendStateRef.current;\n    if (!isThreadReady(backendState, threadId)) return;\n    // Prevent starting if already polling\n    if (this.intervals.has(threadId)) {\n      return;\n    }\n\n    const backendThreadId = resolveThreadId(backendState, threadId);\n    setThreadRunning(backendState, threadId, true);\n\n    const tick = async () => {\n      // Check if polling was stopped before proceeding (handles race conditions)\n      if (!this.intervals.has(threadId)) {\n        return;\n      }\n\n      try {\n        console.log(\"游댯 [PollingController] Fetching state for threadId:\", threadId);\n        const state = await this.config.backendApiRef.current.fetchState(backendThreadId);\n        \n        // Check again after async operation (polling might have been stopped)\n        if (!this.intervals.has(threadId)) {\n          return;\n        }\n        \n        this.handleState(threadId, state);\n      } catch (error) {\n        console.error(\"Polling error:\", error);\n        this.stop(threadId);\n      }\n    };\n\n    const intervalId = setInterval(tick, this.intervalMs);\n    this.intervals.set(threadId, intervalId);\n    \n    // Trigger onStart if provided (for setting isRunning state)\n    if (this.config.onStart) {\n      this.config.onStart(threadId);\n    }\n  }\n\n  stop(threadId: string) {\n    const intervalId = this.intervals.get(threadId);\n    if (intervalId) {\n      clearInterval(intervalId);\n      this.intervals.delete(threadId);\n    }\n    // Update state immediately to prevent any queued ticks from proceeding\n    setThreadRunning(this.config.backendStateRef.current, threadId, false);\n    this.config.onStop?.(threadId);\n  }\n\n  isPolling(threadId: string): boolean {\n    return this.intervals.has(threadId);\n  }\n\n  stopAll() {\n    for (const threadId of this.intervals.keys()) {\n      this.stop(threadId);\n    }\n  }\n\n  private handleState(threadId: string, state: SessionResponsePayload) {\n    if (state.session_exists === false) {\n      this.stop(threadId);\n      return;\n    }\n\n    const backendState = this.config.backendStateRef.current;\n    const backendThreadId = resolveThreadId(backendState, threadId);\n\n    // Handle system events if handler is provided\n    if (this.handleSystemEvents && state.system_events) {\n      this.handleSystemEvents(backendThreadId, threadId, state.system_events);\n    }\n\n    this.config.applyMessages(threadId, state.messages);\n\n    // Stop polling if backend explicitly indicates processing is complete\n    // or the flag is omitted.\n    if (!state.is_processing) {\n      this.stop(threadId);\n    }\n  }\n}\n","\"use client\";\n\nimport { createContext, useCallback, useContext, useState, type ReactNode } from \"react\";\nimport { toast } from \"sonner\";\n\nimport { Toaster } from \"../components/ui/sonner\";\n\nexport type NotificationType = \"error\" | \"notice\" | \"success\";\n\nexport type NotificationIconType =\n  | \"error\"\n  | \"success\"\n  | \"notice\"\n  | \"wallet\"\n  | \"transaction\"\n  | \"network\"\n  | \"warning\";\n\nexport type Notification = {\n  id: string;\n  type: NotificationType;\n  title: string;\n  message: string;\n  iconType?: NotificationIconType;\n  duration?: number; // in milliseconds, default 5000\n};\n\ntype NotificationContextValue = {\n  showNotification: (notification: Omit<Notification, \"id\">) => void;\n  notifications: Notification[];\n  dismissNotification: (id: string) => void;\n};\n\nconst NotificationContext = createContext<NotificationContextValue | undefined>(\n  undefined\n);\n\nexport function useNotification() {\n  const context = useContext(NotificationContext);\n  if (!context) {\n    throw new Error(\"useNotification must be used within NotificationProvider\");\n  }\n  return context;\n}\n\nexport function NotificationProvider({ children }: { children: ReactNode }) {\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n\n  const showNotification = useCallback(\n    (notification: Omit<Notification, \"id\">) => {\n      const id = `notification-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n      const newNotification: Notification = {\n        ...notification,\n        id,\n        duration: notification.duration ?? 5000,\n      };\n\n      setNotifications((prev) => [newNotification, ...prev]);\n\n      const duration = newNotification.duration ?? 5000;\n      const toastDuration = duration <= 0 ? Infinity : duration;\n      const toastOptions = {\n        id,\n        description: newNotification.message,\n        duration: toastDuration,\n      };\n\n      if (newNotification.type === \"success\") {\n        toast.success(newNotification.title, toastOptions);\n      } else if (newNotification.type === \"error\") {\n        toast.error(newNotification.title, toastOptions);\n      } else {\n        toast(newNotification.title, toastOptions);\n      }\n\n      if (duration > 0) {\n        setTimeout(() => {\n          setNotifications((prev) => prev.filter((n) => n.id !== id));\n        }, duration);\n      }\n    },\n    []\n  );\n\n  const dismissNotification = useCallback((id: string) => {\n    toast.dismiss(id);\n    setNotifications((prev) => prev.filter((n) => n.id !== id));\n  }, []);\n\n  return (\n    <NotificationContext.Provider\n      value={{ showNotification, notifications, dismissNotification }}\n    >\n      {children}\n      <Toaster position=\"top-right\" />\n    </NotificationContext.Provider>\n  );\n}\n","'use client';\n\nimport React, { forwardRef, isValidElement } from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { CloseIcon, getAsset, Loader } from './assets';\nimport { useIsDocumentHidden } from './hooks';\nimport { toast, ToastState } from './state';\nimport './styles.css';\nimport {\n  isAction,\n  SwipeDirection,\n  type ExternalToast,\n  type HeightT,\n  type ToasterProps,\n  type ToastProps,\n  type ToastT,\n  type ToastToDismiss,\n} from './types';\n\n// Visible toasts amount\nconst VISIBLE_TOASTS_AMOUNT = 3;\n\n// Viewport padding\nconst VIEWPORT_OFFSET = '32px';\n\n// Mobile viewport padding\nconst MOBILE_VIEWPORT_OFFSET = '16px';\n\n// Default lifetime of a toasts (in ms)\nconst TOAST_LIFETIME = 4000;\n\n// Default toast width\nconst TOAST_WIDTH = 356;\n\n// Default gap between toasts\nconst GAP = 14;\n\n// Threshold to dismiss a toast\nconst SWIPE_THRESHOLD = 20;\n\n// Equal to exit animation duration\nconst TIME_BEFORE_UNMOUNT = 200;\n\nfunction cn(...classes: (string | undefined)[]) {\n  return classes.filter(Boolean).join(' ');\n}\n\nfunction getDefaultSwipeDirections(position: string): Array<SwipeDirection> {\n  const [y, x] = position.split('-');\n  const directions: Array<SwipeDirection> = [];\n\n  if (y) {\n    directions.push(y as SwipeDirection);\n  }\n\n  if (x) {\n    directions.push(x as SwipeDirection);\n  }\n\n  return directions;\n}\n\nconst Toast = (props: ToastProps) => {\n  const {\n    invert: ToasterInvert,\n    toast,\n    unstyled,\n    interacting,\n    setHeights,\n    visibleToasts,\n    heights,\n    index,\n    toasts,\n    expanded,\n    removeToast,\n    defaultRichColors,\n    closeButton: closeButtonFromToaster,\n    style,\n    cancelButtonStyle,\n    actionButtonStyle,\n    className = '',\n    descriptionClassName = '',\n    duration: durationFromToaster,\n    position,\n    gap,\n    loadingIcon: loadingIconProp,\n    expandByDefault,\n    classNames,\n    icons,\n    closeButtonAriaLabel = 'Close toast',\n    pauseWhenPageIsHidden,\n  } = props;\n  const [swipeDirection, setSwipeDirection] = React.useState<'x' | 'y' | null>(null);\n  const [swipeOutDirection, setSwipeOutDirection] = React.useState<'left' | 'right' | 'up' | 'down' | null>(null);\n  const [mounted, setMounted] = React.useState(false);\n  const [removed, setRemoved] = React.useState(false);\n  const [swiping, setSwiping] = React.useState(false);\n  const [swipeOut, setSwipeOut] = React.useState(false);\n  const [isSwiped, setIsSwiped] = React.useState(false);\n  const [offsetBeforeRemove, setOffsetBeforeRemove] = React.useState(0);\n  const [initialHeight, setInitialHeight] = React.useState(0);\n  const remainingTime = React.useRef(toast.duration || durationFromToaster || TOAST_LIFETIME);\n  const dragStartTime = React.useRef<Date | null>(null);\n  const toastRef = React.useRef<HTMLLIElement>(null);\n  const isFront = index === 0;\n  const isVisible = index + 1 <= visibleToasts;\n  const toastType = toast.type;\n  const dismissible = toast.dismissible !== false;\n  const toastClassname = toast.className || '';\n  const toastDescriptionClassname = toast.descriptionClassName || '';\n  // Height index is used to calculate the offset as it gets updated before the toast array, which means we can calculate the new layout faster.\n  const heightIndex = React.useMemo(\n    () => heights.findIndex((height) => height.toastId === toast.id) || 0,\n    [heights, toast.id],\n  );\n  const closeButton = React.useMemo(\n    () => toast.closeButton ?? closeButtonFromToaster,\n    [toast.closeButton, closeButtonFromToaster],\n  );\n  const duration = React.useMemo(\n    () => toast.duration || durationFromToaster || TOAST_LIFETIME,\n    [toast.duration, durationFromToaster],\n  );\n  const closeTimerStartTimeRef = React.useRef(0);\n  const offset = React.useRef(0);\n  const lastCloseTimerStartTimeRef = React.useRef(0);\n  const pointerStartRef = React.useRef<{ x: number; y: number } | null>(null);\n  const [y, x] = position.split('-');\n  const toastsHeightBefore = React.useMemo(() => {\n    return heights.reduce((prev, curr, reducerIndex) => {\n      // Calculate offset up until current toast\n      if (reducerIndex >= heightIndex) {\n        return prev;\n      }\n\n      return prev + curr.height;\n    }, 0);\n  }, [heights, heightIndex]);\n  const isDocumentHidden = useIsDocumentHidden();\n\n  const invert = toast.invert || ToasterInvert;\n  const disabled = toastType === 'loading';\n\n  offset.current = React.useMemo(() => heightIndex * gap + toastsHeightBefore, [heightIndex, toastsHeightBefore]);\n\n  React.useEffect(() => {\n    remainingTime.current = duration;\n  }, [duration]);\n\n  React.useEffect(() => {\n    // Trigger enter animation without using CSS animation\n    setMounted(true);\n  }, []);\n\n  React.useEffect(() => {\n    const toastNode = toastRef.current;\n    if (toastNode) {\n      const height = toastNode.getBoundingClientRect().height;\n      // Add toast height to heights array after the toast is mounted\n      setInitialHeight(height);\n      setHeights((h) => [{ toastId: toast.id, height, position: toast.position }, ...h]);\n      return () => setHeights((h) => h.filter((height) => height.toastId !== toast.id));\n    }\n  }, [setHeights, toast.id]);\n\n  React.useLayoutEffect(() => {\n    if (!mounted) return;\n    const toastNode = toastRef.current;\n    const originalHeight = toastNode.style.height;\n    toastNode.style.height = 'auto';\n    const newHeight = toastNode.getBoundingClientRect().height;\n    toastNode.style.height = originalHeight;\n\n    setInitialHeight(newHeight);\n\n    setHeights((heights) => {\n      const alreadyExists = heights.find((height) => height.toastId === toast.id);\n      if (!alreadyExists) {\n        return [{ toastId: toast.id, height: newHeight, position: toast.position }, ...heights];\n      } else {\n        return heights.map((height) => (height.toastId === toast.id ? { ...height, height: newHeight } : height));\n      }\n    });\n  }, [mounted, toast.title, toast.description, setHeights, toast.id]);\n\n  const deleteToast = React.useCallback(() => {\n    // Save the offset for the exit swipe animation\n    setRemoved(true);\n    setOffsetBeforeRemove(offset.current);\n    setHeights((h) => h.filter((height) => height.toastId !== toast.id));\n\n    setTimeout(() => {\n      removeToast(toast);\n    }, TIME_BEFORE_UNMOUNT);\n  }, [toast, removeToast, setHeights, offset]);\n\n  React.useEffect(() => {\n    if ((toast.promise && toastType === 'loading') || toast.duration === Infinity || toast.type === 'loading') return;\n    let timeoutId: NodeJS.Timeout;\n\n    // Pause the timer on each hover\n    const pauseTimer = () => {\n      if (lastCloseTimerStartTimeRef.current < closeTimerStartTimeRef.current) {\n        // Get the elapsed time since the timer started\n        const elapsedTime = new Date().getTime() - closeTimerStartTimeRef.current;\n\n        remainingTime.current = remainingTime.current - elapsedTime;\n      }\n\n      lastCloseTimerStartTimeRef.current = new Date().getTime();\n    };\n\n    const startTimer = () => {\n      // setTimeout(, Infinity) behaves as if the delay is 0.\n      // As a result, the toast would be closed immediately, giving the appearance that it was never rendered.\n      // See: https://github.com/denysdovhan/wtfjs?tab=readme-ov-file#an-infinite-timeout\n      if (remainingTime.current === Infinity) return;\n\n      closeTimerStartTimeRef.current = new Date().getTime();\n\n      // Let the toast know it has started\n      timeoutId = setTimeout(() => {\n        toast.onAutoClose?.(toast);\n        deleteToast();\n      }, remainingTime.current);\n    };\n\n    if (expanded || interacting || (pauseWhenPageIsHidden && isDocumentHidden)) {\n      pauseTimer();\n    } else {\n      startTimer();\n    }\n\n    return () => clearTimeout(timeoutId);\n  }, [expanded, interacting, toast, toastType, pauseWhenPageIsHidden, isDocumentHidden, deleteToast]);\n\n  React.useEffect(() => {\n    if (toast.delete) {\n      deleteToast();\n    }\n  }, [deleteToast, toast.delete]);\n\n  function getLoadingIcon() {\n    if (icons?.loading) {\n      return (\n        <div\n          className={cn(classNames?.loader, toast?.classNames?.loader, 'sonner-loader')}\n          data-visible={toastType === 'loading'}\n        >\n          {icons.loading}\n        </div>\n      );\n    }\n\n    if (loadingIconProp) {\n      return (\n        <div\n          className={cn(classNames?.loader, toast?.classNames?.loader, 'sonner-loader')}\n          data-visible={toastType === 'loading'}\n        >\n          {loadingIconProp}\n        </div>\n      );\n    }\n    return <Loader className={cn(classNames?.loader, toast?.classNames?.loader)} visible={toastType === 'loading'} />;\n  }\n\n  return (\n    <li\n      tabIndex={0}\n      ref={toastRef}\n      className={cn(\n        className,\n        toastClassname,\n        classNames?.toast,\n        toast?.classNames?.toast,\n        classNames?.default,\n        classNames?.[toastType],\n        toast?.classNames?.[toastType],\n      )}\n      data-sonner-toast=\"\"\n      data-rich-colors={toast.richColors ?? defaultRichColors}\n      data-styled={!Boolean(toast.jsx || toast.unstyled || unstyled)}\n      data-mounted={mounted}\n      data-promise={Boolean(toast.promise)}\n      data-swiped={isSwiped}\n      data-removed={removed}\n      data-visible={isVisible}\n      data-y-position={y}\n      data-x-position={x}\n      data-index={index}\n      data-front={isFront}\n      data-swiping={swiping}\n      data-dismissible={dismissible}\n      data-type={toastType}\n      data-invert={invert}\n      data-swipe-out={swipeOut}\n      data-swipe-direction={swipeOutDirection}\n      data-expanded={Boolean(expanded || (expandByDefault && mounted))}\n      style={\n        {\n          '--index': index,\n          '--toasts-before': index,\n          '--z-index': toasts.length - index,\n          '--offset': `${removed ? offsetBeforeRemove : offset.current}px`,\n          '--initial-height': expandByDefault ? 'auto' : `${initialHeight}px`,\n          ...style,\n          ...toast.style,\n        } as React.CSSProperties\n      }\n      onDragEnd={() => {\n        setSwiping(false);\n        setSwipeDirection(null);\n        pointerStartRef.current = null;\n      }}\n      onPointerDown={(event) => {\n        if (disabled || !dismissible) return;\n        dragStartTime.current = new Date();\n        setOffsetBeforeRemove(offset.current);\n        // Ensure we maintain correct pointer capture even when going outside of the toast (e.g. when swiping)\n        (event.target as HTMLElement).setPointerCapture(event.pointerId);\n        if ((event.target as HTMLElement).tagName === 'BUTTON') return;\n        setSwiping(true);\n        pointerStartRef.current = { x: event.clientX, y: event.clientY };\n      }}\n      onPointerUp={() => {\n        if (swipeOut || !dismissible) return;\n\n        pointerStartRef.current = null;\n        const swipeAmountX = Number(\n          toastRef.current?.style.getPropertyValue('--swipe-amount-x').replace('px', '') || 0,\n        );\n        const swipeAmountY = Number(\n          toastRef.current?.style.getPropertyValue('--swipe-amount-y').replace('px', '') || 0,\n        );\n        const timeTaken = new Date().getTime() - dragStartTime.current?.getTime();\n\n        const swipeAmount = swipeDirection === 'x' ? swipeAmountX : swipeAmountY;\n        const velocity = Math.abs(swipeAmount) / timeTaken;\n\n        if (Math.abs(swipeAmount) >= SWIPE_THRESHOLD || velocity > 0.11) {\n          setOffsetBeforeRemove(offset.current);\n          toast.onDismiss?.(toast);\n\n          if (swipeDirection === 'x') {\n            setSwipeOutDirection(swipeAmountX > 0 ? 'right' : 'left');\n          } else {\n            setSwipeOutDirection(swipeAmountY > 0 ? 'down' : 'up');\n          }\n\n          deleteToast();\n          setSwipeOut(true);\n          setIsSwiped(false);\n          return;\n        }\n\n        setSwiping(false);\n        setSwipeDirection(null);\n      }}\n      onPointerMove={(event) => {\n        if (!pointerStartRef.current || !dismissible) return;\n\n        const isHighlighted = window.getSelection()?.toString().length > 0;\n        if (isHighlighted) return;\n\n        const yDelta = event.clientY - pointerStartRef.current.y;\n        const xDelta = event.clientX - pointerStartRef.current.x;\n\n        const swipeDirections = props.swipeDirections ?? getDefaultSwipeDirections(position);\n\n        // Determine swipe direction if not already locked\n        if (!swipeDirection && (Math.abs(xDelta) > 1 || Math.abs(yDelta) > 1)) {\n          setSwipeDirection(Math.abs(xDelta) > Math.abs(yDelta) ? 'x' : 'y');\n        }\n\n        let swipeAmount = { x: 0, y: 0 };\n\n        // Only apply swipe in the locked direction\n        if (swipeDirection === 'y') {\n          // Handle vertical swipes\n          if (swipeDirections.includes('top') || swipeDirections.includes('bottom')) {\n            if (swipeDirections.includes('top') && yDelta < 0) {\n              swipeAmount.y = yDelta;\n            } else if (swipeDirections.includes('bottom') && yDelta > 0) {\n              swipeAmount.y = yDelta;\n            }\n          }\n        } else if (swipeDirection === 'x') {\n          // Handle horizontal swipes\n          if (swipeDirections.includes('left') || swipeDirections.includes('right')) {\n            if (swipeDirections.includes('left') && xDelta < 0) {\n              swipeAmount.x = xDelta;\n            } else if (swipeDirections.includes('right') && xDelta > 0) {\n              swipeAmount.x = xDelta;\n            }\n          }\n        }\n\n        if (Math.abs(swipeAmount.x) > 0 || Math.abs(swipeAmount.y) > 0) {\n          setIsSwiped(true);\n        }\n\n        // Apply transform using both x and y values\n        toastRef.current?.style.setProperty('--swipe-amount-x', `${swipeAmount.x}px`);\n        toastRef.current?.style.setProperty('--swipe-amount-y', `${swipeAmount.y}px`);\n      }}\n    >\n      {closeButton && !toast.jsx ? (\n        <button\n          aria-label={closeButtonAriaLabel}\n          data-disabled={disabled}\n          data-close-button\n          onClick={\n            disabled || !dismissible\n              ? () => {}\n              : () => {\n                  deleteToast();\n                  toast.onDismiss?.(toast);\n                }\n          }\n          className={cn(classNames?.closeButton, toast?.classNames?.closeButton)}\n        >\n          {icons?.close ?? CloseIcon}\n        </button>\n      ) : null}\n      {/* TODO: This can be cleaner */}\n      {toast.jsx || isValidElement(toast.title) ? (\n        toast.jsx ? (\n          toast.jsx\n        ) : typeof toast.title === 'function' ? (\n          toast.title()\n        ) : (\n          toast.title\n        )\n      ) : (\n        <>\n          {toastType || toast.icon || toast.promise ? (\n            <div data-icon=\"\" className={cn(classNames?.icon, toast?.classNames?.icon)}>\n              {toast.promise || (toast.type === 'loading' && !toast.icon) ? toast.icon || getLoadingIcon() : null}\n              {toast.type !== 'loading' ? toast.icon || icons?.[toastType] || getAsset(toastType) : null}\n            </div>\n          ) : null}\n\n          <div data-content=\"\" className={cn(classNames?.content, toast?.classNames?.content)}>\n            <div data-title=\"\" className={cn(classNames?.title, toast?.classNames?.title)}>\n              {typeof toast.title === 'function' ? toast.title() : toast.title}\n            </div>\n            {toast.description ? (\n              <div\n                data-description=\"\"\n                className={cn(\n                  descriptionClassName,\n                  toastDescriptionClassname,\n                  classNames?.description,\n                  toast?.classNames?.description,\n                )}\n              >\n                {typeof toast.description === 'function' ? toast.description() : toast.description}\n              </div>\n            ) : null}\n          </div>\n          {isValidElement(toast.cancel) ? (\n            toast.cancel\n          ) : toast.cancel && isAction(toast.cancel) ? (\n            <button\n              data-button\n              data-cancel\n              style={toast.cancelButtonStyle || cancelButtonStyle}\n              onClick={(event) => {\n                // We need to check twice because typescript\n                if (!isAction(toast.cancel)) return;\n                if (!dismissible) return;\n                toast.cancel.onClick?.(event);\n                deleteToast();\n              }}\n              className={cn(classNames?.cancelButton, toast?.classNames?.cancelButton)}\n            >\n              {toast.cancel.label}\n            </button>\n          ) : null}\n          {isValidElement(toast.action) ? (\n            toast.action\n          ) : toast.action && isAction(toast.action) ? (\n            <button\n              data-button\n              data-action\n              style={toast.actionButtonStyle || actionButtonStyle}\n              onClick={(event) => {\n                // We need to check twice because typescript\n                if (!isAction(toast.action)) return;\n                toast.action.onClick?.(event);\n                if (event.defaultPrevented) return;\n                deleteToast();\n              }}\n              className={cn(classNames?.actionButton, toast?.classNames?.actionButton)}\n            >\n              {toast.action.label}\n            </button>\n          ) : null}\n        </>\n      )}\n    </li>\n  );\n};\n\nfunction getDocumentDirection(): ToasterProps['dir'] {\n  if (typeof window === 'undefined') return 'ltr';\n  if (typeof document === 'undefined') return 'ltr'; // For Fresh purpose\n\n  const dirAttribute = document.documentElement.getAttribute('dir');\n\n  if (dirAttribute === 'auto' || !dirAttribute) {\n    return window.getComputedStyle(document.documentElement).direction as ToasterProps['dir'];\n  }\n\n  return dirAttribute as ToasterProps['dir'];\n}\n\nfunction assignOffset(defaultOffset: ToasterProps['offset'], mobileOffset: ToasterProps['mobileOffset']) {\n  const styles = {} as React.CSSProperties;\n\n  [defaultOffset, mobileOffset].forEach((offset, index) => {\n    const isMobile = index === 1;\n    const prefix = isMobile ? '--mobile-offset' : '--offset';\n    const defaultValue = isMobile ? MOBILE_VIEWPORT_OFFSET : VIEWPORT_OFFSET;\n\n    function assignAll(offset: string | number) {\n      ['top', 'right', 'bottom', 'left'].forEach((key) => {\n        styles[`${prefix}-${key}`] = typeof offset === 'number' ? `${offset}px` : offset;\n      });\n    }\n\n    if (typeof offset === 'number' || typeof offset === 'string') {\n      assignAll(offset);\n    } else if (typeof offset === 'object') {\n      ['top', 'right', 'bottom', 'left'].forEach((key) => {\n        if (offset[key] === undefined) {\n          styles[`${prefix}-${key}`] = defaultValue;\n        } else {\n          styles[`${prefix}-${key}`] = typeof offset[key] === 'number' ? `${offset[key]}px` : offset[key];\n        }\n      });\n    } else {\n      assignAll(defaultValue);\n    }\n  });\n\n  return styles;\n}\n\nfunction useSonner() {\n  const [activeToasts, setActiveToasts] = React.useState<ToastT[]>([]);\n\n  React.useEffect(() => {\n    return ToastState.subscribe((toast) => {\n      if ((toast as ToastToDismiss).dismiss) {\n        setTimeout(() => {\n          ReactDOM.flushSync(() => {\n            setActiveToasts((toasts) => toasts.filter((t) => t.id !== toast.id));\n          });\n        });\n        return;\n      }\n\n      // Prevent batching, temp solution.\n      setTimeout(() => {\n        ReactDOM.flushSync(() => {\n          setActiveToasts((toasts) => {\n            const indexOfExistingToast = toasts.findIndex((t) => t.id === toast.id);\n\n            // Update the toast if it already exists\n            if (indexOfExistingToast !== -1) {\n              return [\n                ...toasts.slice(0, indexOfExistingToast),\n                { ...toasts[indexOfExistingToast], ...toast },\n                ...toasts.slice(indexOfExistingToast + 1),\n              ];\n            }\n\n            return [toast, ...toasts];\n          });\n        });\n      });\n    });\n  }, []);\n\n  return {\n    toasts: activeToasts,\n  };\n}\n\nconst Toaster = forwardRef<HTMLElement, ToasterProps>(function Toaster(props, ref) {\n  const {\n    invert,\n    position = 'bottom-right',\n    hotkey = ['altKey', 'KeyT'],\n    expand,\n    closeButton,\n    className,\n    offset,\n    mobileOffset,\n    theme = 'light',\n    richColors,\n    duration,\n    style,\n    visibleToasts = VISIBLE_TOASTS_AMOUNT,\n    toastOptions,\n    dir = getDocumentDirection(),\n    gap = GAP,\n    loadingIcon,\n    icons,\n    containerAriaLabel = 'Notifications',\n    pauseWhenPageIsHidden,\n  } = props;\n  const [toasts, setToasts] = React.useState<ToastT[]>([]);\n  const possiblePositions = React.useMemo(() => {\n    return Array.from(\n      new Set([position].concat(toasts.filter((toast) => toast.position).map((toast) => toast.position))),\n    );\n  }, [toasts, position]);\n  const [heights, setHeights] = React.useState<HeightT[]>([]);\n  const [expanded, setExpanded] = React.useState(false);\n  const [interacting, setInteracting] = React.useState(false);\n  const [actualTheme, setActualTheme] = React.useState(\n    theme !== 'system'\n      ? theme\n      : typeof window !== 'undefined'\n      ? window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches\n        ? 'dark'\n        : 'light'\n      : 'light',\n  );\n\n  const listRef = React.useRef<HTMLOListElement>(null);\n  const hotkeyLabel = hotkey.join('+').replace(/Key/g, '').replace(/Digit/g, '');\n  const lastFocusedElementRef = React.useRef<HTMLElement>(null);\n  const isFocusWithinRef = React.useRef(false);\n\n  const removeToast = React.useCallback((toastToRemove: ToastT) => {\n    setToasts((toasts) => {\n      if (!toasts.find((toast) => toast.id === toastToRemove.id)?.delete) {\n        ToastState.dismiss(toastToRemove.id);\n      }\n\n      return toasts.filter(({ id }) => id !== toastToRemove.id);\n    });\n  }, []);\n\n  React.useEffect(() => {\n    return ToastState.subscribe((toast) => {\n      if ((toast as ToastToDismiss).dismiss) {\n        setToasts((toasts) => toasts.map((t) => (t.id === toast.id ? { ...t, delete: true } : t)));\n        return;\n      }\n\n      // Prevent batching, temp solution.\n      setTimeout(() => {\n        ReactDOM.flushSync(() => {\n          setToasts((toasts) => {\n            const indexOfExistingToast = toasts.findIndex((t) => t.id === toast.id);\n\n            // Update the toast if it already exists\n            if (indexOfExistingToast !== -1) {\n              return [\n                ...toasts.slice(0, indexOfExistingToast),\n                { ...toasts[indexOfExistingToast], ...toast },\n                ...toasts.slice(indexOfExistingToast + 1),\n              ];\n            }\n\n            return [toast, ...toasts];\n          });\n        });\n      });\n    });\n  }, []);\n\n  React.useEffect(() => {\n    if (theme !== 'system') {\n      setActualTheme(theme);\n      return;\n    }\n\n    if (theme === 'system') {\n      // check if current preference is dark\n      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n        // it's currently dark\n        setActualTheme('dark');\n      } else {\n        // it's not dark\n        setActualTheme('light');\n      }\n    }\n\n    if (typeof window === 'undefined') return;\n    const darkMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n\n    try {\n      // Chrome & Firefox\n      darkMediaQuery.addEventListener('change', ({ matches }) => {\n        if (matches) {\n          setActualTheme('dark');\n        } else {\n          setActualTheme('light');\n        }\n      });\n    } catch (error) {\n      // Safari < 14\n      darkMediaQuery.addListener(({ matches }) => {\n        try {\n          if (matches) {\n            setActualTheme('dark');\n          } else {\n            setActualTheme('light');\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }, [theme]);\n\n  React.useEffect(() => {\n    // Ensure expanded is always false when no toasts are present / only one left\n    if (toasts.length <= 1) {\n      setExpanded(false);\n    }\n  }, [toasts]);\n\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      const isHotkeyPressed = hotkey.every((key) => (event as any)[key] || event.code === key);\n\n      if (isHotkeyPressed) {\n        setExpanded(true);\n        listRef.current?.focus();\n      }\n\n      if (\n        event.code === 'Escape' &&\n        (document.activeElement === listRef.current || listRef.current?.contains(document.activeElement))\n      ) {\n        setExpanded(false);\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [hotkey]);\n\n  React.useEffect(() => {\n    if (listRef.current) {\n      return () => {\n        if (lastFocusedElementRef.current) {\n          lastFocusedElementRef.current.focus({ preventScroll: true });\n          lastFocusedElementRef.current = null;\n          isFocusWithinRef.current = false;\n        }\n      };\n    }\n  }, [listRef.current]);\n\n  return (\n    // Remove item from normal navigation flow, only available via hotkey\n    <section\n      ref={ref}\n      aria-label={`${containerAriaLabel} ${hotkeyLabel}`}\n      tabIndex={-1}\n      aria-live=\"polite\"\n      aria-relevant=\"additions text\"\n      aria-atomic=\"false\"\n      suppressHydrationWarning\n    >\n      {possiblePositions.map((position, index) => {\n        const [y, x] = position.split('-');\n\n        if (!toasts.length) return null;\n\n        return (\n          <ol\n            key={position}\n            dir={dir === 'auto' ? getDocumentDirection() : dir}\n            tabIndex={-1}\n            ref={listRef}\n            className={className}\n            data-sonner-toaster\n            data-theme={actualTheme}\n            data-y-position={y}\n            data-lifted={expanded && toasts.length > 1 && !expand}\n            data-x-position={x}\n            style={\n              {\n                '--front-toast-height': `${heights[0]?.height || 0}px`,\n                '--width': `${TOAST_WIDTH}px`,\n                '--gap': `${gap}px`,\n                ...style,\n                ...assignOffset(offset, mobileOffset),\n              } as React.CSSProperties\n            }\n            onBlur={(event) => {\n              if (isFocusWithinRef.current && !event.currentTarget.contains(event.relatedTarget)) {\n                isFocusWithinRef.current = false;\n                if (lastFocusedElementRef.current) {\n                  lastFocusedElementRef.current.focus({ preventScroll: true });\n                  lastFocusedElementRef.current = null;\n                }\n              }\n            }}\n            onFocus={(event) => {\n              const isNotDismissible =\n                event.target instanceof HTMLElement && event.target.dataset.dismissible === 'false';\n\n              if (isNotDismissible) return;\n\n              if (!isFocusWithinRef.current) {\n                isFocusWithinRef.current = true;\n                lastFocusedElementRef.current = event.relatedTarget as HTMLElement;\n              }\n            }}\n            onMouseEnter={() => setExpanded(true)}\n            onMouseMove={() => setExpanded(true)}\n            onMouseLeave={() => {\n              // Avoid setting expanded to false when interacting with a toast, e.g. swiping\n              if (!interacting) {\n                setExpanded(false);\n              }\n            }}\n            onDragEnd={() => setExpanded(false)}\n            onPointerDown={(event) => {\n              const isNotDismissible =\n                event.target instanceof HTMLElement && event.target.dataset.dismissible === 'false';\n\n              if (isNotDismissible) return;\n              setInteracting(true);\n            }}\n            onPointerUp={() => setInteracting(false)}\n          >\n            {toasts\n              .filter((toast) => (!toast.position && index === 0) || toast.position === position)\n              .map((toast, index) => (\n                <Toast\n                  key={toast.id}\n                  icons={icons}\n                  index={index}\n                  toast={toast}\n                  defaultRichColors={richColors}\n                  duration={toastOptions?.duration ?? duration}\n                  className={toastOptions?.className}\n                  descriptionClassName={toastOptions?.descriptionClassName}\n                  invert={invert}\n                  visibleToasts={visibleToasts}\n                  closeButton={toastOptions?.closeButton ?? closeButton}\n                  interacting={interacting}\n                  position={position}\n                  style={toastOptions?.style}\n                  unstyled={toastOptions?.unstyled}\n                  classNames={toastOptions?.classNames}\n                  cancelButtonStyle={toastOptions?.cancelButtonStyle}\n                  actionButtonStyle={toastOptions?.actionButtonStyle}\n                  removeToast={removeToast}\n                  toasts={toasts.filter((t) => t.position == toast.position)}\n                  heights={heights.filter((h) => h.position == toast.position)}\n                  setHeights={setHeights}\n                  expandByDefault={expand}\n                  gap={gap}\n                  loadingIcon={loadingIcon}\n                  expanded={expanded}\n                  pauseWhenPageIsHidden={pauseWhenPageIsHidden}\n                  swipeDirections={props.swipeDirections}\n                />\n              ))}\n          </ol>\n        );\n      })}\n    </section>\n  );\n});\nexport { toast, Toaster, type ExternalToast, type ToastT, type ToasterProps, useSonner };\nexport { type ToastClassnames, type ToastToDismiss, type Action } from './types';\n","'use client';\nimport React from 'react';\nimport type { ToastTypes } from './types';\n\nexport const getAsset = (type: ToastTypes): JSX.Element | null => {\n  switch (type) {\n    case 'success':\n      return SuccessIcon;\n\n    case 'info':\n      return InfoIcon;\n\n    case 'warning':\n      return WarningIcon;\n\n    case 'error':\n      return ErrorIcon;\n\n    default:\n      return null;\n  }\n};\n\nconst bars = Array(12).fill(0);\n\nexport const Loader = ({ visible, className }: { visible: boolean, className?: string }) => {\n  return (\n    <div className={['sonner-loading-wrapper', className].filter(Boolean).join(' ')} data-visible={visible}>\n      <div className=\"sonner-spinner\">\n        {bars.map((_, i) => (\n          <div className=\"sonner-loading-bar\" key={`spinner-bar-${i}`} />\n        ))}\n      </div>\n    </div>\n  );\n};\n\nconst SuccessIcon = (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" height=\"20\" width=\"20\">\n    <path\n      fillRule=\"evenodd\"\n      d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z\"\n      clipRule=\"evenodd\"\n    />\n  </svg>\n);\n\nconst WarningIcon = (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" height=\"20\" width=\"20\">\n    <path\n      fillRule=\"evenodd\"\n      d=\"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z\"\n      clipRule=\"evenodd\"\n    />\n  </svg>\n);\n\nconst InfoIcon = (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" height=\"20\" width=\"20\">\n    <path\n      fillRule=\"evenodd\"\n      d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z\"\n      clipRule=\"evenodd\"\n    />\n  </svg>\n);\n\nconst ErrorIcon = (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" height=\"20\" width=\"20\">\n    <path\n      fillRule=\"evenodd\"\n      d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z\"\n      clipRule=\"evenodd\"\n    />\n  </svg>\n);\n\nexport const CloseIcon = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"12\"\n    height=\"12\"\n    viewBox=\"0 0 24 24\"\n    fill=\"none\"\n    stroke=\"currentColor\"\n    strokeWidth=\"1.5\"\n    strokeLinecap=\"round\"\n    strokeLinejoin=\"round\"\n  >\n    <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n    <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n  </svg>\n);\n","import React from 'react';\n\nexport const useIsDocumentHidden = () => {\n  const [isDocumentHidden, setIsDocumentHidden] = React.useState(document.hidden);\n\n  React.useEffect(() => {\n    const callback = () => {\n      setIsDocumentHidden(document.hidden);\n    };\n    document.addEventListener('visibilitychange', callback);\n    return () => window.removeEventListener('visibilitychange', callback);\n  }, []);\n\n  return isDocumentHidden;\n};\n","import type { ExternalToast, PromiseData, PromiseT, ToastT, ToastToDismiss, ToastTypes } from './types';\n\nimport React from 'react';\n\nlet toastsCounter = 1;\n\ntype titleT = (() => React.ReactNode) | React.ReactNode;\n\nclass Observer {\n  subscribers: Array<(toast: ExternalToast | ToastToDismiss) => void>;\n  toasts: Array<ToastT | ToastToDismiss>;\n  dismissedToasts: Set<string | number>;\n\n  constructor() {\n    this.subscribers = [];\n    this.toasts = [];\n    this.dismissedToasts = new Set();\n  }\n\n  // We use arrow functions to maintain the correct `this` reference\n  subscribe = (subscriber: (toast: ToastT | ToastToDismiss) => void) => {\n    this.subscribers.push(subscriber);\n\n    return () => {\n      const index = this.subscribers.indexOf(subscriber);\n      this.subscribers.splice(index, 1);\n    };\n  };\n\n  publish = (data: ToastT) => {\n    this.subscribers.forEach((subscriber) => subscriber(data));\n  };\n\n  addToast = (data: ToastT) => {\n    this.publish(data);\n    this.toasts = [...this.toasts, data];\n  };\n\n  create = (\n    data: ExternalToast & {\n      message?: titleT;\n      type?: ToastTypes;\n      promise?: PromiseT;\n      jsx?: React.ReactElement;\n    },\n  ) => {\n    const { message, ...rest } = data;\n    const id = typeof data?.id === 'number' || data.id?.length > 0 ? data.id : toastsCounter++;\n    const alreadyExists = this.toasts.find((toast) => {\n      return toast.id === id;\n    });\n    const dismissible = data.dismissible === undefined ? true : data.dismissible;\n\n    if (this.dismissedToasts.has(id)) {\n      this.dismissedToasts.delete(id);\n    }\n\n    if (alreadyExists) {\n      this.toasts = this.toasts.map((toast) => {\n        if (toast.id === id) {\n          this.publish({ ...toast, ...data, id, title: message });\n          return {\n            ...toast,\n            ...data,\n            id,\n            dismissible,\n            title: message,\n          };\n        }\n\n        return toast;\n      });\n    } else {\n      this.addToast({ title: message, ...rest, dismissible, id });\n    }\n\n    return id;\n  };\n\n  dismiss = (id?: number | string) => {\n    this.dismissedToasts.add(id);\n\n    if (!id) {\n      this.toasts.forEach((toast) => {\n        this.subscribers.forEach((subscriber) => subscriber({ id: toast.id, dismiss: true }));\n      });\n    }\n    this.subscribers.forEach((subscriber) => subscriber({ id, dismiss: true }));\n    return id;\n  };\n\n  message = (message: titleT | React.ReactNode, data?: ExternalToast) => {\n    return this.create({ ...data, message });\n  };\n\n  error = (message: titleT | React.ReactNode, data?: ExternalToast) => {\n    return this.create({ ...data, message, type: 'error' });\n  };\n\n  success = (message: titleT | React.ReactNode, data?: ExternalToast) => {\n    return this.create({ ...data, type: 'success', message });\n  };\n\n  info = (message: titleT | React.ReactNode, data?: ExternalToast) => {\n    return this.create({ ...data, type: 'info', message });\n  };\n\n  warning = (message: titleT | React.ReactNode, data?: ExternalToast) => {\n    return this.create({ ...data, type: 'warning', message });\n  };\n\n  loading = (message: titleT | React.ReactNode, data?: ExternalToast) => {\n    return this.create({ ...data, type: 'loading', message });\n  };\n\n  promise = <ToastData>(promise: PromiseT<ToastData>, data?: PromiseData<ToastData>) => {\n    if (!data) {\n      // Nothing to show\n      return;\n    }\n\n    let id: string | number | undefined = undefined;\n    if (data.loading !== undefined) {\n      id = this.create({\n        ...data,\n        promise,\n        type: 'loading',\n        message: data.loading,\n        description: typeof data.description !== 'function' ? data.description : undefined,\n      });\n    }\n\n    const p = promise instanceof Promise ? promise : promise();\n\n    let shouldDismiss = id !== undefined;\n    let result: ['resolve', ToastData] | ['reject', unknown];\n\n    const originalPromise = p\n      .then(async (response) => {\n        result = ['resolve', response];\n        const isReactElementResponse = React.isValidElement(response);\n        if (isReactElementResponse) {\n          shouldDismiss = false;\n          this.create({ id, type: 'default', message: response });\n        } else if (isHttpResponse(response) && !response.ok) {\n          shouldDismiss = false;\n          const message =\n            typeof data.error === 'function' ? await data.error(`HTTP error! status: ${response.status}`) : data.error;\n          const description =\n            typeof data.description === 'function'\n              ? await data.description(`HTTP error! status: ${response.status}`)\n              : data.description;\n          this.create({ id, type: 'error', message, description });\n        } else if (data.success !== undefined) {\n          shouldDismiss = false;\n          const message = typeof data.success === 'function' ? await data.success(response) : data.success;\n          const description =\n            typeof data.description === 'function' ? await data.description(response) : data.description;\n          this.create({ id, type: 'success', message, description });\n        }\n      })\n      .catch(async (error) => {\n        result = ['reject', error];\n        if (data.error !== undefined) {\n          shouldDismiss = false;\n          const message = typeof data.error === 'function' ? await data.error(error) : data.error;\n          const description = typeof data.description === 'function' ? await data.description(error) : data.description;\n          this.create({ id, type: 'error', message, description });\n        }\n      })\n      .finally(() => {\n        if (shouldDismiss) {\n          // Toast is still in load state (and will be indefinitely  dismiss it)\n          this.dismiss(id);\n          id = undefined;\n        }\n\n        data.finally?.();\n      });\n\n    const unwrap = () =>\n      new Promise<ToastData>((resolve, reject) =>\n        originalPromise.then(() => (result[0] === 'reject' ? reject(result[1]) : resolve(result[1]))).catch(reject),\n      );\n\n    if (typeof id !== 'string' && typeof id !== 'number') {\n      // cannot Object.assign on undefined\n      return { unwrap };\n    } else {\n      return Object.assign(id, { unwrap });\n    }\n  };\n\n  custom = (jsx: (id: number | string) => React.ReactElement, data?: ExternalToast) => {\n    const id = data?.id || toastsCounter++;\n    this.create({ jsx: jsx(id), id, ...data });\n    return id;\n  };\n\n  getActiveToasts = () => {\n    return this.toasts.filter((toast) => !this.dismissedToasts.has(toast.id));\n  };\n}\n\nexport const ToastState = new Observer();\n\n// bind this to the toast function\nconst toastFunction = (message: titleT, data?: ExternalToast) => {\n  const id = data?.id || toastsCounter++;\n\n  ToastState.addToast({\n    title: message,\n    ...data,\n    id,\n  });\n  return id;\n};\n\nconst isHttpResponse = (data: any): data is Response => {\n  return (\n    data &&\n    typeof data === 'object' &&\n    'ok' in data &&\n    typeof data.ok === 'boolean' &&\n    'status' in data &&\n    typeof data.status === 'number'\n  );\n};\n\nconst basicToast = toastFunction;\n\nconst getHistory = () => ToastState.toasts;\nconst getToasts = () => ToastState.getActiveToasts();\n\n// We use `Object.assign` to maintain the correct types as we would lose them otherwise\nexport const toast = Object.assign(\n  basicToast,\n  {\n    success: ToastState.success,\n    info: ToastState.info,\n    warning: ToastState.warning,\n    error: ToastState.error,\n    custom: ToastState.custom,\n    message: ToastState.message,\n    promise: ToastState.promise,\n    dismiss: ToastState.dismiss,\n    loading: ToastState.loading,\n  },\n  { getHistory, getToasts },\n);\n","\n          export default function styleInject(css, { insertAt } = {}) {\n            if (!css || typeof document === 'undefined') return\n          \n            const head = document.head || document.getElementsByTagName('head')[0]\n            const style = document.createElement('style')\n            style.type = 'text/css'\n          \n            if (insertAt === 'top') {\n              if (head.firstChild) {\n                head.insertBefore(style, head.firstChild)\n              } else {\n                head.appendChild(style)\n              }\n            } else {\n              head.appendChild(style)\n            }\n          \n            if (style.styleSheet) {\n              style.styleSheet.cssText = css\n            } else {\n              style.appendChild(document.createTextNode(css))\n            }\n          }\n          ","import styleInject from '#style-inject';styleInject(\":where(html[dir=\\\"ltr\\\"]),:where([data-sonner-toaster][dir=\\\"ltr\\\"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir=\\\"rtl\\\"]),:where([data-sonner-toaster][dir=\\\"rtl\\\"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted=\\\"true\\\"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted=\\\"true\\\"]){transform:none}}:where([data-sonner-toaster][data-x-position=\\\"right\\\"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position=\\\"left\\\"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position=\\\"center\\\"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position=\\\"top\\\"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position=\\\"bottom\\\"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled=\\\"true\\\"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position=\\\"top\\\"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position=\\\"bottom\\\"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise=\\\"true\\\"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme=\\\"dark\\\"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled=\\\"true\\\"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping=\\\"true\\\"]):before{content:\\\"\\\";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position=\\\"top\\\"][data-swiping=\\\"true\\\"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position=\\\"bottom\\\"][data-swiping=\\\"true\\\"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping=\\\"false\\\"][data-removed=\\\"true\\\"]):before{content:\\\"\\\";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:\\\"\\\";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted=\\\"true\\\"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded=\\\"false\\\"][data-front=\\\"false\\\"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded=\\\"false\\\"][data-front=\\\"false\\\"][data-styled=\\\"true\\\"])>*{opacity:0}:where([data-sonner-toast][data-visible=\\\"false\\\"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted=\\\"true\\\"][data-expanded=\\\"true\\\"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed=\\\"true\\\"][data-front=\\\"true\\\"][data-swipe-out=\\\"false\\\"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed=\\\"true\\\"][data-front=\\\"false\\\"][data-swipe-out=\\\"false\\\"][data-expanded=\\\"true\\\"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed=\\\"true\\\"][data-front=\\\"false\\\"][data-swipe-out=\\\"false\\\"][data-expanded=\\\"false\\\"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed=\\\"true\\\"][data-front=\\\"false\\\"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}\\n\")","import React from 'react';\n\nexport type ToastTypes = 'normal' | 'action' | 'success' | 'info' | 'warning' | 'error' | 'loading' | 'default';\n\nexport type PromiseT<Data = any> = Promise<Data> | (() => Promise<Data>);\n\nexport type PromiseTResult<Data = any> =\n  | string\n  | React.ReactNode\n  | ((data: Data) => React.ReactNode | string | Promise<React.ReactNode | string>);\n\nexport type PromiseExternalToast = Omit<ExternalToast, 'description'>;\n\nexport type PromiseData<ToastData = any> = PromiseExternalToast & {\n  loading?: string | React.ReactNode;\n  success?: PromiseTResult<ToastData>;\n  error?: PromiseTResult;\n  description?: PromiseTResult;\n  finally?: () => void | Promise<void>;\n};\n\nexport interface ToastClassnames {\n  toast?: string;\n  title?: string;\n  description?: string;\n  loader?: string;\n  closeButton?: string;\n  cancelButton?: string;\n  actionButton?: string;\n  success?: string;\n  error?: string;\n  info?: string;\n  warning?: string;\n  loading?: string;\n  default?: string;\n  content?: string;\n  icon?: string;\n}\n\nexport interface ToastIcons {\n  success?: React.ReactNode;\n  info?: React.ReactNode;\n  warning?: React.ReactNode;\n  error?: React.ReactNode;\n  loading?: React.ReactNode;\n  close?: React.ReactNode;\n}\n\nexport interface Action {\n  label: React.ReactNode;\n  onClick: (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void;\n  actionButtonStyle?: React.CSSProperties;\n}\n\nexport interface ToastT {\n  id: number | string;\n  title?: (() => React.ReactNode) | React.ReactNode;\n  type?: ToastTypes;\n  icon?: React.ReactNode;\n  jsx?: React.ReactNode;\n  richColors?: boolean;\n  invert?: boolean;\n  closeButton?: boolean;\n  dismissible?: boolean;\n  description?: (() => React.ReactNode) | React.ReactNode;\n  duration?: number;\n  delete?: boolean;\n  action?: Action | React.ReactNode;\n  cancel?: Action | React.ReactNode;\n  onDismiss?: (toast: ToastT) => void;\n  onAutoClose?: (toast: ToastT) => void;\n  promise?: PromiseT;\n  cancelButtonStyle?: React.CSSProperties;\n  actionButtonStyle?: React.CSSProperties;\n  style?: React.CSSProperties;\n  unstyled?: boolean;\n  className?: string;\n  classNames?: ToastClassnames;\n  descriptionClassName?: string;\n  position?: Position;\n}\n\nexport function isAction(action: Action | React.ReactNode): action is Action {\n  return (action as Action).label !== undefined;\n}\n\nexport type Position = 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right' | 'top-center' | 'bottom-center';\nexport interface HeightT {\n  height: number;\n  toastId: number | string;\n  position: Position;\n}\n\ninterface ToastOptions {\n  className?: string;\n  closeButton?: boolean;\n  descriptionClassName?: string;\n  style?: React.CSSProperties;\n  cancelButtonStyle?: React.CSSProperties;\n  actionButtonStyle?: React.CSSProperties;\n  duration?: number;\n  unstyled?: boolean;\n  classNames?: ToastClassnames;\n}\n\ntype Offset =\n  | {\n      top?: string | number;\n      right?: string | number;\n      bottom?: string | number;\n      left?: string | number;\n    }\n  | string\n  | number;\n\nexport interface ToasterProps {\n  invert?: boolean;\n  theme?: 'light' | 'dark' | 'system';\n  position?: Position;\n  hotkey?: string[];\n  richColors?: boolean;\n  expand?: boolean;\n  duration?: number;\n  gap?: number;\n  visibleToasts?: number;\n  closeButton?: boolean;\n  toastOptions?: ToastOptions;\n  className?: string;\n  style?: React.CSSProperties;\n  offset?: Offset;\n  mobileOffset?: Offset;\n  dir?: 'rtl' | 'ltr' | 'auto';\n  swipeDirections?: SwipeDirection[];\n  /**\n   * @deprecated Please use the `icons` prop instead:\n   * ```jsx\n   * <Toaster\n   *   icons={{ loading: <LoadingIcon /> }}\n   * />\n   * ```\n   */\n  loadingIcon?: React.ReactNode;\n  icons?: ToastIcons;\n  containerAriaLabel?: string;\n  pauseWhenPageIsHidden?: boolean;\n}\n\nexport type SwipeDirection = 'top' | 'right' | 'bottom' | 'left';\n\nexport interface ToastProps {\n  toast: ToastT;\n  toasts: ToastT[];\n  index: number;\n  swipeDirections?: SwipeDirection[];\n  expanded: boolean;\n  invert: boolean;\n  heights: HeightT[];\n  setHeights: React.Dispatch<React.SetStateAction<HeightT[]>>;\n  removeToast: (toast: ToastT) => void;\n  gap?: number;\n  position: Position;\n  visibleToasts: number;\n  expandByDefault: boolean;\n  closeButton: boolean;\n  interacting: boolean;\n  style?: React.CSSProperties;\n  cancelButtonStyle?: React.CSSProperties;\n  actionButtonStyle?: React.CSSProperties;\n  duration?: number;\n  className?: string;\n  unstyled?: boolean;\n  descriptionClassName?: string;\n  loadingIcon?: React.ReactNode;\n  classNames?: ToastClassnames;\n  icons?: ToastIcons;\n  closeButtonAriaLabel?: string;\n  pauseWhenPageIsHidden: boolean;\n  defaultRichColors?: boolean;\n}\n\nexport enum SwipeStateTypes {\n  SwipedOut = 'SwipedOut',\n  SwipedBack = 'SwipedBack',\n  NotSwiped = 'NotSwiped',\n}\n\nexport type Theme = 'light' | 'dark';\n\nexport interface ToastToDismiss {\n  id: number | string;\n  dismiss: boolean;\n}\n\nexport type ExternalToast = Omit<ToastT, 'id' | 'type' | 'title' | 'jsx' | 'delete' | 'promise'> & {\n  id?: number | string;\n};\n","import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n","\"use client\";\n\nimport type { ComponentProps } from \"react\";\nimport { Toaster as Sonner } from \"sonner\";\n\nimport { cn } from \"../../lib/utils\";\n\ntype ToasterProps = ComponentProps<typeof Sonner>;\n\nexport function Toaster({ className, toastOptions, ...props }: ToasterProps) {\n  return (\n    <Sonner\n      className={cn(\"toaster group\", className)}\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton: \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton: \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n        ...toastOptions,\n      }}\n      {...props}\n    />\n  );\n}\n","\"use client\";\n\nimport { useEffect, useRef } from \"react\";\n\nimport { useRuntimeActions } from \"../runtime/hooks\";\n\n// ==================== Wallet Button State ====================\n\nexport type WalletButtonState = {\n  address?: string;\n  chainId?: number;\n  isConnected: boolean;\n  ensName?: string;\n};\n\nexport type WalletFooterProps = {\n  wallet: WalletButtonState;\n  setWallet: (data: Partial<WalletButtonState>) => void;\n};\n\n// ==================== Wallet Transaction Types ====================\n\nexport type WalletTxRequestPayload = {\n  to: string;\n  value: string; // wei as decimal string\n  data: string; // 0x-prefixed hex\n  gas?: string | null;\n  gas_limit?: string | null;\n  description?: string;\n  topic?: string;\n  timestamp?: string;\n};\n\nexport type WalletTxRequestContext = {\n  sessionId: string;\n  threadId: string;\n  publicKey?: string;\n};\n\n// Return the transaction hash (0x...) or throw on failure/rejection.\nexport type WalletTxRequestHandler = (\n  request: WalletTxRequestPayload,\n  context: WalletTxRequestContext\n) => Promise<string>;\n\nexport type Eip1193Provider = {\n  request: (args: { method: string; params?: unknown[] }) => Promise<unknown>;\n};\n\n// ==================== Network Utilities ====================\n\nexport const getNetworkName = (chainId: number | string | undefined): string => {\n  if (chainId === undefined) return \"\";\n  const id = typeof chainId === \"string\" ? Number(chainId) : chainId;\n  switch (id) {\n    case 1:\n      return \"ethereum\";\n    case 137:\n      return \"polygon\";\n    case 42161:\n      return \"arbitrum\";\n    case 8453:\n      return \"base\";\n    case 10:\n      return \"optimism\";\n    case 11155111:\n      return \"sepolia\";\n    case 1337:\n    case 31337:\n      return \"testnet\";\n    case 59140:\n      return \"linea-sepolia\";\n    case 59144:\n      return \"linea\";\n    default:\n      return \"testnet\";\n  }\n};\n\nexport const formatAddress = (addr?: string): string =>\n  addr ? `${addr.slice(0, 6)}...${addr.slice(-4)}` : \"Connect Wallet\";\n\n// ==================== Wallet Error Handling ====================\n\nexport function normalizeWalletError(error: unknown): {\n  rejected: boolean;\n  message: string;\n} {\n  const e = error as {\n    code?: unknown;\n    name?: unknown;\n    message?: unknown;\n    shortMessage?: unknown;\n    cause?: unknown;\n  };\n  const cause = (e?.cause ?? null) as\n    | { code?: unknown; name?: unknown; message?: unknown; shortMessage?: unknown }\n    | null;\n\n  const code =\n    (typeof e?.code === \"number\" ? e.code : undefined) ??\n    (typeof cause?.code === \"number\" ? cause.code : undefined);\n  const name =\n    (typeof e?.name === \"string\" ? e.name : undefined) ??\n    (typeof cause?.name === \"string\" ? cause.name : undefined);\n  const msg =\n    (typeof e?.shortMessage === \"string\" ? e.shortMessage : undefined) ??\n    (typeof cause?.shortMessage === \"string\" ? cause.shortMessage : undefined) ??\n    (typeof e?.message === \"string\" ? e.message : undefined) ??\n    (typeof cause?.message === \"string\" ? cause.message : undefined) ??\n    \"Unknown wallet error\";\n\n  const rejected =\n    code === 4001 ||\n    name === \"UserRejectedRequestError\" ||\n    name === \"RejectedRequestError\" ||\n    /user rejected|rejected the request|denied|request rejected|canceled|cancelled/i.test(\n      msg\n    );\n\n  return { rejected, message: msg };\n}\n\n// ==================== Hex Conversion ====================\n\nexport function toHexQuantity(value: string): string {\n  const trimmed = value.trim();\n  const asBigInt = BigInt(trimmed);\n  return `0x${asBigInt.toString(16)}`;\n}\n\n// ==================== Provider Detection ====================\n\nexport async function pickInjectedProvider(\n  publicKey?: string\n): Promise<Eip1193Provider | undefined> {\n  const ethereum = (globalThis as unknown as { ethereum?: unknown }).ethereum as\n    | (Eip1193Provider & { providers?: unknown[] })\n    | undefined;\n  if (!ethereum?.request) return undefined;\n\n  const candidates: Eip1193Provider[] = Array.isArray(ethereum.providers)\n    ? (ethereum.providers.filter(\n        (p): p is Eip1193Provider => !!(p as Eip1193Provider)?.request\n      ) as Eip1193Provider[])\n    : [ethereum];\n\n  const target = publicKey?.toLowerCase();\n  if (target) {\n    for (const candidate of candidates) {\n      try {\n        const accounts = (await candidate.request({\n          method: \"eth_accounts\",\n        })) as unknown;\n        const list = Array.isArray(accounts)\n          ? (accounts as unknown[]).map((a) => String(a).toLowerCase())\n          : [];\n        if (list.includes(target)) return candidate;\n      } catch {\n        // Ignore providers that error on eth_accounts.\n      }\n    }\n  }\n\n  return candidates[0];\n}\n\n// ==================== Wallet System Message Emitter ====================\n\ntype WalletSystemMessageEmitterProps = {\n  wallet: WalletButtonState;\n};\n\nexport function WalletSystemMessageEmitter({\n  wallet,\n}: WalletSystemMessageEmitterProps) {\n  const { sendSystemMessage } = useRuntimeActions();\n  const lastWalletRef = useRef<{\n    isConnected: boolean;\n    address?: string;\n    chainId?: number;\n  }>({ isConnected: false });\n\n  useEffect(() => {\n    const prev = lastWalletRef.current;\n    const { address, chainId, isConnected } = wallet;\n    const normalizedAddress = address?.toLowerCase();\n\n    if (\n      isConnected &&\n      normalizedAddress &&\n      chainId &&\n      (!prev.isConnected || prev.address !== normalizedAddress)\n    ) {\n      const networkName = getNetworkName(chainId);\n      const message = `User connected wallet with address ${normalizedAddress} on ${networkName} network (Chain ID: ${chainId}). Ready to help with transactions.`;\n      console.log(message);\n      void sendSystemMessage(message);\n      lastWalletRef.current = {\n        isConnected: true,\n        address: normalizedAddress,\n        chainId,\n      };\n      return;\n    }\n\n    if (!isConnected && prev.isConnected) {\n      void sendSystemMessage(\"Wallet disconnected by user.\");\n      console.log(\"Wallet disconnected by user.\");\n      lastWalletRef.current = { isConnected: false };\n      return;\n    }\n\n    if (\n      isConnected &&\n      normalizedAddress &&\n      chainId &&\n      prev.isConnected &&\n      prev.address === normalizedAddress &&\n      prev.chainId !== chainId\n    ) {\n      const networkName = getNetworkName(chainId);\n      const message = `User switched wallet to ${networkName} network (Chain ID: ${chainId}).`;\n      console.log(message);\n      void sendSystemMessage(message);\n      lastWalletRef.current = {\n        isConnected: true,\n        address: normalizedAddress,\n        chainId,\n      };\n    }\n  }, [wallet, sendSystemMessage]);\n\n  return null;\n}\n","import type { MutableRefObject } from \"react\";\n\nimport type { BackendApi } from \"../api/client\";\nimport type { SessionMessage } from \"../api/types\";\nimport type { Notification } from \"../lib/notification-context\";\nimport {\n  normalizeWalletError,\n  pickInjectedProvider,\n  toHexQuantity,\n  type WalletTxRequestHandler,\n  type WalletTxRequestPayload,\n} from \"../utils/wallet\";\n\ntype WalletHandlerConfig = {\n  backendApiRef: MutableRefObject<BackendApi>;\n  onWalletTxRequest?: WalletTxRequestHandler;\n  publicKey?: string;\n  showNotification: (notification: Omit<Notification, \"id\">) => void;\n  applySessionMessagesToThread: (\n    threadId: string,\n    msgs?: SessionMessage[] | null\n  ) => void;\n  getCurrentThreadId: () => string;\n};\n\nexport class WalletHandler {\n  private handledRequests = new Set<string>();\n  private queue: Array<{\n    sessionId: string;\n    threadId: string;\n    request: WalletTxRequestPayload;\n  }> = [];\n  private inFlight = false;\n\n  constructor(private readonly config: WalletHandlerConfig) {}\n\n  handleRequest(\n    sessionId: string,\n    threadId: string,\n    request: WalletTxRequestPayload\n  ) {\n    // Only pop the wallet if the user is currently viewing this thread.\n    if (this.config.getCurrentThreadId() !== threadId) return;\n\n    const description =\n      request.description || request.topic || \"Wallet transaction requested\";\n    this.config.showNotification({\n      type: \"notice\",\n      iconType: \"wallet\",\n      title: \"Transaction Request\",\n      message: description,\n    });\n\n    this.enqueue(sessionId, threadId, request);\n    void this.drain();\n  }\n\n  private enqueue(\n    sessionId: string,\n    threadId: string,\n    request: WalletTxRequestPayload\n  ) {\n    const key = `${sessionId}:${request.timestamp ?? JSON.stringify(request)}`;\n    if (this.handledRequests.has(key)) return;\n    this.handledRequests.add(key);\n    this.queue.push({ sessionId, threadId, request });\n  }\n\n  private async drain() {\n    if (this.inFlight) return;\n    const next = this.queue.shift();\n    if (!next) return;\n    this.inFlight = true;\n\n    try {\n      if (this.config.onWalletTxRequest) {\n        const txHash = await this.config.onWalletTxRequest(next.request, {\n          sessionId: next.sessionId,\n          threadId: next.threadId,\n          publicKey: this.config.publicKey,\n        });\n        this.config.showNotification({\n          type: \"success\",\n          iconType: \"transaction\",\n          title: \"Transaction Sent\",\n          message: `Hash: ${txHash}`,\n        });\n        await this.config.backendApiRef.current.postSystemMessage(\n          next.sessionId,\n          `Transaction sent: ${txHash}`\n        );\n        await this.refreshThreadIfCurrent(next.sessionId, next.threadId);\n        return;\n      }\n\n      const activeProvider = await pickInjectedProvider(this.config.publicKey);\n      if (!activeProvider?.request) {\n        this.config.showNotification({\n          type: \"error\",\n          iconType: \"wallet\",\n          title: \"Wallet Not Found\",\n          message: \"No wallet provider found (window.ethereum missing).\",\n        });\n        await this.config.backendApiRef.current.postSystemMessage(\n          next.sessionId,\n          \"No wallet provider found (window.ethereum missing).\"\n        );\n        return;\n      }\n\n      const accounts = (await activeProvider.request({\n        method: \"eth_accounts\",\n      })) as unknown;\n      const addresses = Array.isArray(accounts)\n        ? (accounts as unknown[]).map(String)\n        : [];\n      const from = this.config.publicKey || addresses[0];\n\n      if (!from) {\n        await activeProvider.request({ method: \"eth_requestAccounts\" });\n      }\n\n      const fromAddress =\n        this.config.publicKey ||\n        ((await activeProvider.request({ method: \"eth_accounts\" })) as unknown);\n      const resolvedFrom =\n        this.config.publicKey ||\n        (Array.isArray(fromAddress)\n          ? String((fromAddress as unknown[])[0] ?? \"\")\n          : \"\");\n\n      if (!resolvedFrom) {\n        this.config.showNotification({\n          type: \"error\",\n          iconType: \"wallet\",\n          title: \"Wallet Not Connected\",\n          message: \"Please connect a wallet to sign the requested transaction.\",\n        });\n        await this.config.backendApiRef.current.postSystemMessage(\n          next.sessionId,\n          \"Wallet is not connected; please connect a wallet to sign the requested transaction.\"\n        );\n        return;\n      }\n\n      const gas = next.request.gas ?? next.request.gas_limit ?? undefined;\n      let valueHex: string | undefined;\n      let gasHex: string | undefined;\n      try {\n        valueHex = toHexQuantity(next.request.value);\n        if (gas) gasHex = toHexQuantity(gas);\n      } catch (error) {\n        this.config.showNotification({\n          type: \"error\",\n          iconType: \"transaction\",\n          title: \"Invalid Transaction\",\n          message: (error as Error).message,\n        });\n        await this.config.backendApiRef.current.postSystemMessage(\n          next.sessionId,\n          `Invalid wallet transaction request payload: ${(error as Error).message}`\n        );\n        return;\n      }\n\n      const txParams: Record<string, string> = {\n        from: resolvedFrom,\n        to: next.request.to,\n        value: valueHex,\n        data: next.request.data,\n        ...(gasHex ? { gas: gasHex } : {}),\n      };\n\n      const txHash = (await activeProvider.request({\n        method: \"eth_sendTransaction\",\n        params: [txParams],\n      })) as string;\n\n      this.config.showNotification({\n        type: \"success\",\n        title: \"Transaction sent\",\n        message: `Transaction hash: ${txHash}`,\n      });\n      await this.config.backendApiRef.current.postSystemMessage(\n        next.sessionId,\n        `Transaction sent: ${txHash}`\n      );\n      await this.refreshThreadIfCurrent(next.sessionId, next.threadId);\n    } catch (error) {\n      const normalized = normalizeWalletError(error);\n      const final = normalized.rejected\n        ? \"Transaction rejected by user.\"\n        : `Transaction failed: ${normalized.message}`;\n\n      this.config.showNotification({\n        type: normalized.rejected ? \"notice\" : \"error\",\n        iconType: normalized.rejected ? \"transaction\" : \"error\",\n        title: normalized.rejected ? \"Transaction Rejected\" : \"Transaction Failed\",\n        message: normalized.rejected\n          ? \"Transaction was rejected by user.\"\n          : normalized.message,\n      });\n\n      try {\n        await this.config.backendApiRef.current.postSystemMessage(\n          next.sessionId,\n          final\n        );\n        await this.refreshThreadIfCurrent(next.sessionId, next.threadId);\n      } catch (postError) {\n        console.error(\"Failed to report wallet tx result to backend:\", postError);\n      }\n    } finally {\n      this.inFlight = false;\n      void this.drain();\n    }\n  }\n\n  private async refreshThreadIfCurrent(sessionId: string, threadId: string) {\n    if (this.config.getCurrentThreadId() !== threadId) return;\n    try {\n      const state = await this.config.backendApiRef.current.fetchState(sessionId);\n      this.config.applySessionMessagesToThread(threadId, state.messages);\n    } catch (refreshError) {\n      console.error(\"Failed to refresh state after wallet tx:\", refreshError);\n    }\n  }\n}\n\n","import type { MutableRefObject } from \"react\";\n\nimport type { BackendApi } from \"../api/client\";\nimport type { Notification } from \"../lib/notification-context\";\nimport type { WalletTxRequestPayload } from \"../utils/wallet\";\nimport type { ThreadMetadata } from \"../state/types\";\nimport { isPlaceholderTitle } from \"./utils\";\nimport type { BakendState } from \"./backend-state\";\nimport { findTempIdForBackendId } from \"./backend-state\";\n\nexport type BackendSystemEvent =\n  | { InlineDisplay: unknown }\n  | { SystemNotice: string }\n  | { SystemError: string }\n  | { AsyncUpdate: unknown };\n\ntype EventControllerConfig = {\n  backendApiRef: MutableRefObject<BackendApi>;\n  backendStateRef: MutableRefObject<BakendState>;\n  showNotification: (notification: Omit<Notification, \"id\">) => void;\n  handleWalletTxRequest: (\n    sessionId: string,\n    threadId: string,\n    request: WalletTxRequestPayload\n  ) => void;\n  setThreadMetadata: (\n    updater: (prev: Map<string, ThreadMetadata>) => Map<string, ThreadMetadata>\n  ) => void;\n};\n\nexport class EventController {\n  private lastEventIdBySession = new Map<string, number>();\n  private eventsInFlight = new Set<string>();\n  private updateSubscriptions = new Map<string, () => void>();\n  private subscribableSessionId: string | null = null;\n\n  constructor(private readonly config: EventControllerConfig) {}\n\n  setSubscribableSessionId(sessionId: string | null) {\n    console.log(\"游댒 [updates] setSubscribableSessionId\", { sessionId });\n    this.subscribableSessionId = sessionId;\n    this.syncSubscriptions();\n  }\n\n  private syncSubscriptions() {\n    console.log(\"游댒 [updates] syncSubscriptions\", {\n      subscribableSessionId: this.subscribableSessionId,\n      active: Array.from(this.updateSubscriptions.keys()),\n    });\n    const nextSessions = new Set<string>();\n    if (this.subscribableSessionId) {\n      nextSessions.add(this.subscribableSessionId);\n    }\n\n    // Remove subscriptions for sessions no longer needed\n    for (const sessionId of this.updateSubscriptions.keys()) {\n      if (!nextSessions.has(sessionId)) {\n        this.removeSubscription(sessionId);\n      }\n    }\n\n    // Add subscriptions for new sessions\n    for (const sessionId of nextSessions) {\n      this.ensureSubscription(sessionId);\n    }\n  }\n\n  private ensureSubscription(sessionId: string) {\n    if (this.updateSubscriptions.has(sessionId)) return;\n    console.log(\"游댒 [updates] ensureSubscription\", { sessionId });\n\n    const unsubscribe = this.config.backendApiRef.current.subscribeToUpdates(\n      sessionId,\n      (update) => {\n        console.log(\"游댒 [updates] event_available\", {\n          sessionId: update.session_id,\n          eventId: update.event_id,\n          eventType: update.event_type,\n        });\n        if (update.type !== \"event_available\") return;\n        void this.drainEvents(update.session_id);\n      },\n      (error) => {\n        console.error(\"Failed to handle system update SSE:\", error);\n      }\n    );\n\n    this.updateSubscriptions.set(sessionId, unsubscribe);\n  }\n\n  private removeSubscription(sessionId: string) {\n    const unsubscribe = this.updateSubscriptions.get(sessionId);\n    if (!unsubscribe) return;\n    unsubscribe();\n    this.updateSubscriptions.delete(sessionId);\n  }\n\n  async drainEvents(sessionId: string) {\n    if (this.eventsInFlight.has(sessionId)) {\n      console.log(\"낍 [events] drain already in flight\", { sessionId });\n      return;\n    }\n    this.eventsInFlight.add(sessionId);\n\n    try {\n      let afterId = this.lastEventIdBySession.get(sessionId) ?? 0;\n      console.log(\"游닌 [events] start drain\", { sessionId, afterId });\n      for (;;) {\n        const requestAfterId = afterId;\n        const events = await this.config.backendApiRef.current.fetchEventsAfter(\n          sessionId,\n          requestAfterId,\n          200\n        );\n        console.log(\"游닌 [events] fetched batch\", {\n          sessionId,\n          afterId: requestAfterId,\n          count: events.length,\n        });\n        if (!events.length) break;\n\n        for (const event of events) {\n          const eventId =\n            typeof event.event_id === \"number\"\n              ? event.event_id\n              : Number(event.event_id);\n          if (Number.isFinite(eventId)) afterId = Math.max(afterId, eventId);\n\n          if (event.type === \"title_changed\" && typeof event.new_title === \"string\") {\n            console.log(\"游낑勇 [events] title_changed\", {\n              sessionId,\n              eventId,\n              newTitle: event.new_title,\n            });\n            this.applyTitleChanged(sessionId, event.new_title as string);\n          }\n\n          if (event.type === \"wallet_tx_request\") {\n            const payload = (event as unknown as { payload?: unknown }).payload;\n            if (payload && typeof payload === \"object\") {\n              const req = payload as Record<string, unknown>;\n              if (\n                typeof req.to === \"string\" &&\n                typeof req.value === \"string\" &&\n                typeof req.data === \"string\"\n              ) {\n                const threadId =\n                  findTempIdForBackendId(\n                    this.config.backendStateRef.current,\n                    sessionId\n                  ) || sessionId;\n                this.config.handleWalletTxRequest(\n                  sessionId,\n                  threadId,\n                  req as unknown as WalletTxRequestPayload\n                );\n              }\n            }\n          }\n        }\n\n        // If we hit the limit, keep draining in case more events are waiting.\n        if (events.length < 200) break;\n      }\n\n      console.log(\"游닌 [events] drain complete\", { sessionId, afterId });\n      this.lastEventIdBySession.set(sessionId, afterId);\n    } catch (error) {\n      console.error(\"Failed to fetch async events:\", error);\n    } finally {\n      this.eventsInFlight.delete(sessionId);\n    }\n  }\n\n  private applyTitleChanged(sessionId: string, newTitle: string) {\n    const backendState = this.config.backendStateRef.current;\n    const tempId = findTempIdForBackendId(backendState, sessionId);\n    const threadIdToUpdate = tempId || sessionId;\n\n    console.log(\"游낑勇 [title] applying\", {\n      sessionId,\n      threadId: threadIdToUpdate,\n      newTitle,\n    });\n    this.config.setThreadMetadata((prev) => {\n      const next = new Map(prev);\n      const existing = next.get(threadIdToUpdate);\n      const normalizedTitle = isPlaceholderTitle(newTitle) ? \"\" : newTitle;\n      const nextStatus = existing?.status === \"archived\" ? \"archived\" : \"regular\";\n      next.set(threadIdToUpdate, {\n        title: normalizedTitle,\n        status: nextStatus,\n        lastActiveAt: existing?.lastActiveAt ?? new Date().toISOString(),\n      });\n      return next;\n    });\n\n    if (!isPlaceholderTitle(newTitle) && backendState.creatingThreadId === threadIdToUpdate) {\n      backendState.creatingThreadId = null;\n    }\n  }\n\n  handleBackendSystemEvents(\n    sessionId: string,\n    threadId: string,\n    rawEvents?: unknown[] | null\n  ) {\n    if (!rawEvents?.length) return;\n\n    for (const raw of rawEvents) {\n      const parsed = this.parseBackendSystemEvent(raw);\n      if (!parsed) continue;\n\n      if (\"InlineDisplay\" in parsed) {\n        const payload = parsed.InlineDisplay;\n        if (!payload || typeof payload !== \"object\") continue;\n        const type = (payload as Record<string, unknown>).type;\n        if (type !== \"wallet_tx_request\") continue;\n        const requestValue = (payload as Record<string, unknown>).payload;\n        if (!requestValue || typeof requestValue !== \"object\") continue;\n        const req = requestValue as Record<string, unknown>;\n        if (\n          typeof req.to !== \"string\" ||\n          typeof req.value !== \"string\" ||\n          typeof req.data !== \"string\"\n        ) {\n          continue;\n        }\n        this.config.handleWalletTxRequest(\n          sessionId,\n          threadId,\n          req as unknown as WalletTxRequestPayload\n        );\n      }\n\n      if (\"SystemError\" in parsed) {\n        this.config.showNotification({\n          type: \"error\",\n          iconType: \"error\",\n          title: \"Error\",\n          message: parsed.SystemError,\n        });\n      }\n\n      if (\"SystemNotice\" in parsed) {\n        this.config.showNotification({\n          type: \"notice\",\n          iconType: \"notice\",\n          title: \"Notice\",\n          message: parsed.SystemNotice,\n        });\n      }\n    }\n  }\n\n  private parseBackendSystemEvent(value: unknown): BackendSystemEvent | null {\n    if (!value || typeof value !== \"object\") return null;\n    const entries = Object.entries(value as Record<string, unknown>);\n    if (entries.length !== 1) return null;\n    const [key, payload] = entries[0];\n    switch (key) {\n      case \"InlineDisplay\":\n        return { InlineDisplay: payload };\n      case \"SystemNotice\":\n        return {\n          SystemNotice: typeof payload === \"string\" ? payload : String(payload),\n        };\n      case \"SystemError\":\n        return {\n          SystemError: typeof payload === \"string\" ? payload : String(payload),\n        };\n      case \"AsyncUpdate\":\n        return { AsyncUpdate: payload };\n      default:\n        return null;\n    }\n  }\n\n  cleanup() {\n    for (const unsubscribe of this.updateSubscriptions.values()) {\n      unsubscribe();\n    }\n    this.updateSubscriptions.clear();\n  }\n}\n"],"mappings":"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","names":["useCallback","useEffect","useMemo","useRef","useState","useRef","createContext","useContext","createContext","useContext","parseTimestamp","useRef","createContext","useCallback","useContext","useState","React","forwardRef","isValidElement","ReactDOM","getAsset","type","SuccessIcon","InfoIcon","WarningIcon","ErrorIcon","bars","Loader","visible","className","React","_","i","CloseIcon","useIsDocumentHidden","isDocumentHidden","setIsDocumentHidden","callback","toastsCounter","Observer","subscriber","index","data","_a","message","rest","id","alreadyExists","toast","dismissible","promise","p","shouldDismiss","result","originalPromise","response","isHttpResponse","description","error","unwrap","resolve","reject","jsx","ToastState","toastFunction","basicToast","getHistory","getToasts","styleInject","css","insertAt","head","style","isAction","action","VISIBLE_TOASTS_AMOUNT","VIEWPORT_OFFSET","MOBILE_VIEWPORT_OFFSET","TOAST_LIFETIME","TOAST_WIDTH","GAP","SWIPE_THRESHOLD","TIME_BEFORE_UNMOUNT","cn","classes","getDefaultSwipeDirections","position","y","x","directions","Toast","props","_b","_c","_d","_e","_f","_g","_h","_i","_j","_k","ToasterInvert","unstyled","interacting","setHeights","visibleToasts","heights","toasts","expanded","removeToast","defaultRichColors","closeButtonFromToaster","cancelButtonStyle","actionButtonStyle","descriptionClassName","durationFromToaster","gap","loadingIconProp","expandByDefault","classNames","icons","closeButtonAriaLabel","pauseWhenPageIsHidden","swipeDirection","setSwipeDirection","swipeOutDirection","setSwipeOutDirection","mounted","setMounted","removed","setRemoved","swiping","setSwiping","swipeOut","setSwipeOut","isSwiped","setIsSwiped","offsetBeforeRemove","setOffsetBeforeRemove","initialHeight","setInitialHeight","remainingTime","dragStartTime","toastRef","isFront","isVisible","toastType","toastClassname","toastDescriptionClassname","heightIndex","height","closeButton","duration","closeTimerStartTimeRef","offset","lastCloseTimerStartTimeRef","pointerStartRef","toastsHeightBefore","prev","curr","reducerIndex","invert","disabled","toastNode","h","originalHeight","newHeight","deleteToast","timeoutId","elapsedTime","getLoadingIcon","event","swipeAmountX","swipeAmountY","timeTaken","swipeAmount","velocity","yDelta","xDelta","swipeDirections","isValidElement","getDocumentDirection","dirAttribute","assignOffset","defaultOffset","mobileOffset","styles","isMobile","prefix","defaultValue","assignAll","key","Toaster","forwardRef","props","ref","invert","position","hotkey","expand","closeButton","className","offset","mobileOffset","theme","richColors","duration","style","visibleToasts","VISIBLE_TOASTS_AMOUNT","toastOptions","dir","getDocumentDirection","gap","GAP","loadingIcon","icons","containerAriaLabel","pauseWhenPageIsHidden","toasts","setToasts","React","possiblePositions","toast","heights","setHeights","expanded","setExpanded","interacting","setInteracting","actualTheme","setActualTheme","listRef","hotkeyLabel","lastFocusedElementRef","isFocusWithinRef","removeToast","toastToRemove","_a","ToastState","id","t","ReactDOM","indexOfExistingToast","darkMediaQuery","matches","error","e","handleKeyDown","event","_b","key","index","x","TOAST_WIDTH","assignOffset","Toast","h","jsx","jsx","createContext","useContext","useState","useCallback","useEffect","useRef","useRef","useEffect","txHash","jsx","parseTimestamp","useRef","useEffect","useCallback","useState","useMemo","_a"]}